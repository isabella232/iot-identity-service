<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1993" height="6857" contentScriptType="application/ecmascript" contentStyleType="text/css" style="width:1993px;height:6857px" preserveAspectRatio="none" version="1.1" viewBox="0 0 1993 6857" zoomAndPan="magnify"><defs><filter id="f1jxt8w6krzj03" width="300%" height="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text x="919.75" y="30.686" fill="#000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="150">Runtime Operation</text><rect style="stroke:#a80036;stroke-width:1" width="1440" height="6808.625" x="533.5" y="42.641" fill="#ADD8E6"/><text x="1230" y="56.136" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43">Device</text><rect style="stroke:#a80036;stroke-width:1" width="10" height="133.406" x="213.5" y="5172.469" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="70.703" x="399.5" y="938.813" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="139.109" x="399.5" y="1673.656" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="399.5" y="2257.445" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="139.109" x="399.5" y="2913.492" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="399.5" y="3089.953" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="399.5" y="3505.281" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="139.109" x="399.5" y="6615.938" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="386.625" x="592.5" y="2436.813" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="403.977" x="592.5" y="3192.359" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="592.5" y="3626.688" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="193.109" x="592.5" y="4108.492" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="1308.438" x="592.5" y="4347.789" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="189.164" x="592.5" y="5903.391" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="386.625" x="592.5" y="6139.258" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="195.461" x="790.5" y="597.242" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="233.516" x="790.5" y="1137.273" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="419.328" x="790.5" y="1898.82" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="293.219" x="790.5" y="2499.867" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="326.922" x="790.5" y="3239.063" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="79.406" x="790.5" y="5933.742" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="293.219" x="790.5" y="6202.313" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="276.32" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="386.078" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="495.836" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="648.945" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="1183.977" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="1293.734" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="1460.844" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="1945.523" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="2071.633" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="2546.57" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="2672.68" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="3285.766" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="3411.875" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="4883.602" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="5368.414" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="6249.016" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="6375.125" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="1183.5" y="726" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="933.734" x="1183.5" y="4692.141" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="781.977" x="1188.5" y="4806.547" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="41.352" x="1193.5" y="4968.656" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="41.352" x="1193.5" y="5437.117" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="927.5" height="890.305" x="351" y="134.211" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="907.5" height="798.25" x="361" y="219.266" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="1226.5" height="789.25" x="351" y="1038.516" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="1206.5" height="756.898" x="361" y="1063.867" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="1628.5" height="1941.102" x="351" y="1841.766" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="1386.5" height="680.844" x="361" y="2379.758" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="1255.5" height="529.734" x="361" y="3135.305" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="1944.5" height="2980.18" x="10" y="3796.867" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="1780.5" height="2001.117" x="20" y="3822.219" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="1614.5" height="1748.547" x="176" y="4067.789" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:none;stroke-width:1" width="1614.5" height="1506.734" x="176" y="4309.602" fill="#FFF"/><rect style="stroke:#000;stroke-width:2" width="291" height="223.945" x="527.5" y="4362.789" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:none;stroke-width:1" width="291" height="118.891" x="527.5" y="4467.844" fill="#FFF"/><rect style="stroke:#000;stroke-width:2" width="1198.5" height="726.625" x="186" y="4826.547" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:none;stroke-width:1" width="1198.5" height="239.297" x="186" y="5313.875" fill="#FFF"/><rect style="stroke:#000;stroke-width:2" width="1593.5" height="932.711" x="351" y="5837.336" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#000;stroke-width:2" width="1573.5" height="900.359" x="361" y="5862.688" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="218" x2="218" y1="117.211" y2="6794.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="404" x2="404" y1="117.211" y2="6794.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="597.5" x2="597.5" y1="117.211" y2="6794.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="795.5" x2="795.5" y1="117.211" y2="6794.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="997.5" x2="997.5" y1="117.211" y2="6794.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1188.5" x2="1188.5" y1="117.211" y2="6794.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1382" x2="1382" y1="117.211" y2="6794.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1562.5" x2="1562.5" y1="2359.453" y2="6794.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1742.5" x2="1742.5" y1="3705.344" y2="6794.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1929.5" x2="1929.5" y1="3760.758" y2="6794.047"/><rect style="stroke:#a80036;stroke-width:1.5" width="41" height="31.609" x="196" y="80.602" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="203" y="102.135" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27">EST</text><rect style="stroke:#a80036;stroke-width:1.5" width="41" height="31.609" x="196" y="6793.047" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="203" y="6814.58" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27">EST</text><rect style="stroke:#a80036;stroke-width:1.5" width="63" height="31.609" x="371" y="80.602" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="378" y="102.135" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49">IoT Hub</text><rect style="stroke:#a80036;stroke-width:1.5" width="63" height="31.609" x="371" y="6793.047" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="378" y="6814.58" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49">IoT Hub</text><rect style="stroke:#a80036;stroke-width:1.5" width="116" height="31.609" x="537.5" y="80.602" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="544.5" y="102.135" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102">Module Runtime</text><rect style="stroke:#a80036;stroke-width:1.5" width="116" height="31.609" x="537.5" y="6793.047" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="544.5" y="6814.58" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102">Module Runtime</text><rect style="stroke:#a80036;stroke-width:1.5" width="110" height="31.609" x="738.5" y="80.602" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="745.5" y="102.135" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96">Identity Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="110" height="31.609" x="738.5" y="6793.047" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="745.5" y="6814.58" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96">Identity Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="96" height="31.609" x="947.5" y="80.602" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="954.5" y="102.135" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82">Keys Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="96" height="31.609" x="947.5" y="6793.047" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="954.5" y="6814.58" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82">Keys Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="136" height="31.609" x="1118.5" y="80.602" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="1125.5" y="102.135" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122">Certificates Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="136" height="31.609" x="1118.5" y="6793.047" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="1125.5" y="6814.58" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122">Certificates Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="97" height="49.219" x="1332" y="62.992" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="1339" y="84.525" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83">Host Process</text><text x="1357.5" y="102.135" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46">Module</text><rect style="stroke:#a80036;stroke-width:1.5" width="97" height="49.219" x="1332" y="6793.047" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="1339" y="6814.58" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83">Host Process</text><text x="1357.5" y="6832.19" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46">Module</text><rect style="stroke:#a80036;stroke-width:1.5" width="84" height="31.609" x="1518.5" y="6793.047" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="1525.5" y="6814.58" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70">EdgeAgent</text><rect style="stroke:#a80036;stroke-width:1.5" width="72" height="31.609" x="1704.5" y="6793.047" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="1711.5" y="6814.58" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58">EdgeHub</text><rect style="stroke:#a80036;stroke-width:1.5" width="76" height="49.219" x="1889.5" y="6793.047" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="1896.5" y="6814.58" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62">Container</text><text x="1904.5" y="6832.19" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46">Module</text><rect style="stroke:#a80036;stroke-width:1" width="10" height="133.406" x="213.5" y="5172.469" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="70.703" x="399.5" y="938.813" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="139.109" x="399.5" y="1673.656" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="399.5" y="2257.445" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="139.109" x="399.5" y="2913.492" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="399.5" y="3089.953" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="399.5" y="3505.281" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="139.109" x="399.5" y="6615.938" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="386.625" x="592.5" y="2436.813" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="403.977" x="592.5" y="3192.359" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="592.5" y="3626.688" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="193.109" x="592.5" y="4108.492" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="1308.438" x="592.5" y="4347.789" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="189.164" x="592.5" y="5903.391" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="386.625" x="592.5" y="6139.258" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="195.461" x="790.5" y="597.242" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="233.516" x="790.5" y="1137.273" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="419.328" x="790.5" y="1898.82" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="293.219" x="790.5" y="2499.867" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="326.922" x="790.5" y="3239.063" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="79.406" x="790.5" y="5933.742" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="293.219" x="790.5" y="6202.313" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="276.32" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="386.078" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="495.836" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="648.945" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="1183.977" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="1293.734" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="1460.844" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="1945.523" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="2071.633" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="2546.57" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="2672.68" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="3285.766" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="3411.875" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="4883.602" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="5368.414" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="6249.016" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="992.5" y="6375.125" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="30.352" x="1183.5" y="726" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="933.734" x="1183.5" y="4692.141" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="781.977" x="1188.5" y="4806.547" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="41.352" x="1193.5" y="4968.656" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="41.352" x="1193.5" y="5437.117" fill="#FFF" filter="url(#f1jxt8w6krzj03)"/><path fill="#EEE" d="M351,134.2109 L598,134.2109 L598,142.2109 L588,152.2109 L351,152.2109 L351,134.2109" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="927.5" height="890.305" x="351" y="134.211" fill="none"/><text x="366" y="148.706" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="202">Host-level modules provisioning</text><line style="stroke:#a80036;stroke-width:1" x1="795.5" x2="837.5" y1="191.266" y2="191.266"/><line style="stroke:#a80036;stroke-width:1" x1="837.5" x2="837.5" y1="191.266" y2="204.266"/><line style="stroke:#a80036;stroke-width:1" x1="796.5" x2="837.5" y1="204.266" y2="204.266"/><polygon fill="#A80036" points="806.5 200.266 796.5 204.266 806.5 208.266 802.5 204.266" style="stroke:#a80036;stroke-width:1"/><text x="802.5" y="178.233" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">1</text><text x="813.5" y="170.058" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134">Read host-level module</text><text x="813.5" y="186.409" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145">names from configuration</text><path fill="#EEE" d="M361,219.2656 L434,219.2656 L434,227.2656 L424,237.2656 L361,237.2656 L361,219.2656" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="907.5" height="798.25" x="361" y="219.266" fill="none"/><text x="376" y="233.761" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="449" y="232.685" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="217">[for creating each host-level module M]</text><polygon fill="#A80036" points="980.5 272.32 990.5 276.32 980.5 280.32 984.5 276.32" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="795.5" x2="986.5" y1="276.32" y2="276.32"/><text x="802.5" y="263.288" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">2</text><text x="813.5" y="255.112" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107">Create/Get master</text><text x="813.5" y="271.464" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132">identity symmetric key</text><polygon fill="#A80036" points="806.5 302.672 796.5 306.672 806.5 310.672 802.5 306.672" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="800.5" x2="996.5" y1="306.672" y2="306.672"/><text x="812.5" y="301.815" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">3</text><text x="823.5" y="301.815" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">Key handle</text><polygon fill="#A80036" points="980.5 382.078 990.5 386.078 980.5 390.078 984.5 386.078" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="795.5" x2="986.5" y1="386.078" y2="386.078"/><text x="802.5" y="356.694" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">4</text><text x="813.5" y="332.167" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128">Create module derived</text><text x="813.5" y="348.519" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139">key object for module M</text><text x="813.5" y="364.87" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147">(based on master identity</text><text x="813.5" y="381.222" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">key handle)</text><polygon fill="#A80036" points="806.5 412.43 796.5 416.43 806.5 420.43 802.5 416.43" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="800.5" x2="996.5" y1="416.43" y2="416.43"/><text x="812.5" y="411.573" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">5</text><polygon fill="#A80036" points="980.5 491.836 990.5 495.836 980.5 499.836 984.5 495.836" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="795.5" x2="986.5" y1="495.836" y2="495.836"/><text x="802.5" y="466.452" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">6</text><text x="813.5" y="441.925" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136">Derive and Sign module</text><text x="813.5" y="458.276" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147">M&apos;s SAS key using name</text><text x="813.5" y="474.628" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119">+ generation ID (with</text><text x="813.5" y="490.979" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111">derived key handle)</text><polygon fill="#A80036" points="806.5 522.188 796.5 526.188 806.5 530.188 802.5 526.188" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="800.5" x2="996.5" y1="526.188" y2="526.188"/><text x="812.5" y="521.331" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">7</text><line style="stroke:#a80036;stroke-width:1" x1="795.5" x2="842.5" y1="584.242" y2="584.242"/><line style="stroke:#a80036;stroke-width:1" x1="842.5" x2="842.5" y1="584.242" y2="597.242"/><line style="stroke:#a80036;stroke-width:1" x1="801.5" x2="842.5" y1="597.242" y2="597.242"/><polygon fill="#A80036" points="811.5 593.242 801.5 597.242 811.5 601.242 807.5 597.242" style="stroke:#a80036;stroke-width:1"/><text x="807.5" y="563.034" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">8</text><text x="818.5" y="546.683" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105">Get current device</text><text x="818.5" y="563.034" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118">identity cert and key</text><text x="818.5" y="579.386" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38">handle</text><polygon fill="#A80036" points="980.5 644.945 990.5 648.945 980.5 652.945 984.5 648.945" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="648.945" y2="648.945"/><text x="807.5" y="635.913" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">9</text><text x="818.5" y="627.737" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105">Get current device</text><text x="818.5" y="644.089" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143">identity cert&apos;s private key</text><polygon fill="#A80036" points="811.5 675.297 801.5 679.297 811.5 683.297 807.5 679.297" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="679.297" y2="679.297"/><text x="817.5" y="674.44" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">10</text><text x="835.5" y="674.44" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">Key handle</text><polygon fill="#A80036" points="1171.5 722 1181.5 726 1171.5 730 1175.5 726" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="1177.5" y1="726" y2="726"/><text x="807.5" y="712.968" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">11</text><text x="825.5" y="704.792" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105">Get current device</text><text x="825.5" y="721.144" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68">identity cert</text><polygon fill="#A80036" points="811.5 752.352 801.5 756.352 811.5 760.352 807.5 756.352" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="1187.5" y1="756.352" y2="756.352"/><text x="817.5" y="751.495" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">12</text><text x="835.5" y="751.495" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29">PEM</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="800.5" x2="842.5" y1="791.703" y2="791.703"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="842.5" x2="842.5" y1="791.703" y2="804.703"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="795.5" x2="842.5" y1="804.703" y2="804.703"/><polygon fill="#A80036" points="805.5 800.703 795.5 804.703 805.5 808.703 801.5 804.703" style="stroke:#a80036;stroke-width:1"/><text x="807.5" y="786.847" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">13</text><line style="stroke:#a80036;stroke-width:1" x1="795.5" x2="837.5" y1="862.758" y2="862.758"/><line style="stroke:#a80036;stroke-width:1" x1="837.5" x2="837.5" y1="862.758" y2="875.758"/><line style="stroke:#a80036;stroke-width:1" x1="796.5" x2="837.5" y1="875.758" y2="875.758"/><polygon fill="#A80036" points="806.5 871.758 796.5 875.758 806.5 879.758 802.5 875.758" style="stroke:#a80036;stroke-width:1"/><text x="802.5" y="841.55" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">14</text><text x="820.5" y="825.198" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135">Create TLS client using</text><text x="820.5" y="841.55" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147">key handle + PEM (using</text><text x="820.5" y="857.901" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109">openssl-engine-ks)</text><polygon fill="#A80036" points="420.5 934.813 410.5 938.813 420.5 942.813 416.5 938.813" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="414.5" x2="794.5" y1="938.813" y2="938.813"/><text x="426.5" y="917.605" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">15</text><text x="444.5" y="901.253" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148">Create identity for module</text><text x="444.5" y="917.605" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149">M and register the derived</text><text x="444.5" y="933.956" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88">SAS keys for it</text><path fill="#FBFB77" d="M525,951.8125 L525,977.8125 L1061,977.8125 L1061,961.8125 L1051,951.8125 L525,951.8125" filter="url(#f1jxt8w6krzj03)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M1051,951.8125 L1051,961.8125 L1061,961.8125 L1051,951.8125" style="stroke:#a80036;stroke-width:1"/><text x="531" y="970.308" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="515">If IoTHub call ever fails with bad credential, IS requests provisioning (with reprovision=true)</text><polygon fill="#A80036" points="783.5 1005.516 793.5 1009.516 783.5 1013.516 787.5 1009.516" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="404.5" x2="789.5" y1="1009.516" y2="1009.516"/><text x="411.5" y="1004.659" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">16</text><path fill="#EEE" d="M351,1038.5156 L639,1038.5156 L639,1046.5156 L629,1056.5156 L351,1056.5156 L351,1038.5156" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1226.5" height="789.25" x="351" y="1038.516" fill="none"/><text x="366" y="1053.011" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="243">Host-level modules process operations</text><path fill="#EEE" d="M361,1063.8672 L434,1063.8672 L434,1071.8672 L424,1081.8672 L361,1081.8672 L361,1063.8672" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1206.5" height="756.898" x="361" y="1063.867" fill="none"/><text x="376" y="1078.362" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="449" y="1077.286" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="423">[for host-level module M to create SAS token for authenticating with IoT Hub]</text><polygon fill="#A80036" points="811.5 1133.273 801.5 1137.273 811.5 1141.273 807.5 1137.273" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="805.5" x2="1381.5" y1="1137.273" y2="1137.273"/><text x="817.5" y="1116.065" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">17</text><text x="835.5" y="1099.714" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114">Get identity for host</text><text x="835.5" y="1116.065" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">module M to identify with</text><text x="835.5" y="1132.417" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44">IoT Hub</text><polygon fill="#A80036" points="980.5 1179.977 990.5 1183.977 980.5 1187.977 984.5 1183.977" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="1183.977" y2="1183.977"/><text x="807.5" y="1170.944" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">18</text><text x="825.5" y="1162.769" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136">Get master identity key</text><text x="825.5" y="1179.12" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38">handle</text><polygon fill="#A80036" points="811.5 1210.328 801.5 1214.328 811.5 1218.328 807.5 1214.328" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="1214.328" y2="1214.328"/><text x="817.5" y="1209.472" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">19</text><text x="835.5" y="1209.472" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">Key handle</text><polygon fill="#A80036" points="980.5 1289.734 990.5 1293.734 980.5 1297.734 984.5 1293.734" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="1293.734" y2="1293.734"/><text x="807.5" y="1264.351" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">20</text><text x="825.5" y="1239.823" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128">Create module derived</text><text x="825.5" y="1256.175" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139">key object for module M</text><text x="825.5" y="1272.526" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147">(based on master identity</text><text x="825.5" y="1288.878" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">key handle)</text><polygon fill="#A80036" points="811.5 1320.086 801.5 1324.086 811.5 1328.086 807.5 1324.086" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="1324.086" y2="1324.086"/><text x="817.5" y="1319.229" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">21</text><polygon fill="#A80036" points="1370.5 1366.789 1380.5 1370.789 1370.5 1374.789 1374.5 1370.789" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="795.5" x2="1376.5" y1="1370.789" y2="1370.789"/><text x="802.5" y="1357.757" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">22</text><text x="820.5" y="1349.581" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115">Module identity with</text><text x="820.5" y="1365.933" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107">derived key handle</text><line style="stroke:#a80036;stroke-width:1" x1="1382.5" x2="1424.5" y1="1401.141" y2="1401.141"/><line style="stroke:#a80036;stroke-width:1" x1="1424.5" x2="1424.5" y1="1401.141" y2="1414.141"/><line style="stroke:#a80036;stroke-width:1" x1="1383.5" x2="1424.5" y1="1414.141" y2="1414.141"/><polygon fill="#A80036" points="1393.5 1410.141 1383.5 1414.141 1393.5 1418.141 1389.5 1414.141" style="stroke:#a80036;stroke-width:1"/><text x="1389.5" y="1396.284" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">23</text><text x="1407.5" y="1396.284" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120">Generate SAS token</text><polygon fill="#A80036" points="1013.5 1456.844 1003.5 1460.844 1013.5 1464.844 1009.5 1460.844" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1007.5" x2="1381.5" y1="1460.844" y2="1460.844"/><text x="1019.5" y="1447.812" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">24</text><text x="1037.5" y="1439.636" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128">Sign SAS token using</text><text x="1037.5" y="1455.987" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107">derived key handle</text><polygon fill="#A80036" points="1370.5 1487.195 1380.5 1491.195 1370.5 1495.195 1374.5 1491.195" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="997.5" x2="1376.5" y1="1491.195" y2="1491.195"/><text x="1004.5" y="1486.339" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">25</text><text x="1022.5" y="1486.339" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107">Signed SAS token</text><line style="stroke:#a80036;stroke-width:1" x1="1382.5" x2="1424.5" y1="1570.602" y2="1570.602"/><line style="stroke:#a80036;stroke-width:1" x1="1424.5" x2="1424.5" y1="1570.602" y2="1583.602"/><line style="stroke:#a80036;stroke-width:1" x1="1383.5" x2="1424.5" y1="1583.602" y2="1583.602"/><polygon fill="#A80036" points="1393.5 1579.602 1383.5 1583.602 1393.5 1587.602 1389.5 1583.602" style="stroke:#a80036;stroke-width:1"/><text x="1389.5" y="1541.218" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">26</text><text x="1407.5" y="1516.69" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53">Generate</text><text x="1407.5" y="1533.042" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">SharedAccessSignature</text><text x="1407.5" y="1549.394" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147">for authenticating with IoT</text><text x="1407.5" y="1565.745" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23">Hub</text><line style="stroke:#a80036;stroke-width:1" x1="1382.5" x2="1424.5" y1="1630.305" y2="1630.305"/><line style="stroke:#a80036;stroke-width:1" x1="1424.5" x2="1424.5" y1="1630.305" y2="1643.305"/><line style="stroke:#a80036;stroke-width:1" x1="1383.5" x2="1424.5" y1="1643.305" y2="1643.305"/><polygon fill="#A80036" points="1393.5 1639.305 1383.5 1643.305 1393.5 1647.305 1389.5 1643.305" style="stroke:#a80036;stroke-width:1"/><text x="1389.5" y="1617.273" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">27</text><text x="1407.5" y="1609.097" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148">Create IoT Hub client with</text><text x="1407.5" y="1625.448" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">SAS token</text><polygon fill="#A80036" points="420.5 1669.656 410.5 1673.656 420.5 1677.656 416.5 1673.656" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="414.5" x2="1381.5" y1="1673.656" y2="1673.656"/><text x="426.5" y="1668.8" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">28</text><text x="444.5" y="1668.8" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111">Connect to IoT Hub</text><line style="stroke:#a80036;stroke-width:1" x1="409.5" x2="451.5" y1="1769.414" y2="1769.414"/><line style="stroke:#a80036;stroke-width:1" x1="451.5" x2="451.5" y1="1769.414" y2="1782.414"/><line style="stroke:#a80036;stroke-width:1" x1="410.5" x2="451.5" y1="1782.414" y2="1782.414"/><polygon fill="#A80036" points="420.5 1778.414 410.5 1782.414 420.5 1786.414 416.5 1782.414" style="stroke:#a80036;stroke-width:1"/><text x="416.5" y="1731.854" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">29</text><text x="434.5" y="1699.151" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114">Validate SAS token</text><text x="434.5" y="1715.503" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124">against SAS key that</text><text x="434.5" y="1731.854" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">was registered when the</text><text x="434.5" y="1748.206" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141">Edge Agent identity was</text><text x="434.5" y="1764.558" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130">created by the runtime</text><polygon fill="#A80036" points="1370.5 1808.766 1380.5 1812.766 1370.5 1816.766 1374.5 1812.766" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="404.5" x2="1376.5" y1="1812.766" y2="1812.766"/><text x="411.5" y="1807.909" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">30</text><text x="429.5" y="1807.909" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19">OK</text><path fill="#EEE" d="M351,1841.7656 L534,1841.7656 L534,1849.7656 L524,1859.7656 L351,1859.7656 L351,1841.7656" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1628.5" height="1941.102" x="351" y="1841.766" fill="none"/><text x="366" y="1856.261" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="138">Edge Agent operation</text><polygon fill="#A80036" points="778.5 1894.82 788.5 1898.82 778.5 1902.82 782.5 1898.82" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="597.5" x2="784.5" y1="1898.82" y2="1898.82"/><text x="604.5" y="1885.788" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">31</text><text x="622.5" y="1877.612" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148">Create module identity for</text><text x="622.5" y="1893.964" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68">Edge Agent</text><polygon fill="#A80036" points="980.5 1941.523 990.5 1945.523 980.5 1949.523 984.5 1945.523" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="1945.523" y2="1945.523"/><text x="807.5" y="1932.491" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">32</text><text x="825.5" y="1924.315" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129">Get master encryption</text><text x="825.5" y="1940.667" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21">key</text><polygon fill="#A80036" points="811.5 1971.875 801.5 1975.875 811.5 1979.875 807.5 1975.875" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="1975.875" y2="1975.875"/><text x="817.5" y="1971.019" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">33</text><text x="835.5" y="1971.019" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">Key handle</text><polygon fill="#A80036" points="980.5 2067.633 990.5 2071.633 980.5 2075.633 984.5 2071.633" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="2071.633" y2="2071.633"/><text x="807.5" y="2034.073" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">34</text><text x="825.5" y="2001.37" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143">Sign Edge Agent&apos;s name</text><text x="825.5" y="2017.722" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145">+ generation ID using the</text><text x="825.5" y="2034.073" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">master encryption key to</text><text x="825.5" y="2050.425" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136">derive Edge Agent SAS</text><text x="825.5" y="2066.776" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28">keys</text><polygon fill="#A80036" points="811.5 2097.984 801.5 2101.984 811.5 2105.984 807.5 2101.984" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="2101.984" y2="2101.984"/><text x="817.5" y="2097.128" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">35</text><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="842.5" y1="2165.039" y2="2165.039"/><line style="stroke:#a80036;stroke-width:1" x1="842.5" x2="842.5" y1="2165.039" y2="2178.039"/><line style="stroke:#a80036;stroke-width:1" x1="801.5" x2="842.5" y1="2178.039" y2="2178.039"/><polygon fill="#A80036" points="811.5 2174.039 801.5 2178.039 811.5 2182.039 807.5 2178.039" style="stroke:#a80036;stroke-width:1"/><text x="807.5" y="2143.831" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">36</text><text x="825.5" y="2127.479" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135">Create TLS client using</text><text x="825.5" y="2143.831" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147">key handle + PEM (using</text><text x="825.5" y="2160.183" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109">openssl-engine-ks)</text><polygon fill="#A80036" points="420.5 2253.445 410.5 2257.445 420.5 2261.445 416.5 2257.445" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="414.5" x2="789.5" y1="2257.445" y2="2257.445"/><text x="426.5" y="2228.061" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">37</text><text x="444.5" y="2203.534" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148">Create module identity for</text><text x="444.5" y="2219.886" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">Edge Agent and register</text><text x="444.5" y="2236.237" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143">the derived SAS keys for</text><text x="444.5" y="2252.589" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7">it</text><polygon fill="#A80036" points="778.5 2283.797 788.5 2287.797 778.5 2291.797 782.5 2287.797" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="404.5" x2="784.5" y1="2287.797" y2="2287.797"/><text x="411.5" y="2282.94" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">38</text><polygon fill="#A80036" points="608.5 2314.148 598.5 2318.148 608.5 2322.148 604.5 2318.148" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="602.5" x2="794.5" y1="2318.148" y2="2318.148"/><text x="614.5" y="2313.292" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">39</text><text x="632.5" y="2313.292" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114">Edge Agent identity</text><polygon fill="#A80036" points="1506.5 2344.5 1516.5 2348.5 1506.5 2352.5 1510.5 2348.5" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="597.5" x2="1512.5" y1="2348.5" y2="2348.5"/><text x="604.5" y="2343.644" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">40</text><text x="622.5" y="2343.644" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93">Create and start</text><rect style="stroke:#a80036;stroke-width:1.5" width="84" height="31.609" x="1518.5" y="2326.148" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="1525.5" y="2347.682" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70">EdgeAgent</text><path fill="#EEE" d="M361,2379.7578 L434,2379.7578 L434,2387.7578 L424,2397.7578 L361,2397.7578 L361,2379.7578" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1386.5" height="680.844" x="361" y="2379.758" fill="none"/><text x="376" y="2394.253" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="449" y="2393.177" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="356">[for getting and renewing SAS token for identifying with IoT Hub]</text><polygon fill="#A80036" points="613.5 2432.813 603.5 2436.813 613.5 2440.813 609.5 2436.813" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="607.5" x2="1561.5" y1="2436.813" y2="2436.813"/><text x="619.5" y="2423.78" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">41</text><text x="637.5" y="2415.604" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106">Get SAS token for</text><text x="637.5" y="2431.956" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133">identifying with IoT Hub</text><polygon fill="#A80036" points="778.5 2495.867 788.5 2499.867 778.5 2503.867 782.5 2499.867" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="784.5" y1="2499.867" y2="2499.867"/><text x="609.5" y="2478.659" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">42</text><text x="627.5" y="2462.308" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">Get SAS token for Edge</text><text x="627.5" y="2478.659" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142">Agent to identify with IoT</text><text x="627.5" y="2495.011" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23">Hub</text><polygon fill="#A80036" points="980.5 2542.57 990.5 2546.57 980.5 2550.57 984.5 2546.57" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="2546.57" y2="2546.57"/><text x="807.5" y="2533.538" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">43</text><text x="825.5" y="2525.362" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129">Get master encryption</text><text x="825.5" y="2541.714" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21">key</text><polygon fill="#A80036" points="811.5 2572.922 801.5 2576.922 811.5 2580.922 807.5 2576.922" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="2576.922" y2="2576.922"/><text x="817.5" y="2572.065" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">44</text><text x="835.5" y="2572.065" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">Key handle</text><polygon fill="#A80036" points="980.5 2668.68 990.5 2672.68 980.5 2676.68 984.5 2672.68" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="2672.68" y2="2672.68"/><text x="807.5" y="2635.12" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">45</text><text x="825.5" y="2602.417" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143">Sign Edge Agent&apos;s name</text><text x="825.5" y="2618.769" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145">+ generation ID using the</text><text x="825.5" y="2635.12" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">master encryption key to</text><text x="825.5" y="2651.472" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136">derive Edge Agent SAS</text><text x="825.5" y="2667.823" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28">keys</text><polygon fill="#A80036" points="811.5 2699.031 801.5 2703.031 811.5 2707.031 807.5 2703.031" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="2703.031" y2="2703.031"/><text x="817.5" y="2698.175" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">46</text><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="842.5" y1="2749.734" y2="2749.734"/><line style="stroke:#a80036;stroke-width:1" x1="842.5" x2="842.5" y1="2749.734" y2="2762.734"/><line style="stroke:#a80036;stroke-width:1" x1="801.5" x2="842.5" y1="2762.734" y2="2762.734"/><polygon fill="#A80036" points="811.5 2758.734 801.5 2762.734 811.5 2766.734 807.5 2762.734" style="stroke:#a80036;stroke-width:1"/><text x="807.5" y="2736.702" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">47</text><text x="825.5" y="2728.526" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134">Create SAS token from</text><text x="825.5" y="2744.878" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52">SAS key</text><polygon fill="#A80036" points="613.5 2789.086 603.5 2793.086 613.5 2797.086 609.5 2793.086" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="607.5" x2="794.5" y1="2793.086" y2="2793.086"/><text x="619.5" y="2788.229" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">48</text><text x="637.5" y="2788.229" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">SAS token</text><polygon fill="#A80036" points="1550.5 2819.438 1560.5 2823.438 1550.5 2827.438 1554.5 2823.438" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="597.5" x2="1556.5" y1="2823.438" y2="2823.438"/><text x="604.5" y="2818.581" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">49</text><text x="622.5" y="2818.581" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">SAS token</text><line style="stroke:#a80036;stroke-width:1" x1="1562.5" x2="1604.5" y1="2870.141" y2="2870.141"/><line style="stroke:#a80036;stroke-width:1" x1="1604.5" x2="1604.5" y1="2870.141" y2="2883.141"/><line style="stroke:#a80036;stroke-width:1" x1="1563.5" x2="1604.5" y1="2883.141" y2="2883.141"/><polygon fill="#A80036" points="1573.5 2879.141 1563.5 2883.141 1573.5 2887.141 1569.5 2883.141" style="stroke:#a80036;stroke-width:1"/><text x="1569.5" y="2857.108" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">50</text><text x="1587.5" y="2848.933" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148">Create IoT Hub client with</text><text x="1587.5" y="2865.284" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">SAS token</text><polygon fill="#A80036" points="420.5 2909.492 410.5 2913.492 420.5 2917.492 416.5 2913.492" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="414.5" x2="1561.5" y1="2913.492" y2="2913.492"/><text x="426.5" y="2908.636" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">51</text><text x="444.5" y="2908.636" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111">Connect to IoT Hub</text><line style="stroke:#a80036;stroke-width:1" x1="409.5" x2="451.5" y1="3009.25" y2="3009.25"/><line style="stroke:#a80036;stroke-width:1" x1="451.5" x2="451.5" y1="3009.25" y2="3022.25"/><line style="stroke:#a80036;stroke-width:1" x1="410.5" x2="451.5" y1="3022.25" y2="3022.25"/><polygon fill="#A80036" points="420.5 3018.25 410.5 3022.25 420.5 3026.25 416.5 3022.25" style="stroke:#a80036;stroke-width:1"/><text x="416.5" y="2971.69" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">52</text><text x="434.5" y="2938.987" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114">Validate SAS token</text><text x="434.5" y="2955.339" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124">against SAS key that</text><text x="434.5" y="2971.69" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">was registered when the</text><text x="434.5" y="2988.042" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141">Edge Agent identity was</text><text x="434.5" y="3004.394" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130">created by the runtime</text><polygon fill="#A80036" points="1550.5 3048.602 1560.5 3052.602 1550.5 3056.602 1554.5 3052.602" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="404.5" x2="1556.5" y1="3052.602" y2="3052.602"/><text x="411.5" y="3047.745" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">53</text><text x="429.5" y="3047.745" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19">OK</text><polygon fill="#A80036" points="420.5 3085.953 410.5 3089.953 420.5 3093.953 416.5 3089.953" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="414.5" x2="1561.5" y1="3089.953" y2="3089.953"/><text x="426.5" y="3085.097" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">54</text><text x="444.5" y="3085.097" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92">Get deployment</text><polygon fill="#A80036" points="1550.5 3116.305 1560.5 3120.305 1550.5 3124.305 1554.5 3120.305" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="404.5" x2="1556.5" y1="3120.305" y2="3120.305"/><text x="411.5" y="3115.448" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">55</text><path fill="#EEE" d="M361,3135.3047 L434,3135.3047 L434,3143.3047 L424,3153.3047 L361,3153.3047 L361,3135.3047" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1255.5" height="529.734" x="361" y="3135.305" fill="none"/><text x="376" y="3149.8" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="449" y="3148.724" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111">[for each module M]</text><polygon fill="#A80036" points="613.5 3188.359 603.5 3192.359 613.5 3196.359 609.5 3192.359" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="607.5" x2="1561.5" y1="3192.359" y2="3192.359"/><text x="619.5" y="3179.327" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">56</text><text x="637.5" y="3171.151" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148">Create identity for module</text><text x="637.5" y="3187.503" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11">M</text><polygon fill="#A80036" points="778.5 3235.063 788.5 3239.063 778.5 3243.063 782.5 3239.063" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="784.5" y1="3239.063" y2="3239.063"/><text x="609.5" y="3226.03" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">57</text><text x="627.5" y="3217.854" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148">Create identity for module</text><text x="627.5" y="3234.206" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11">M</text><polygon fill="#A80036" points="980.5 3281.766 990.5 3285.766 980.5 3289.766 984.5 3285.766" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="3285.766" y2="3285.766"/><text x="807.5" y="3272.733" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">58</text><text x="825.5" y="3264.558" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129">Get master encryption</text><text x="825.5" y="3280.909" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21">key</text><polygon fill="#A80036" points="811.5 3312.117 801.5 3316.117 811.5 3320.117 807.5 3316.117" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="3316.117" y2="3316.117"/><text x="817.5" y="3311.261" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">59</text><text x="835.5" y="3311.261" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">Key handle</text><polygon fill="#A80036" points="980.5 3407.875 990.5 3411.875 980.5 3415.875 984.5 3411.875" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="3411.875" y2="3411.875"/><text x="807.5" y="3374.315" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">60</text><text x="825.5" y="3341.612" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">Sign module M&apos;s name +</text><text x="825.5" y="3357.964" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133">generation ID using the</text><text x="825.5" y="3374.315" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">master encryption key to</text><text x="825.5" y="3390.667" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134">derive module M&apos;s SAS</text><text x="825.5" y="3407.019" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28">keys</text><polygon fill="#A80036" points="811.5 3438.227 801.5 3442.227 811.5 3446.227 807.5 3442.227" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="3442.227" y2="3442.227"/><text x="817.5" y="3437.37" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">61</text><polygon fill="#A80036" points="420.5 3501.281 410.5 3505.281 420.5 3509.281 416.5 3505.281" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="414.5" x2="789.5" y1="3505.281" y2="3505.281"/><text x="426.5" y="3484.073" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">62</text><text x="444.5" y="3467.722" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148">Create identity for module</text><text x="444.5" y="3484.073" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149">M and register the derived</text><text x="444.5" y="3500.425" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88">SAS keys for it</text><polygon fill="#A80036" points="778.5 3531.633 788.5 3535.633 778.5 3539.633 782.5 3535.633" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="404.5" x2="784.5" y1="3535.633" y2="3535.633"/><text x="411.5" y="3530.776" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">63</text><polygon fill="#A80036" points="613.5 3561.984 603.5 3565.984 613.5 3569.984 609.5 3565.984" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="607.5" x2="794.5" y1="3565.984" y2="3565.984"/><text x="619.5" y="3561.128" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">64</text><polygon fill="#A80036" points="1550.5 3592.336 1560.5 3596.336 1550.5 3600.336 1554.5 3596.336" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="597.5" x2="1556.5" y1="3596.336" y2="3596.336"/><text x="604.5" y="3591.479" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">65</text><polygon fill="#A80036" points="613.5 3622.688 603.5 3626.688 613.5 3630.688 609.5 3626.688" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="607.5" x2="1561.5" y1="3626.688" y2="3626.688"/><text x="619.5" y="3621.831" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">66</text><text x="637.5" y="3621.831" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74">Start module</text><polygon fill="#A80036" points="1550.5 3653.039 1560.5 3657.039 1550.5 3661.039 1554.5 3657.039" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="597.5" x2="1556.5" y1="3657.039" y2="3657.039"/><text x="604.5" y="3652.183" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">67</text><polygon fill="#A80036" points="1692.5 3690.391 1702.5 3694.391 1692.5 3698.391 1696.5 3694.391" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="597.5" x2="1698.5" y1="3694.391" y2="3694.391"/><text x="604.5" y="3689.534" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">68</text><text x="622.5" y="3689.534" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89">Start Edge Hub</text><rect style="stroke:#a80036;stroke-width:1.5" width="72" height="31.609" x="1704.5" y="3672.039" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="1711.5" y="3693.572" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58">EdgeHub</text><polygon fill="#A80036" points="1877.5 3737 1887.5 3741 1877.5 3745 1881.5 3741" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="597.5" x2="1883.5" y1="3741" y2="3741"/><text x="604.5" y="3736.144" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">69</text><text x="622.5" y="3736.144" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123">Start Custom module</text><rect style="stroke:#a80036;stroke-width:1.5" width="76" height="49.219" x="1889.5" y="3718.648" fill="#FEFECE" filter="url(#f1jxt8w6krzj03)"/><text x="1896.5" y="3740.182" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62">Container</text><text x="1904.5" y="3757.791" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46">Module</text><path fill="#EEE" d="M10,3796.8672 L181,3796.8672 L181,3804.8672 L171,3814.8672 L10,3814.8672 L10,3796.8672" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1944.5" height="2980.18" x="10" y="3796.867" fill="none"/><text x="25" y="3811.362" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126">Edge Hub operation</text><path fill="#EEE" d="M20,3822.2188 L93,3822.2188 L93,3830.2188 L83,3840.2188 L20,3840.2188 L20,3822.2188" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1780.5" height="2001.117" x="20" y="3822.219" fill="none"/><text x="35" y="3836.714" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="108" y="3835.638" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207">[for server cert request and renewal]</text><path fill="#FBFB77" d="M30,3845.5703 L30,4051.5703 L775,4051.5703 L775,3855.5703 L765,3845.5703 L30,3845.5703" filter="url(#f1jxt8w6krzj03)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M765,3845.5703 L765,3855.5703 L775,3855.5703 L765,3845.5703" style="stroke:#a80036;stroke-width:1"/><text x="36" y="3864.065" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="482">While it is possible to make an openssl engine (like openssl-engine-ks) for modules</text><text x="36" y="3880.417" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="539">that performs key operations using the KS, it is not feasible to expect all modules to be using</text><text x="36" y="3896.769" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="580">openssl for TLS, especially Windows modules. Thus modules need to have the raw private key bytes</text><text x="36" y="3913.12" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239">to be able to serve TLS with a server cert.</text><text x="36" y="3945.823" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="537">For this reason, the private keys of module server certs are not persisted using Keys Service.</text><text x="36" y="3978.526" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="631">Also, note that a single server cert is shared between all modules, and its lifetime is managed by the runtime.</text><text x="36" y="3994.878" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="724">This is because the user may have module server certs rooted to public CAs, so it would cost the customer $$$ for each cert.</text><text x="36" y="4011.229" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="655">Thus we do not want to request a new server cert when a previously requested cert is still valid, which also means</text><text x="36" y="4027.581" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="721">we want to dedupe the server certs across all modules that want them. Since server certs are issued for the device hostname</text><text x="36" y="4043.933" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="401">anyway, reusing the server cert for multiple modules is not a concern.</text><path fill="#EEE" d="M176,4067.7891 L237,4067.7891 L237,4075.7891 L227,4085.7891 L176,4085.7891 L176,4067.7891" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1614.5" height="1748.547" x="176" y="4067.789" fill="none"/><text x="191" y="4082.284" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16">alt</text><text x="252" y="4081.208" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="224">[if server cert already exists and is valid]</text><polygon fill="#A80036" points="613.5 4104.492 603.5 4108.492 613.5 4112.492 609.5 4108.492" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="607.5" x2="1741.5" y1="4108.492" y2="4108.492"/><text x="619.5" y="4103.636" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">70</text><text x="637.5" y="4103.636" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85">Get server cert</text><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="644.5" y1="4138.844" y2="4138.844"/><line style="stroke:#a80036;stroke-width:1" x1="644.5" x2="644.5" y1="4138.844" y2="4151.844"/><line style="stroke:#a80036;stroke-width:1" x1="603.5" x2="644.5" y1="4151.844" y2="4151.844"/><polygon fill="#A80036" points="613.5 4147.844 603.5 4151.844 613.5 4155.844 609.5 4151.844" style="stroke:#a80036;stroke-width:1"/><text x="609.5" y="4133.987" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">71</text><text x="627.5" y="4133.987" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142">Get persisted server cert</text><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="644.5" y1="4182.195" y2="4182.195"/><line style="stroke:#a80036;stroke-width:1" x1="644.5" x2="644.5" y1="4182.195" y2="4195.195"/><line style="stroke:#a80036;stroke-width:1" x1="603.5" x2="644.5" y1="4195.195" y2="4195.195"/><polygon fill="#A80036" points="613.5 4191.195 603.5 4195.195 613.5 4199.195 609.5 4195.195" style="stroke:#a80036;stroke-width:1"/><text x="609.5" y="4177.339" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">72</text><text x="627.5" y="4177.339" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105">Server cert is valid</text><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="644.5" y1="4241.898" y2="4241.898"/><line style="stroke:#a80036;stroke-width:1" x1="644.5" x2="644.5" y1="4241.898" y2="4254.898"/><line style="stroke:#a80036;stroke-width:1" x1="603.5" x2="644.5" y1="4254.898" y2="4254.898"/><polygon fill="#A80036" points="613.5 4250.898 603.5 4254.898 613.5 4258.898 609.5 4254.898" style="stroke:#a80036;stroke-width:1"/><text x="609.5" y="4228.866" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">73</text><text x="627.5" y="4220.69" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116">Get persisted server</text><text x="627.5" y="4237.042" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97">cert&apos;s private key</text><polygon fill="#A80036" points="1730.5 4297.602 1740.5 4301.602 1730.5 4305.602 1734.5 4301.602" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="597.5" x2="1736.5" y1="4301.602" y2="4301.602"/><text x="604.5" y="4288.569" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">74</text><text x="622.5" y="4280.394" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128">Server cert and private</text><text x="622.5" y="4296.745" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21">key</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="176" x2="1790.5" y1="4310.602" y2="4310.602"/><text x="181" y="4322.02" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235">[if server cert does not exist or is expired]</text><polygon fill="#A80036" points="613.5 4343.789 603.5 4347.789 613.5 4351.789 609.5 4347.789" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="607.5" x2="1741.5" y1="4347.789" y2="4347.789"/><text x="619.5" y="4342.933" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">75</text><text x="637.5" y="4342.933" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85">Get server cert</text><path fill="#EEE" d="M527.5,4362.7891 L588.5,4362.7891 L588.5,4370.7891 L578.5,4380.7891 L527.5,4380.7891 L527.5,4362.7891" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="291" height="223.945" x="527.5" y="4362.789" fill="none"/><text x="542.5" y="4377.284" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16">alt</text><text x="603.5" y="4376.208" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162">[if server cert does not exist]</text><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="644.5" y1="4403.492" y2="4403.492"/><line style="stroke:#a80036;stroke-width:1" x1="644.5" x2="644.5" y1="4403.492" y2="4416.492"/><line style="stroke:#a80036;stroke-width:1" x1="603.5" x2="644.5" y1="4416.492" y2="4416.492"/><polygon fill="#A80036" points="613.5 4412.492 603.5 4416.492 613.5 4420.492 609.5 4416.492" style="stroke:#a80036;stroke-width:1"/><text x="609.5" y="4398.636" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">76</text><text x="627.5" y="4398.636" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142">Get persisted server cert</text><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="644.5" y1="4446.844" y2="4446.844"/><line style="stroke:#a80036;stroke-width:1" x1="644.5" x2="644.5" y1="4446.844" y2="4459.844"/><line style="stroke:#a80036;stroke-width:1" x1="603.5" x2="644.5" y1="4459.844" y2="4459.844"/><polygon fill="#A80036" points="613.5 4455.844 603.5 4459.844 613.5 4463.844 609.5 4459.844" style="stroke:#a80036;stroke-width:1"/><text x="609.5" y="4441.987" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">77</text><text x="627.5" y="4441.987" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133">Server cert is not found</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="527.5" x2="818.5" y1="4468.844" y2="4468.844"/><text x="532.5" y="4480.263" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286">[if server cert exists but is expired / close to expiry]</text><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="644.5" y1="4506.031" y2="4506.031"/><line style="stroke:#a80036;stroke-width:1" x1="644.5" x2="644.5" y1="4506.031" y2="4519.031"/><line style="stroke:#a80036;stroke-width:1" x1="603.5" x2="644.5" y1="4519.031" y2="4519.031"/><polygon fill="#A80036" points="613.5 4515.031 603.5 4519.031 613.5 4523.031 609.5 4519.031" style="stroke:#a80036;stroke-width:1"/><text x="609.5" y="4501.175" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">78</text><text x="627.5" y="4501.175" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142">Get persisted server cert</text><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="644.5" y1="4565.734" y2="4565.734"/><line style="stroke:#a80036;stroke-width:1" x1="644.5" x2="644.5" y1="4565.734" y2="4578.734"/><line style="stroke:#a80036;stroke-width:1" x1="603.5" x2="644.5" y1="4578.734" y2="4578.734"/><polygon fill="#A80036" points="613.5 4574.734 603.5 4578.734 613.5 4582.734 609.5 4578.734" style="stroke:#a80036;stroke-width:1"/><text x="609.5" y="4552.702" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">79</text><text x="627.5" y="4544.526" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130">Server cert is expired /</text><text x="627.5" y="4560.878" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85">close to expiry</text><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="644.5" y1="4632.438" y2="4632.438"/><line style="stroke:#a80036;stroke-width:1" x1="644.5" x2="644.5" y1="4632.438" y2="4645.438"/><line style="stroke:#a80036;stroke-width:1" x1="603.5" x2="644.5" y1="4645.438" y2="4645.438"/><polygon fill="#A80036" points="613.5 4641.438 603.5 4645.438 613.5 4649.438 609.5 4645.438" style="stroke:#a80036;stroke-width:1"/><text x="609.5" y="4619.405" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">80</text><text x="627.5" y="4611.23" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137">Create new asymmetric</text><text x="627.5" y="4627.581" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119">key pair (in memory)</text><polygon fill="#A80036" points="1171.5 4688.141 1181.5 4692.141 1171.5 4696.141 1175.5 4692.141" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="1177.5" y1="4692.141" y2="4692.141"/><text x="609.5" y="4679.108" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">81</text><text x="627.5" y="4670.933" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121">Request new module</text><text x="627.5" y="4687.284" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60">server cert</text><line style="stroke:#a80036;stroke-width:1" x1="1193.5" x2="1235.5" y1="4755.195" y2="4755.195"/><line style="stroke:#a80036;stroke-width:1" x1="1235.5" x2="1235.5" y1="4755.195" y2="4768.195"/><line style="stroke:#a80036;stroke-width:1" x1="1194.5" x2="1235.5" y1="4768.195" y2="4768.195"/><polygon fill="#A80036" points="1204.5 4764.195 1194.5 4768.195 1204.5 4772.195 1200.5 4768.195" style="stroke:#a80036;stroke-width:1"/><text x="1200.5" y="4733.987" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">82</text><text x="1218.5" y="4717.636" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114">Create CSR for new</text><text x="1218.5" y="4733.987" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141">module server cert using</text><text x="1218.5" y="4750.339" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21">key</text><line style="stroke:#a80036;stroke-width:1" x1="1193.5" x2="1240.5" y1="4793.547" y2="4793.547"/><line style="stroke:#a80036;stroke-width:1" x1="1240.5" x2="1240.5" y1="4793.547" y2="4806.547"/><line style="stroke:#a80036;stroke-width:1" x1="1199.5" x2="1240.5" y1="4806.547" y2="4806.547"/><polygon fill="#A80036" points="1209.5 4802.547 1199.5 4806.547 1209.5 4810.547 1205.5 4806.547" style="stroke:#a80036;stroke-width:1"/><text x="1205.5" y="4788.69" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">83</text><text x="1223.5" y="4788.69" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131">Get module server cert</text><path fill="#EEE" d="M186,4826.5469 L247,4826.5469 L247,4834.5469 L237,4844.5469 L186,4844.5469 L186,4826.5469" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1198.5" height="726.625" x="186" y="4826.547" fill="none"/><text x="201" y="4841.042" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16">alt</text><text x="262" y="4839.966" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="230">[if module certs should be issued by EST]</text><polygon fill="#A80036" points="1013.5 4879.602 1003.5 4883.602 1013.5 4887.602 1009.5 4883.602" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1007.5" x2="1187.5" y1="4883.602" y2="4883.602"/><text x="1019.5" y="4870.569" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">84</text><text x="1037.5" y="4862.394" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">Get current EST identity</text><text x="1037.5" y="4878.745" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97">cert&apos;s private key</text><polygon fill="#A80036" points="1176.5 4909.953 1186.5 4913.953 1176.5 4917.953 1180.5 4913.953" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="997.5" x2="1182.5" y1="4913.953" y2="4913.953"/><text x="1004.5" y="4909.097" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">85</text><text x="1022.5" y="4909.097" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">Key handle</text><line style="stroke:#a80036;stroke-width:1" x1="1198.5" x2="1245.5" y1="4955.656" y2="4955.656"/><line style="stroke:#a80036;stroke-width:1" x1="1245.5" x2="1245.5" y1="4955.656" y2="4968.656"/><line style="stroke:#a80036;stroke-width:1" x1="1204.5" x2="1245.5" y1="4968.656" y2="4968.656"/><polygon fill="#A80036" points="1214.5 4964.656 1204.5 4968.656 1214.5 4972.656 1210.5 4968.656" style="stroke:#a80036;stroke-width:1"/><text x="1210.5" y="4942.624" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">86</text><text x="1228.5" y="4934.448" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">Get current EST identity</text><text x="1228.5" y="4950.8" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22">cert</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1203.5" x2="1245.5" y1="5009.008" y2="5009.008"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1245.5" x2="1245.5" y1="5009.008" y2="5022.008"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1198.5" x2="1245.5" y1="5022.008" y2="5022.008"/><polygon fill="#A80036" points="1208.5 5018.008 1198.5 5022.008 1208.5 5026.008 1204.5 5022.008" style="stroke:#a80036;stroke-width:1"/><text x="1210.5" y="5004.151" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">87</text><text x="1228.5" y="5004.151" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29">PEM</text><line style="stroke:#a80036;stroke-width:1" x1="1198.5" x2="1240.5" y1="5080.063" y2="5080.063"/><line style="stroke:#a80036;stroke-width:1" x1="1240.5" x2="1240.5" y1="5080.063" y2="5093.063"/><line style="stroke:#a80036;stroke-width:1" x1="1199.5" x2="1240.5" y1="5093.063" y2="5093.063"/><polygon fill="#A80036" points="1209.5 5089.063 1199.5 5093.063 1209.5 5097.063 1205.5 5093.063" style="stroke:#a80036;stroke-width:1"/><text x="1205.5" y="5058.855" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">88</text><text x="1223.5" y="5042.503" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135">Create TLS client using</text><text x="1223.5" y="5058.855" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147">key handle + PEM (using</text><text x="1223.5" y="5075.206" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109">openssl-engine-ks)</text><polygon fill="#A80036" points="234.5 5168.469 224.5 5172.469 234.5 5176.469 230.5 5172.469" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="228.5" x2="1187.5" y1="5172.469" y2="5172.469"/><text x="240.5" y="5143.085" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">89</text><text x="258.5" y="5118.558" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145">Connect using TLS client</text><text x="258.5" y="5134.909" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145">and send request for new</text><text x="258.5" y="5151.261" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106">module server cert</text><text x="258.5" y="5167.612" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149">corresponding to the CSR</text><line style="stroke:#a80036;stroke-width:1" x1="223.5" x2="265.5" y1="5219.172" y2="5219.172"/><line style="stroke:#a80036;stroke-width:1" x1="265.5" x2="265.5" y1="5219.172" y2="5232.172"/><line style="stroke:#a80036;stroke-width:1" x1="224.5" x2="265.5" y1="5232.172" y2="5232.172"/><polygon fill="#A80036" points="234.5 5228.172 224.5 5232.172 234.5 5236.172 230.5 5232.172" style="stroke:#a80036;stroke-width:1"/><text x="230.5" y="5206.14" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">90</text><text x="248.5" y="5197.964" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">Verify client cert against</text><text x="248.5" y="5214.315" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18">CA</text><line style="stroke:#a80036;stroke-width:1" x1="223.5" x2="265.5" y1="5262.523" y2="5262.523"/><line style="stroke:#a80036;stroke-width:1" x1="265.5" x2="265.5" y1="5262.523" y2="5275.523"/><line style="stroke:#a80036;stroke-width:1" x1="224.5" x2="265.5" y1="5275.523" y2="5275.523"/><polygon fill="#A80036" points="234.5 5271.523 224.5 5275.523 234.5 5279.523 230.5 5275.523" style="stroke:#a80036;stroke-width:1"/><text x="230.5" y="5257.667" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">91</text><text x="248.5" y="5257.667" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57">Sign CSR</text><polygon fill="#A80036" points="1176.5 5301.875 1186.5 5305.875 1176.5 5309.875 1180.5 5305.875" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="218.5" x2="1182.5" y1="5305.875" y2="5305.875"/><text x="225.5" y="5301.019" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">92</text><text x="243.5" y="5301.019" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104">Signed server cert</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="186" x2="1384.5" y1="5314.875" y2="5314.875"/><text x="191" y="5326.294" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="229">[if module certs should be minted locally]</text><polygon fill="#A80036" points="1013.5 5364.414 1003.5 5368.414 1013.5 5372.414 1009.5 5368.414" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1007.5" x2="1187.5" y1="5368.414" y2="5368.414"/><text x="1019.5" y="5355.382" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">93</text><text x="1037.5" y="5347.206" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118">Get device CA cert&apos;s</text><text x="1037.5" y="5363.558" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62">private key</text><polygon fill="#A80036" points="1176.5 5394.766 1186.5 5398.766 1176.5 5402.766 1180.5 5398.766" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="997.5" x2="1182.5" y1="5398.766" y2="5398.766"/><text x="1004.5" y="5393.909" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">94</text><text x="1022.5" y="5393.909" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">Key handle</text><line style="stroke:#a80036;stroke-width:1" x1="1198.5" x2="1245.5" y1="5424.117" y2="5424.117"/><line style="stroke:#a80036;stroke-width:1" x1="1245.5" x2="1245.5" y1="5424.117" y2="5437.117"/><line style="stroke:#a80036;stroke-width:1" x1="1204.5" x2="1245.5" y1="5437.117" y2="5437.117"/><polygon fill="#A80036" points="1214.5 5433.117 1204.5 5437.117 1214.5 5441.117 1210.5 5437.117" style="stroke:#a80036;stroke-width:1"/><text x="1210.5" y="5419.261" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">95</text><text x="1228.5" y="5419.261" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109">Get device CA cert</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1203.5" x2="1245.5" y1="5477.469" y2="5477.469"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1245.5" x2="1245.5" y1="5477.469" y2="5490.469"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1198.5" x2="1245.5" y1="5490.469" y2="5490.469"/><polygon fill="#A80036" points="1208.5 5486.469 1198.5 5490.469 1208.5 5494.469 1204.5 5490.469" style="stroke:#a80036;stroke-width:1"/><text x="1210.5" y="5472.612" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">96</text><text x="1228.5" y="5472.612" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29">PEM</text><line style="stroke:#a80036;stroke-width:1" x1="1198.5" x2="1240.5" y1="5532.172" y2="5532.172"/><line style="stroke:#a80036;stroke-width:1" x1="1240.5" x2="1240.5" y1="5532.172" y2="5545.172"/><line style="stroke:#a80036;stroke-width:1" x1="1199.5" x2="1240.5" y1="5545.172" y2="5545.172"/><polygon fill="#A80036" points="1209.5 5541.172 1199.5 5545.172 1209.5 5549.172 1205.5 5545.172" style="stroke:#a80036;stroke-width:1"/><text x="1205.5" y="5519.14" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">97</text><text x="1223.5" y="5510.964" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132">Sign CSR using device</text><text x="1223.5" y="5527.315" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44">CA cert</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1198.5" x2="1240.5" y1="5587.523" y2="5587.523"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1240.5" x2="1240.5" y1="5587.523" y2="5600.523"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1193.5" x2="1240.5" y1="5600.523" y2="5600.523"/><polygon fill="#A80036" points="1203.5 5596.523 1193.5 5600.523 1203.5 5604.523 1199.5 5600.523" style="stroke:#a80036;stroke-width:1"/><text x="1205.5" y="5582.667" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">98</text><text x="1223.5" y="5582.667" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104">Signed server cert</text><polygon fill="#A80036" points="613.5 5621.875 603.5 5625.875 613.5 5629.875 609.5 5625.875" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="607.5" x2="1187.5" y1="5625.875" y2="5625.875"/><text x="619.5" y="5621.019" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">99</text><text x="637.5" y="5621.019" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104">Signed server cert</text><polygon fill="#A80036" points="1730.5 5652.227 1740.5 5656.227 1730.5 5660.227 1734.5 5656.227" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="597.5" x2="1736.5" y1="5656.227" y2="5656.227"/><text x="604.5" y="5651.37" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">100</text><text x="629.5" y="5651.37" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104">Signed server cert</text><line style="stroke:#a80036;stroke-width:1" x1="597.5" x2="639.5" y1="5702.93" y2="5702.93"/><line style="stroke:#a80036;stroke-width:1" x1="639.5" x2="639.5" y1="5702.93" y2="5715.93"/><line style="stroke:#a80036;stroke-width:1" x1="598.5" x2="639.5" y1="5715.93" y2="5715.93"/><polygon fill="#A80036" points="608.5 5711.93 598.5 5715.93 608.5 5719.93 604.5 5715.93" style="stroke:#a80036;stroke-width:1"/><text x="604.5" y="5689.898" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">101</text><text x="629.5" y="5681.722" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134">Save key pair as server</text><text x="629.5" y="5698.073" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88">cert private key</text><line style="stroke:#a80036;stroke-width:1" x1="597.5" x2="639.5" y1="5795.336" y2="5795.336"/><line style="stroke:#a80036;stroke-width:1" x1="639.5" x2="639.5" y1="5795.336" y2="5808.336"/><line style="stroke:#a80036;stroke-width:1" x1="598.5" x2="639.5" y1="5808.336" y2="5808.336"/><polygon fill="#A80036" points="608.5 5804.336 598.5 5808.336 608.5 5812.336 604.5 5808.336" style="stroke:#a80036;stroke-width:1"/><text x="604.5" y="5765.952" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">102</text><text x="629.5" y="5741.425" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">Save signed cert so that</text><text x="629.5" y="5757.776" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120">it can be retrieved for</text><text x="629.5" y="5774.128" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142">future module server cert</text><text x="629.5" y="5790.48" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50">requests</text><path fill="#EEE" d="M351,5837.3359 L517,5837.3359 L517,5845.3359 L507,5855.3359 L351,5855.3359 L351,5837.3359" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1593.5" height="932.711" x="351" y="5837.336" fill="none"/><text x="366" y="5851.831" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121">Connect to IoT Hub</text><path fill="#EEE" d="M361,5862.6875 L434,5862.6875 L434,5870.6875 L424,5880.6875 L361,5880.6875 L361,5862.6875" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1573.5" height="900.359" x="361" y="5862.688" fill="none"/><text x="376" y="5877.183" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="449" y="5876.106" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="356">[for getting and renewing SAS token for identifying with IoT Hub]</text><polygon fill="#A80036" points="613.5 5899.391 603.5 5903.391 613.5 5907.391 609.5 5903.391" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="607.5" x2="1741.5" y1="5903.391" y2="5903.391"/><text x="619.5" y="5898.534" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">103</text><text x="644.5" y="5898.534" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111">Get IoTHub identity</text><polygon fill="#A80036" points="778.5 5929.742 788.5 5933.742 778.5 5937.742 782.5 5933.742" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="784.5" y1="5933.742" y2="5933.742"/><text x="609.5" y="5928.886" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">104</text><text x="634.5" y="5928.886" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111">Get IoTHub identity</text><polygon fill="#A80036" points="613.5 6009.148 603.5 6013.148 613.5 6017.148 609.5 6013.148" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="607.5" x2="794.5" y1="6013.148" y2="6013.148"/><text x="619.5" y="5983.765" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">105</text><text x="644.5" y="5959.237" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126">Identity info (IoTHub +</text><text x="644.5" y="5975.589" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94">device identity +</text><text x="644.5" y="5991.94" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88">generation ID +</text><text x="644.5" y="6008.292" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96">credentials type)</text><polygon fill="#A80036" points="1730.5 6088.555 1740.5 6092.555 1730.5 6096.555 1734.5 6092.555" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="597.5" x2="1736.5" y1="6092.555" y2="6092.555"/><text x="604.5" y="6063.171" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">106</text><text x="629.5" y="6038.644" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126">Identity info (IoTHub +</text><text x="629.5" y="6054.995" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94">device identity +</text><text x="629.5" y="6071.347" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88">generation ID +</text><text x="629.5" y="6087.698" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96">credentials type)</text><polygon fill="#A80036" points="613.5 6135.258 603.5 6139.258 613.5 6143.258 609.5 6139.258" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="607.5" x2="1741.5" y1="6139.258" y2="6139.258"/><text x="619.5" y="6126.226" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">107</text><text x="644.5" y="6118.05" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106">Get SAS token for</text><text x="644.5" y="6134.401" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133">identifying with IoT Hub</text><polygon fill="#A80036" points="778.5 6198.313 788.5 6202.313 778.5 6206.313 782.5 6202.313" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="602.5" x2="784.5" y1="6202.313" y2="6202.313"/><text x="609.5" y="6181.105" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">108</text><text x="634.5" y="6164.753" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">Get SAS token for Edge</text><text x="634.5" y="6181.105" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131">Hub to identify with IoT</text><text x="634.5" y="6197.456" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23">Hub</text><polygon fill="#A80036" points="980.5 6245.016 990.5 6249.016 980.5 6253.016 984.5 6249.016" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="6249.016" y2="6249.016"/><text x="807.5" y="6235.983" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">109</text><text x="832.5" y="6227.808" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129">Get master encryption</text><text x="832.5" y="6244.159" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21">key</text><polygon fill="#A80036" points="811.5 6275.367 801.5 6279.367 811.5 6283.367 807.5 6279.367" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="6279.367" y2="6279.367"/><text x="817.5" y="6274.511" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">110</text><text x="842.5" y="6274.511" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">Key handle</text><polygon fill="#A80036" points="980.5 6371.125 990.5 6375.125 980.5 6379.125 984.5 6375.125" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="986.5" y1="6375.125" y2="6375.125"/><text x="807.5" y="6337.565" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">111</text><text x="832.5" y="6304.862" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">Sign Edge Hub&apos;s name +</text><text x="832.5" y="6321.214" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133">generation ID using the</text><text x="832.5" y="6337.565" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">master encryption key to</text><text x="832.5" y="6353.917" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125">derive Edge Hub SAS</text><text x="832.5" y="6370.269" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28">keys</text><polygon fill="#A80036" points="811.5 6401.477 801.5 6405.477 811.5 6409.477 807.5 6405.477" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="805.5" x2="996.5" y1="6405.477" y2="6405.477"/><text x="817.5" y="6400.62" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">112</text><line style="stroke:#a80036;stroke-width:1" x1="800.5" x2="842.5" y1="6452.18" y2="6452.18"/><line style="stroke:#a80036;stroke-width:1" x1="842.5" x2="842.5" y1="6452.18" y2="6465.18"/><line style="stroke:#a80036;stroke-width:1" x1="801.5" x2="842.5" y1="6465.18" y2="6465.18"/><polygon fill="#A80036" points="811.5 6461.18 801.5 6465.18 811.5 6469.18 807.5 6465.18" style="stroke:#a80036;stroke-width:1"/><text x="807.5" y="6439.148" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">113</text><text x="832.5" y="6430.972" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134">Create SAS token from</text><text x="832.5" y="6447.323" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52">SAS key</text><polygon fill="#A80036" points="613.5 6491.531 603.5 6495.531 613.5 6499.531 609.5 6495.531" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="607.5" x2="794.5" y1="6495.531" y2="6495.531"/><text x="619.5" y="6490.675" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">114</text><text x="644.5" y="6490.675" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">SAS token</text><polygon fill="#A80036" points="1730.5 6521.883 1740.5 6525.883 1730.5 6529.883 1734.5 6525.883" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="597.5" x2="1736.5" y1="6525.883" y2="6525.883"/><text x="604.5" y="6521.026" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">115</text><text x="629.5" y="6521.026" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">SAS token</text><line style="stroke:#a80036;stroke-width:1" x1="1742.5" x2="1784.5" y1="6572.586" y2="6572.586"/><line style="stroke:#a80036;stroke-width:1" x1="1784.5" x2="1784.5" y1="6572.586" y2="6585.586"/><line style="stroke:#a80036;stroke-width:1" x1="1743.5" x2="1784.5" y1="6585.586" y2="6585.586"/><polygon fill="#A80036" points="1753.5 6581.586 1743.5 6585.586 1753.5 6589.586 1749.5 6585.586" style="stroke:#a80036;stroke-width:1"/><text x="1749.5" y="6559.554" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">116</text><text x="1774.5" y="6551.378" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148">Create IoT Hub client with</text><text x="1774.5" y="6567.73" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">SAS token</text><polygon fill="#A80036" points="420.5 6611.938 410.5 6615.938 420.5 6619.938 416.5 6615.938" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="414.5" x2="1741.5" y1="6615.938" y2="6615.938"/><text x="426.5" y="6611.081" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">117</text><text x="451.5" y="6611.081" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111">Connect to IoT Hub</text><line style="stroke:#a80036;stroke-width:1" x1="409.5" x2="451.5" y1="6711.695" y2="6711.695"/><line style="stroke:#a80036;stroke-width:1" x1="451.5" x2="451.5" y1="6711.695" y2="6724.695"/><line style="stroke:#a80036;stroke-width:1" x1="410.5" x2="451.5" y1="6724.695" y2="6724.695"/><polygon fill="#A80036" points="420.5 6720.695 410.5 6724.695 420.5 6728.695 416.5 6724.695" style="stroke:#a80036;stroke-width:1"/><text x="416.5" y="6674.136" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">118</text><text x="441.5" y="6641.433" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114">Validate SAS token</text><text x="441.5" y="6657.784" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124">against SAS key that</text><text x="441.5" y="6674.136" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140">was registered when the</text><text x="441.5" y="6690.487" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130">Edge Hub identity was</text><text x="441.5" y="6706.839" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130">created by the runtime</text><polygon fill="#A80036" points="1730.5 6751.047 1740.5 6755.047 1730.5 6759.047 1734.5 6755.047" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="404.5" x2="1736.5" y1="6755.047" y2="6755.047"/><text x="411.5" y="6750.19" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21">119</text><text x="436.5" y="6750.19" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19">OK</text></g></svg>