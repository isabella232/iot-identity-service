<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1352" height="3691" contentScriptType="application/ecmascript" contentStyleType="text/css" style="width:1352px;height:3691px" preserveAspectRatio="none" version="1.1" viewBox="0 0 1352 3691" zoomAndPan="magnify"><defs><filter id="f1vnohgqi0p9s0" width="300%" height="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text x="582.5" y="26.699" fill="#000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="181">MR Runtime Operation</text><rect style="stroke:#a80036;stroke-width:1" width="10" height="706.266" x="47.5" y="1289.641" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="691.031" x="47.5" y="2086.844" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="307.813" x="47.5" y="2838.344" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="298.5" y="1057.594" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="295.047" x="298.5" y="1334.109" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="295.047" x="298.5" y="2131.313" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="298.5" y="3268.328" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="298.5" y="3477.438" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="514.5" y="187.438" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="514.5" y="409.313" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="87.703" x="514.5" y="580.953" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="87.703" x="514.5" y="843.953" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="87.703" x="514.5" y="2999.984" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="128.969" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="350.844" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="610.188" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="873.188" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="1436.047" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="74.938" x="682.5" y="1524.984" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="277.813" x="682.5" y="1688.859" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="2233.25" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="74.938" x="682.5" y="2322.188" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="262.578" x="682.5" y="2486.063" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="3029.219" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="3357.266" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="3581.609" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="924.5" y="245.906" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="924.5" y="483.016" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="924.5" y="697.891" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="924.5" y="960.891" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="249.344" x="924.5" y="2867.578" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#000;stroke-width:2" width="934.5" height="192.641" x="23" y="90.5" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#000;stroke-width:2" width="954.5" height="707.984" x="13" y="297.141" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#000;stroke-width:2" width="934.5" height="470.875" x="23" y="527.25" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:none;stroke-width:1" width="934.5" height="263" x="23" y="735.125" fill="#FFF"/><rect style="stroke:#000;stroke-width:2" width="1186" height="163.344" x="23" y="1019.125" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#000;stroke-width:2" width="1206" height="1964.688" x="13" y="1196.469" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#000;stroke-width:2" width="1186" height="783.203" x="23" y="1220.703" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#000;stroke-width:2" width="1186" height="767.969" x="23" y="2017.906" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#000;stroke-width:2" width="1186" height="354.281" x="23" y="2799.875" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#000;stroke-width:2" width="1064.5" height="450.688" x="268.5" y="3175.156" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#000;stroke-width:2" width="1044.5" height="195.109" x="278.5" y="3199.391" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#000;stroke-width:2" width="1044.5" height="210.344" x="278.5" y="3408.5" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="52" x2="52" y1="73.5" y2="3642.844"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="303.5" x2="303.5" y1="73.5" y2="3642.844"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="519" x2="519" y1="73.5" y2="3642.844"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="687" x2="687" y1="73.5" y2="3642.844"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="929.5" x2="929.5" y1="73.5" y2="3642.844"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1166" x2="1166" y1="1169.766" y2="3642.844"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1261" x2="1261" y1="73.5" y2="3642.844"/><rect style="stroke:#a80036;stroke-width:1.5" width="35" height="30.406" x="33" y="38.094" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="40" y="58.082" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21">MR</text><rect style="stroke:#a80036;stroke-width:1.5" width="35" height="30.406" x="33" y="3641.844" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="40" y="3661.832" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21">MR</text><rect style="stroke:#a80036;stroke-width:1.5" width="26" height="30.406" x="288.5" y="38.094" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="295.5" y="58.082" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12">IS</text><rect style="stroke:#a80036;stroke-width:1.5" width="26" height="30.406" x="288.5" y="3641.844" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="295.5" y="3661.832" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12">IS</text><rect style="stroke:#a80036;stroke-width:1.5" width="133" height="30.406" x="451" y="38.094" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="458" y="58.082" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119">openssl-engine-ks</text><rect style="stroke:#a80036;stroke-width:1.5" width="133" height="30.406" x="451" y="3641.844" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="458" y="3661.832" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119">openssl-engine-ks</text><rect style="stroke:#a80036;stroke-width:1.5" width="31" height="30.406" x="670" y="38.094" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="677" y="58.082" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17">KS</text><rect style="stroke:#a80036;stroke-width:1.5" width="31" height="30.406" x="670" y="3641.844" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="677" y="3661.832" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17">KS</text><rect style="stroke:#a80036;stroke-width:1.5" width="32" height="30.406" x="911.5" y="38.094" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="918.5" y="58.082" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18">CS</text><rect style="stroke:#a80036;stroke-width:1.5" width="32" height="30.406" x="911.5" y="3641.844" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="918.5" y="3661.832" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18">CS</text><rect style="stroke:#a80036;stroke-width:1.5" width="61" height="30.406" x="1134" y="3641.844" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="1141" y="3661.832" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47">Module</text><rect style="stroke:#a80036;stroke-width:1.5" width="100" height="30.406" x="1209" y="38.094" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="1216" y="58.082" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86">Host_Module</text><rect style="stroke:#a80036;stroke-width:1.5" width="100" height="30.406" x="1209" y="3641.844" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="1216" y="3661.832" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86">Host_Module</text><rect style="stroke:#a80036;stroke-width:1" width="10" height="706.266" x="47.5" y="1289.641" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="691.031" x="47.5" y="2086.844" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="307.813" x="47.5" y="2838.344" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="298.5" y="1057.594" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="295.047" x="298.5" y="1334.109" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="295.047" x="298.5" y="2131.313" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="298.5" y="3268.328" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="298.5" y="3477.438" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="514.5" y="187.438" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="514.5" y="409.313" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="87.703" x="514.5" y="580.953" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="87.703" x="514.5" y="843.953" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="87.703" x="514.5" y="2999.984" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="128.969" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="350.844" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="610.188" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="873.188" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="1436.047" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="74.938" x="682.5" y="1524.984" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="277.813" x="682.5" y="1688.859" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="2233.25" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="74.938" x="682.5" y="2322.188" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="262.578" x="682.5" y="2486.063" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="3029.219" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="3357.266" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="682.5" y="3581.609" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="924.5" y="245.906" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="924.5" y="483.016" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="924.5" y="697.891" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="924.5" y="960.891" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="249.344" x="924.5" y="2867.578" fill="#FFF" filter="url(#f1vnohgqi0p9s0)"/><path fill="#EEE" d="M23,90.5 L131,90.5 L131,97.5 L121,107.5 L23,107.5 L23,90.5" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="934.5" height="192.641" x="23" y="90.5" fill="none"/><text x="38" y="103.561" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63">Device CA</text><polygon fill="#A80036" points="670.5 124.969 680.5 128.969 670.5 132.969 674.5 128.969" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="676.5" y1="128.969" y2="128.969"/><text x="59.5" y="123.795" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">1</text><text x="70.5" y="123.795" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157">load_key_pair(&quot;device_ca&quot;)</text><polygon fill="#A80036" points="63.5 154.203 53.5 158.203 63.5 162.203 59.5 158.203" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="686.5" y1="158.203" y2="158.203"/><text x="69.5" y="153.029" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">2</text><text x="80.5" y="153.029" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98">OK(&quot;key handle&quot;)</text><polygon fill="#A80036" points="502.5 183.438 512.5 187.438 502.5 191.438 506.5 187.438" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="508.5" y1="187.438" y2="187.438"/><text x="59.5" y="182.264" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">3</text><text x="70.5" y="182.264" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178">load_private_key(&quot;key handle&quot;)</text><polygon fill="#A80036" points="63.5 212.672 53.5 216.672 63.5 220.672 59.5 216.672" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="518.5" y1="216.672" y2="216.672"/><text x="69.5" y="211.498" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">4</text><text x="80.5" y="211.498" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110">openssl::EVP_PKEY</text><polygon fill="#A80036" points="912.5 241.906 922.5 245.906 912.5 249.906 916.5 245.906" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="918.5" y1="245.906" y2="245.906"/><text x="59.5" y="240.732" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">5</text><text x="70.5" y="240.732" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191">create_or_load_cert(&quot;device_ca&quot;)</text><polygon fill="#A80036" points="63.5 271.141 53.5 275.141 63.5 279.141 59.5 275.141" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="928.5" y1="275.141" y2="275.141"/><text x="69.5" y="269.967" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">6</text><text x="80.5" y="269.967" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76">OK(cert PEM)</text><path fill="#EEE" d="M13,297.1406 L139,297.1406 L139,304.1406 L129,314.1406 L13,314.1406 L13,297.1406" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="954.5" height="707.984" x="13" y="297.141" fill="none"/><text x="28" y="310.201" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81">Workload CA</text><polygon fill="#A80036" points="670.5 346.844 680.5 350.844 670.5 354.844 674.5 350.844" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="676.5" y1="350.844" y2="350.844"/><text x="59.5" y="338.053" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">7</text><text x="70.5" y="330.435" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178">create_key_pair_if_not_exists(&quot;</text><text x="70.5" y="345.67" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85">workload_ca&quot;)</text><polygon fill="#A80036" points="63.5 376.078 53.5 380.078 63.5 384.078 59.5 380.078" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="686.5" y1="380.078" y2="380.078"/><text x="69.5" y="374.904" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">8</text><text x="80.5" y="374.904" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98">OK(&quot;key handle&quot;)</text><polygon fill="#A80036" points="502.5 405.313 512.5 409.313 502.5 413.313 506.5 409.313" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="508.5" y1="409.313" y2="409.313"/><text x="59.5" y="404.139" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">9</text><text x="70.5" y="404.139" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178">load_private_key(&quot;key handle&quot;)</text><polygon fill="#A80036" points="63.5 434.547 53.5 438.547 63.5 442.547 59.5 438.547" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="518.5" y1="438.547" y2="438.547"/><text x="69.5" y="433.373" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">10</text><text x="87.5" y="433.373" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110">openssl::EVP_PKEY</text><polygon fill="#A80036" points="912.5 479.016 922.5 483.016 912.5 487.016 916.5 483.016" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="918.5" y1="483.016" y2="483.016"/><text x="59.5" y="470.225" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">11</text><text x="77.5" y="462.607" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198">create_or_load_cert(&quot;workload_ca</text><text x="77.5" y="477.842" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="10">&quot;)</text><polygon fill="#A80036" points="63.5 508.25 53.5 512.25 63.5 516.25 59.5 512.25" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="928.5" y1="512.25" y2="512.25"/><text x="69.5" y="507.076" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">12</text><text x="87.5" y="507.076" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194">OK(cert PEM) or Err(NOT_FOUND)</text><path fill="#EEE" d="M23,527.25 L86,527.25 L86,534.25 L76,544.25 L23,544.25 L23,527.25" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="934.5" height="470.875" x="23" y="527.25" fill="none"/><text x="38" y="540.311" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18">alt</text><text x="101" y="539.455" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92">[if OK(cert PEM)]</text><polygon fill="#A80036" points="502.5 576.953 512.5 580.953 502.5 584.953 506.5 580.953" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="508.5" y1="580.953" y2="580.953"/><text x="59.5" y="568.162" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">13</text><text x="77.5" y="560.545" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198">openssl::X509_verify(CSR, device_</text><text x="77.5" y="575.779" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176">ca privkey openssl::EVP_PKEY)</text><polygon fill="#A80036" points="670.5 606.188 680.5 610.188 670.5 614.188 674.5 610.188" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="524.5" x2="676.5" y1="610.188" y2="610.188"/><text x="531.5" y="605.014" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">14</text><text x="549.5" y="605.014" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121">sign(&quot;key handle&quot;, ...)</text><polygon fill="#A80036" points="535.5 635.422 525.5 639.422 535.5 643.422 531.5 639.422" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="529.5" x2="686.5" y1="639.422" y2="639.422"/><text x="541.5" y="634.248" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">15</text><text x="559.5" y="634.248" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80">OK(signature)</text><polygon fill="#A80036" points="63.5 664.656 53.5 668.656 63.5 672.656 59.5 668.656" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="518.5" y1="668.656" y2="668.656"/><text x="69.5" y="663.482" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">16</text><text x="87.5" y="663.482" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98">OK(signed X509)</text><polygon fill="#A80036" points="912.5 693.891 922.5 697.891 912.5 701.891 916.5 697.891" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="918.5" y1="697.891" y2="697.891"/><text x="59.5" y="692.717" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">17</text><text x="77.5" y="692.717" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188">import(&quot;workload_ca&quot;, cert PEM)</text><polygon fill="#A80036" points="63.5 723.125 53.5 727.125 63.5 731.125 59.5 727.125" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="928.5" y1="727.125" y2="727.125"/><text x="69.5" y="721.951" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">18</text><text x="87.5" y="721.951" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17">OK</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="23" x2="957.5" y1="736.125" y2="736.125"/><text x="28" y="746.33" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110">[if Err(NOT_FOUND)]</text><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="94.5" y1="786.484" y2="786.484"/><line style="stroke:#a80036;stroke-width:1" x1="94.5" x2="94.5" y1="786.484" y2="799.484"/><line style="stroke:#a80036;stroke-width:1" x1="53.5" x2="94.5" y1="799.484" y2="799.484"/><polygon fill="#A80036" points="63.5 795.484 53.5 799.484 63.5 803.484 59.5 799.484" style="stroke:#a80036;stroke-width:1"/><text x="59.5" y="773.693" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">19</text><text x="77.5" y="766.076" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190">generate new CSR for workload_</text><text x="77.5" y="781.311" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14">ca</text><polygon fill="#A80036" points="502.5 839.953 512.5 843.953 502.5 847.953 506.5 843.953" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="508.5" y1="843.953" y2="843.953"/><text x="59.5" y="831.162" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">20</text><text x="77.5" y="823.545" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192">openssl::X509_sign(CSR, device_</text><text x="77.5" y="838.779" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176">ca privkey openssl::EVP_PKEY)</text><polygon fill="#A80036" points="670.5 869.188 680.5 873.188 670.5 877.188 674.5 873.188" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="524.5" x2="676.5" y1="873.188" y2="873.188"/><text x="531.5" y="868.014" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">21</text><text x="549.5" y="868.014" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121">sign(&quot;key handle&quot;, ...)</text><polygon fill="#A80036" points="535.5 898.422 525.5 902.422 535.5 906.422 531.5 902.422" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="529.5" x2="686.5" y1="902.422" y2="902.422"/><text x="541.5" y="897.248" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">22</text><text x="559.5" y="897.248" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80">OK(signature)</text><polygon fill="#A80036" points="63.5 927.656 53.5 931.656 63.5 935.656 59.5 931.656" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="518.5" y1="931.656" y2="931.656"/><text x="69.5" y="926.482" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">23</text><text x="87.5" y="926.482" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98">OK(signed X509)</text><polygon fill="#A80036" points="912.5 956.891 922.5 960.891 912.5 964.891 916.5 960.891" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="918.5" y1="960.891" y2="960.891"/><text x="59.5" y="955.717" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">24</text><text x="77.5" y="955.717" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188">import(&quot;workload_ca&quot;, cert PEM)</text><polygon fill="#A80036" points="63.5 986.125 53.5 990.125 63.5 994.125 59.5 990.125" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="928.5" y1="990.125" y2="990.125"/><text x="69.5" y="984.951" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">25</text><text x="87.5" y="984.951" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17">OK</text><path fill="#EEE" d="M23,1019.125 L113,1019.125 L113,1026.125 L103,1036.125 L23,1036.125 L23,1019.125" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1186" height="163.344" x="23" y="1019.125" fill="none"/><text x="38" y="1032.186" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45">MR init</text><polygon fill="#A80036" points="286.5 1053.594 296.5 1057.594 286.5 1061.594 290.5 1057.594" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="292.5" y1="1057.594" y2="1057.594"/><text x="59.5" y="1052.42" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">26</text><text x="77.5" y="1052.42" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135">get_provisioning_info()</text><polygon fill="#A80036" points="63.5 1082.828 53.5 1086.828 63.5 1090.828 59.5 1086.828" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="57.5" x2="302.5" y1="1086.828" y2="1086.828"/><text x="69.5" y="1081.654" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">27</text><text x="87.5" y="1081.654" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124">OK(provisioning info)</text><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="94.5" y1="1116.063" y2="1116.063"/><line style="stroke:#a80036;stroke-width:1" x1="94.5" x2="94.5" y1="1116.063" y2="1129.063"/><line style="stroke:#a80036;stroke-width:1" x1="53.5" x2="94.5" y1="1129.063" y2="1129.063"/><polygon fill="#A80036" points="63.5 1125.063 53.5 1129.063 63.5 1133.063 59.5 1129.063" style="stroke:#a80036;stroke-width:1"/><text x="59.5" y="1110.889" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">28</text><text x="77.5" y="1110.889" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82">Start modules</text><polygon fill="#A80036" points="1122 1154.297 1132 1158.297 1122 1162.297 1126 1158.297" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="52.5" x2="1128" y1="1158.297" y2="1158.297"/><text x="59.5" y="1153.123" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">29</text><rect style="stroke:#a80036;stroke-width:1.5" width="61" height="30.406" x="1134" y="1137.063" fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)"/><text x="1141" y="1157.051" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47">Module</text><path fill="#EEE" d="M13,1196.4688 L149,1196.4688 L149,1203.4688 L139,1213.4688 L13,1213.4688 L13,1196.4688" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1206" height="1964.688" x="13" y="1196.469" fill="none"/><text x="28" y="1209.529" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91">Module things</text><path fill="#EEE" d="M23,1220.7031 L282,1220.7031 L282,1227.7031 L272,1237.7031 L23,1237.7031 L23,1220.7031" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1186" height="783.203" x="23" y="1220.703" fill="none"/><text x="38" y="1233.764" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="214">Module wants to encrypt a secret</text><polygon fill="#A80036" points="68.5 1285.641 58.5 1289.641 68.5 1293.641 64.5 1289.641" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="62.5" x2="1165.5" y1="1289.641" y2="1289.641"/><text x="74.5" y="1269.232" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">30</text><text x="92.5" y="1253.998" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192">encrypt(plaintext) (e.g. encrypt(b&quot;</text><text x="92.5" y="1269.232" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188">foo&quot;), module_id = &quot;edgeAgent&quot;,</text><text x="92.5" y="1284.467" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85">gen_id = 1000)</text><polygon fill="#A80036" points="286.5 1330.109 296.5 1334.109 286.5 1338.109 290.5 1334.109" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="57.5" x2="292.5" y1="1334.109" y2="1334.109"/><text x="64.5" y="1321.318" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">31</text><text x="82.5" y="1313.701" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180">get_encryption_key(module_id,</text><text x="82.5" y="1328.936" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44">gen_id)</text><line style="stroke:#a80036;stroke-width:1" x1="308.5" x2="350.5" y1="1378.578" y2="1378.578"/><line style="stroke:#a80036;stroke-width:1" x1="350.5" x2="350.5" y1="1378.578" y2="1391.578"/><line style="stroke:#a80036;stroke-width:1" x1="309.5" x2="350.5" y1="1391.578" y2="1391.578"/><polygon fill="#A80036" points="319.5 1387.578 309.5 1391.578 319.5 1395.578 315.5 1391.578" style="stroke:#a80036;stroke-width:1"/><text x="315.5" y="1365.787" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">32</text><text x="333.5" y="1358.17" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174">Derive module ID digest (e.g. &quot;</text><text x="333.5" y="1373.404" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105">edgeAgent:1000&quot;)</text><polygon fill="#A80036" points="670.5 1432.047 680.5 1436.047 670.5 1440.047 674.5 1436.047" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="308.5" x2="676.5" y1="1436.047" y2="1436.047"/><text x="315.5" y="1423.256" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">33</text><text x="333.5" y="1415.639" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196">create_key_if_not_exists(&quot;master_</text><text x="333.5" y="1430.873" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97">encryption_key&quot;)</text><polygon fill="#A80036" points="319.5 1461.281 309.5 1465.281 319.5 1469.281 315.5 1465.281" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="313.5" x2="686.5" y1="1465.281" y2="1465.281"/><text x="325.5" y="1460.107" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">34</text><text x="343.5" y="1460.107" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98">OK(&quot;key handle&quot;)</text><polygon fill="#A80036" points="670.5 1520.984 680.5 1524.984 670.5 1528.984 674.5 1524.984" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="308.5" x2="676.5" y1="1524.984" y2="1524.984"/><text x="315.5" y="1504.576" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">35</text><text x="333.5" y="1489.342" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160">create_derived_key(&quot;master</text><text x="333.5" y="1504.576" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196">encryption key handle&quot;, module ID</text><text x="333.5" y="1519.811" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42">digest)</text><polygon fill="#A80036" points="319.5 1595.922 309.5 1599.922 319.5 1603.922 315.5 1599.922" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="313.5" x2="686.5" y1="1599.922" y2="1599.922"/><text x="325.5" y="1571.897" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">36</text><text x="343.5" y="1549.045" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199">OK(module encryption key handle)</text><text x="343.5" y="1564.279" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152">(e.g. token({ base: &quot;master</text><text x="343.5" y="1579.514" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185">encryption key handle&quot;, digest: &quot;</text><text x="343.5" y="1594.748" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118">edgeAgent:1000&quot; }))</text><polygon fill="#A80036" points="68.5 1625.156 58.5 1629.156 68.5 1633.156 64.5 1629.156" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="62.5" x2="302.5" y1="1629.156" y2="1629.156"/><text x="74.5" y="1623.982" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">37</text><text x="92.5" y="1623.982" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199">OK(module encryption key handle)</text><polygon fill="#A80036" points="670.5 1684.859 680.5 1688.859 670.5 1692.859 674.5 1688.859" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="57.5" x2="676.5" y1="1688.859" y2="1688.859"/><text x="64.5" y="1668.451" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">38</text><text x="82.5" y="1653.217" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178">encrypt(module encryption key</text><text x="82.5" y="1668.451" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177">handle, plaintext) (e.g. encrypt(</text><text x="82.5" y="1683.686" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106">token(...), b&quot;foo&quot;))</text><line style="stroke:#a80036;stroke-width:1" x1="692.5" x2="734.5" y1="1748.563" y2="1748.563"/><line style="stroke:#a80036;stroke-width:1" x1="734.5" x2="734.5" y1="1748.563" y2="1761.563"/><line style="stroke:#a80036;stroke-width:1" x1="693.5" x2="734.5" y1="1761.563" y2="1761.563"/><polygon fill="#A80036" points="703.5 1757.563 693.5 1761.563 703.5 1765.563 699.5 1761.563" style="stroke:#a80036;stroke-width:1"/><text x="699.5" y="1728.154" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">39</text><text x="717.5" y="1712.92" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192">Get master encryption key handle</text><text x="717.5" y="1728.154" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161">and module id digest out of</text><text x="717.5" y="1743.389" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173">module encryption key handle</text><line style="stroke:#a80036;stroke-width:1" x1="692.5" x2="734.5" y1="1851.734" y2="1851.734"/><line style="stroke:#a80036;stroke-width:1" x1="734.5" x2="734.5" y1="1851.734" y2="1864.734"/><line style="stroke:#a80036;stroke-width:1" x1="693.5" x2="734.5" y1="1864.734" y2="1864.734"/><polygon fill="#A80036" points="703.5 1860.734 693.5 1864.734 703.5 1868.734 699.5 1864.734" style="stroke:#a80036;stroke-width:1"/><text x="699.5" y="1816.092" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">40</text><text x="717.5" y="1785.623" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179">module_encryption_key = sign(</text><text x="717.5" y="1800.857" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172">master encryption key handle,</text><text x="717.5" y="1816.092" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163">module id digest) (i.e. sign(&quot;</text><text x="717.5" y="1831.326" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149">master_encryption_key&quot;, &quot;</text><text x="717.5" y="1846.561" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110">edgeAgent:1000&quot;))</text><line style="stroke:#a80036;stroke-width:1" x1="692.5" x2="734.5" y1="1924.438" y2="1924.438"/><line style="stroke:#a80036;stroke-width:1" x1="734.5" x2="734.5" y1="1924.438" y2="1937.438"/><line style="stroke:#a80036;stroke-width:1" x1="693.5" x2="734.5" y1="1937.438" y2="1937.438"/><polygon fill="#A80036" points="703.5 1933.438 693.5 1937.438 703.5 1941.438 699.5 1937.438" style="stroke:#a80036;stroke-width:1"/><text x="699.5" y="1904.029" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">41</text><text x="717.5" y="1888.795" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187">encrypt(module_encryption_key,</text><text x="717.5" y="1904.029" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177">plaintext) (i.e. encrypt(module_</text><text x="717.5" y="1919.264" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142">encryption_key, b&quot;foo&quot;))</text><polygon fill="#A80036" points="68.5 1962.672 58.5 1966.672 68.5 1970.672 64.5 1966.672" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="62.5" x2="686.5" y1="1966.672" y2="1966.672"/><text x="74.5" y="1961.498" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">42</text><text x="92.5" y="1961.498" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83">OK(ciphertext)</text><polygon fill="#A80036" points="1154.5 1991.906 1164.5 1995.906 1154.5 1999.906 1158.5 1995.906" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="52.5" x2="1160.5" y1="1995.906" y2="1995.906"/><text x="59.5" y="1990.732" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">43</text><text x="77.5" y="1990.732" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83">OK(ciphertext)</text><path fill="#EEE" d="M23,2017.9063 L366,2017.9063 L366,2024.9063 L356,2034.9063 L23,2034.9063 L23,2017.9063" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1186" height="767.969" x="23" y="2017.906" fill="none"/><text x="38" y="2030.967" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="298">Module wants to sign (HMAC-SHA256) a digest</text><polygon fill="#A80036" points="68.5 2082.844 58.5 2086.844 68.5 2090.844 64.5 2086.844" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="62.5" x2="1165.5" y1="2086.844" y2="2086.844"/><text x="74.5" y="2066.436" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">44</text><text x="92.5" y="2051.201" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178">sign(digest) (e.g. sign(b&quot;foo&quot;),</text><text x="92.5" y="2066.436" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193">module_id = &quot;edgeAgent&quot;, gen_id</text><text x="92.5" y="2081.67" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152">= 1000, key_id = &quot;primary&quot;)</text><polygon fill="#A80036" points="286.5 2127.313 296.5 2131.313 286.5 2135.313 290.5 2131.313" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="57.5" x2="292.5" y1="2131.313" y2="2131.313"/><text x="64.5" y="2118.521" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">45</text><text x="82.5" y="2110.904" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192">get_identity_key(module_id, gen_</text><text x="82.5" y="2126.139" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59">id, key_id)</text><line style="stroke:#a80036;stroke-width:1" x1="308.5" x2="350.5" y1="2175.781" y2="2175.781"/><line style="stroke:#a80036;stroke-width:1" x1="350.5" x2="350.5" y1="2175.781" y2="2188.781"/><line style="stroke:#a80036;stroke-width:1" x1="309.5" x2="350.5" y1="2188.781" y2="2188.781"/><polygon fill="#A80036" points="319.5 2184.781 309.5 2188.781 319.5 2192.781 315.5 2188.781" style="stroke:#a80036;stroke-width:1"/><text x="315.5" y="2162.99" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">46</text><text x="333.5" y="2155.373" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174">Derive module ID digest (e.g. &quot;</text><text x="333.5" y="2170.607" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151">edgeAgent:1000:primary&quot;)</text><polygon fill="#A80036" points="670.5 2229.25 680.5 2233.25 670.5 2237.25 674.5 2233.25" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="308.5" x2="676.5" y1="2233.25" y2="2233.25"/><text x="315.5" y="2220.459" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">47</text><text x="333.5" y="2212.842" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196">create_key_if_not_exists(&quot;master_</text><text x="333.5" y="2228.076" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78">identity_key&quot;)</text><polygon fill="#A80036" points="319.5 2258.484 309.5 2262.484 319.5 2266.484 315.5 2262.484" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="313.5" x2="686.5" y1="2262.484" y2="2262.484"/><text x="325.5" y="2257.311" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">48</text><text x="343.5" y="2257.311" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98">OK(&quot;key handle&quot;)</text><polygon fill="#A80036" points="670.5 2318.188 680.5 2322.188 670.5 2326.188 674.5 2322.188" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="308.5" x2="676.5" y1="2322.188" y2="2322.188"/><text x="315.5" y="2301.779" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">49</text><text x="333.5" y="2286.545" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160">create_derived_key(&quot;master</text><text x="333.5" y="2301.779" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177">identity key handle&quot;, module ID</text><text x="333.5" y="2317.014" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42">digest)</text><polygon fill="#A80036" points="319.5 2393.125 309.5 2397.125 319.5 2401.125 315.5 2397.125" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="313.5" x2="686.5" y1="2397.125" y2="2397.125"/><text x="325.5" y="2369.1" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">50</text><text x="343.5" y="2346.248" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197">OK(module identity key handle) (e.</text><text x="343.5" y="2361.482" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183">g. token({ base: &quot;master identity</text><text x="343.5" y="2376.717" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195">key handle&quot;, digest: &quot;edgeAgent:1</text><text x="343.5" y="2391.951" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90">000:primary&quot; }))</text><polygon fill="#A80036" points="68.5 2422.359 58.5 2426.359 68.5 2430.359 64.5 2426.359" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="62.5" x2="302.5" y1="2426.359" y2="2426.359"/><text x="74.5" y="2421.186" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">51</text><text x="92.5" y="2421.186" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180">OK(module identity key handle)</text><polygon fill="#A80036" points="670.5 2482.063 680.5 2486.063 670.5 2490.063 674.5 2486.063" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="57.5" x2="676.5" y1="2486.063" y2="2486.063"/><text x="64.5" y="2465.654" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">52</text><text x="82.5" y="2450.42" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186">sign(module identity key handle,</text><text x="82.5" y="2465.654" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198">digest) (e.g. sign(token(...), b&quot;foo&quot;</text><text x="82.5" y="2480.889" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="10">))</text><line style="stroke:#a80036;stroke-width:1" x1="692.5" x2="734.5" y1="2545.766" y2="2545.766"/><line style="stroke:#a80036;stroke-width:1" x1="734.5" x2="734.5" y1="2545.766" y2="2558.766"/><line style="stroke:#a80036;stroke-width:1" x1="693.5" x2="734.5" y1="2558.766" y2="2558.766"/><polygon fill="#A80036" points="703.5 2554.766 693.5 2558.766 703.5 2562.766 699.5 2558.766" style="stroke:#a80036;stroke-width:1"/><text x="699.5" y="2525.357" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">53</text><text x="717.5" y="2510.123" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198">Get master identity key handle and</text><text x="717.5" y="2525.357" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183">module id digest out of module</text><text x="717.5" y="2540.592" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107">identity key handle</text><line style="stroke:#a80036;stroke-width:1" x1="692.5" x2="734.5" y1="2633.703" y2="2633.703"/><line style="stroke:#a80036;stroke-width:1" x1="734.5" x2="734.5" y1="2633.703" y2="2646.703"/><line style="stroke:#a80036;stroke-width:1" x1="693.5" x2="734.5" y1="2646.703" y2="2646.703"/><polygon fill="#A80036" points="703.5 2642.703 693.5 2646.703 703.5 2650.703 699.5 2646.703" style="stroke:#a80036;stroke-width:1"/><text x="699.5" y="2605.678" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">54</text><text x="717.5" y="2582.826" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200">module_identity_key = sign(master</text><text x="717.5" y="2598.061" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171">identity key handle, module id</text><text x="717.5" y="2613.295" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196">digest) (i.e. sign(&quot;master_identity_</text><text x="717.5" y="2628.529" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192">key&quot;, &quot;edgeAgent:1000:primary&quot;))</text><line style="stroke:#a80036;stroke-width:1" x1="692.5" x2="734.5" y1="2706.406" y2="2706.406"/><line style="stroke:#a80036;stroke-width:1" x1="734.5" x2="734.5" y1="2706.406" y2="2719.406"/><line style="stroke:#a80036;stroke-width:1" x1="693.5" x2="734.5" y1="2719.406" y2="2719.406"/><polygon fill="#A80036" points="703.5 2715.406 693.5 2719.406 703.5 2723.406 699.5 2719.406" style="stroke:#a80036;stroke-width:1"/><text x="699.5" y="2685.998" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">55</text><text x="717.5" y="2670.764" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195">sign(module_identity_key, digest)</text><text x="717.5" y="2685.998" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189">(i.e. sign(module_identity_key, b&quot;</text><text x="717.5" y="2701.232" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36">foo&quot;))</text><polygon fill="#A80036" points="68.5 2744.641 58.5 2748.641 68.5 2752.641 64.5 2748.641" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="62.5" x2="686.5" y1="2748.641" y2="2748.641"/><text x="74.5" y="2743.467" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">56</text><text x="92.5" y="2743.467" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80">OK(signature)</text><polygon fill="#A80036" points="1154.5 2773.875 1164.5 2777.875 1154.5 2781.875 1158.5 2777.875" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="52.5" x2="1160.5" y1="2777.875" y2="2777.875"/><text x="59.5" y="2772.701" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">57</text><text x="77.5" y="2772.701" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80">OK(signature)</text><path fill="#EEE" d="M23,2799.875 L241,2799.875 L241,2806.875 L231,2816.875 L23,2816.875 L23,2799.875" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1186" height="354.281" x="23" y="2799.875" fill="none"/><text x="38" y="2812.936" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173">Module wants a server cert</text><polygon fill="#A80036" points="68.5 2834.344 58.5 2838.344 68.5 2842.344 64.5 2838.344" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="62.5" x2="1165.5" y1="2838.344" y2="2838.344"/><text x="74.5" y="2833.17" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">58</text><text x="92.5" y="2833.17" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111">Request server cert</text><polygon fill="#A80036" points="912.5 2863.578 922.5 2867.578 912.5 2871.578 916.5 2867.578" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="57.5" x2="918.5" y1="2867.578" y2="2867.578"/><text x="64.5" y="2862.404" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">59</text><text x="82.5" y="2862.404" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111">Request server cert</text><line style="stroke:#a80036;stroke-width:1" x1="934.5" x2="976.5" y1="2927.281" y2="2927.281"/><line style="stroke:#a80036;stroke-width:1" x1="976.5" x2="976.5" y1="2927.281" y2="2940.281"/><line style="stroke:#a80036;stroke-width:1" x1="935.5" x2="976.5" y1="2940.281" y2="2940.281"/><polygon fill="#A80036" points="945.5 2936.281 935.5 2940.281 945.5 2944.281 941.5 2940.281" style="stroke:#a80036;stroke-width:1"/><text x="941.5" y="2906.873" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">60</text><text x="959.5" y="2891.639" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192">generate new privkey and CSR (in</text><text x="959.5" y="2906.873" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188">memory, not via openssl-engine-</text><text x="959.5" y="2922.107" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19">ks)</text><polygon fill="#A80036" points="535.5 2995.984 525.5 2999.984 535.5 3003.984 531.5 2999.984" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="529.5" x2="923.5" y1="2999.984" y2="2999.984"/><text x="541.5" y="2979.576" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">61</text><text x="559.5" y="2964.342" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145">openssl::X509_sign(CSR,</text><text x="559.5" y="2979.576" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197">workload_ca privkey openssl::EVP</text><text x="559.5" y="2994.811" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40">_PKEY)</text><polygon fill="#A80036" points="670.5 3025.219 680.5 3029.219 670.5 3033.219 674.5 3029.219" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="524.5" x2="676.5" y1="3029.219" y2="3029.219"/><text x="531.5" y="3024.045" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">62</text><text x="549.5" y="3024.045" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121">sign(&quot;key handle&quot;, ...)</text><polygon fill="#A80036" points="535.5 3054.453 525.5 3058.453 535.5 3062.453 531.5 3058.453" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="529.5" x2="686.5" y1="3058.453" y2="3058.453"/><text x="541.5" y="3053.279" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">63</text><text x="559.5" y="3053.279" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80">OK(signature)</text><polygon fill="#A80036" points="912.5 3083.688 922.5 3087.688 912.5 3091.688 916.5 3087.688" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="519.5" x2="918.5" y1="3087.688" y2="3087.688"/><text x="526.5" y="3082.514" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">64</text><text x="544.5" y="3082.514" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98">OK(signed X509)</text><polygon fill="#A80036" points="68.5 3112.922 58.5 3116.922 68.5 3120.922 64.5 3116.922" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="62.5" x2="928.5" y1="3116.922" y2="3116.922"/><text x="74.5" y="3111.748" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">65</text><text x="92.5" y="3111.748" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133">OK(privkey, server cert)</text><polygon fill="#A80036" points="1154.5 3142.156 1164.5 3146.156 1154.5 3150.156 1158.5 3146.156" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="52.5" x2="1160.5" y1="3146.156" y2="3146.156"/><text x="59.5" y="3140.982" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">66</text><text x="77.5" y="3140.982" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133">OK(privkey, server cert)</text><path fill="#EEE" d="M268.5,3175.1563 L457.5,3175.1563 L457.5,3182.1563 L447.5,3192.1563 L268.5,3192.1563 L268.5,3175.1563" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1064.5" height="450.688" x="268.5" y="3175.156" fill="none"/><text x="283.5" y="3188.217" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144">Host_Module API calls</text><path fill="#EEE" d="M278.5,3199.3906 L571.5,3199.3906 L571.5,3206.3906 L561.5,3216.3906 L278.5,3216.3906 L278.5,3199.3906" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1044.5" height="195.109" x="278.5" y="3199.391" fill="none"/><text x="293.5" y="3212.451" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248">Host module wants to encrypt a secret</text><polygon fill="#A80036" points="319.5 3264.328 309.5 3268.328 319.5 3272.328 315.5 3268.328" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="313.5" x2="1260" y1="3268.328" y2="3268.328"/><text x="325.5" y="3247.92" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">67</text><text x="343.5" y="3232.686" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198">Similar process to MR above: get_</text><text x="343.5" y="3247.92" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197">encryption_key(module_id, gen_id</text><text x="343.5" y="3263.154" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5">)</text><polygon fill="#A80036" points="1249 3293.563 1259 3297.563 1249 3301.563 1253 3297.563" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="303.5" x2="1255" y1="3297.563" y2="3297.563"/><text x="310.5" y="3292.389" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">68</text><text x="328.5" y="3292.389" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98">OK(&quot;key handle&quot;)</text><polygon fill="#A80036" points="703.5 3353.266 693.5 3357.266 703.5 3361.266 699.5 3357.266" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="697.5" x2="1260" y1="3357.266" y2="3357.266"/><text x="709.5" y="3336.857" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">69</text><text x="727.5" y="3321.623" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170">Similar process to MR above:</text><text x="727.5" y="3336.857" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178">encrypt(module encryption key</text><text x="727.5" y="3352.092" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99">handle, plaintext)</text><polygon fill="#A80036" points="1249 3382.5 1259 3386.5 1249 3390.5 1253 3386.5" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="687.5" x2="1255" y1="3386.5" y2="3386.5"/><text x="694.5" y="3381.326" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">70</text><text x="712.5" y="3381.326" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83">OK(ciphertext)</text><path fill="#EEE" d="M278.5,3408.5 L655.5,3408.5 L655.5,3415.5 L645.5,3425.5 L278.5,3425.5 L278.5,3408.5" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1044.5" height="210.344" x="278.5" y="3408.5" fill="none"/><text x="293.5" y="3421.561" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="332">Host module wants to sign (HMAC-SHA256) a digest</text><polygon fill="#A80036" points="319.5 3473.438 309.5 3477.438 319.5 3481.438 315.5 3477.438" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="313.5" x2="1260" y1="3477.438" y2="3477.438"/><text x="325.5" y="3457.029" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">71</text><text x="343.5" y="3441.795" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198">Similar process to MR above: get_</text><text x="343.5" y="3457.029" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181">identity_key(module_id, gen_id,</text><text x="343.5" y="3472.264" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42">key_id)</text><polygon fill="#A80036" points="1249 3502.672 1259 3506.672 1249 3510.672 1253 3506.672" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="303.5" x2="1255" y1="3506.672" y2="3506.672"/><text x="310.5" y="3501.498" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">72</text><text x="328.5" y="3501.498" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98">OK(&quot;key handle&quot;)</text><polygon fill="#A80036" points="703.5 3577.609 693.5 3581.609 703.5 3585.609 699.5 3581.609" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="697.5" x2="1260" y1="3581.609" y2="3581.609"/><text x="709.5" y="3553.584" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">73</text><text x="727.5" y="3530.732" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198">Similar process to MR above: sign</text><text x="727.5" y="3545.967" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161">(module identity key handle,</text><text x="727.5" y="3561.201" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198">digest) (e.g. sign(token(...), b&quot;foo&quot;</text><text x="727.5" y="3576.436" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="10">))</text><polygon fill="#A80036" points="1249 3606.844 1259 3610.844 1249 3614.844 1253 3610.844" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="687.5" x2="1255" y1="3610.844" y2="3610.844"/><text x="694.5" y="3605.67" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">74</text><text x="712.5" y="3605.67" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80">OK(signature)</text></g></svg>