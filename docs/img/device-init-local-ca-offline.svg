<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1401" height="2166" contentScriptType="application/ecmascript" contentStyleType="text/css" style="width:1401px;height:2166px" preserveAspectRatio="none" version="1.1" viewBox="0 0 1401 2166" zoomAndPan="magnify"><defs><filter id="f7lwegojph4n9" width="300%" height="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect style="stroke:#a80036;stroke-width:1" width="663.5" height="2151.797" x="702.5" y="4" fill="#ADD8E6"/><text x="1013.25" y="16.061" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="42">Device</text><rect style="stroke:#000;stroke-width:2" width="483.5" height="382.219" x="13" y="92.047" fill="#FFF" filter="url(#f7lwegojph4n9)"/><rect style="stroke:#000;stroke-width:2" width="650.5" height="228.047" x="140" y="488.266" fill="#FFF" filter="url(#f7lwegojph4n9)"/><rect style="stroke:#000;stroke-width:2" width="1075.5" height="1353.672" x="306.5" y="730.313" fill="#FFF" filter="url(#f7lwegojph4n9)"/><rect style="stroke:#000;stroke-width:2" width="885.5" height="831.281" x="486.5" y="754.547" fill="#FFF" filter="url(#f7lwegojph4n9)"/><rect style="stroke:#000;stroke-width:2" width="867" height="477.156" x="316.5" y="1599.828" fill="#FFF" filter="url(#f7lwegojph4n9)"/><line style="stroke:#a80036;stroke-width:1" x1="188" x2="188" y1="75.047" y2="889.953"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="188" x2="188" y1="889.953" y2="930.844"/><line style="stroke:#a80036;stroke-width:1" x1="188" x2="188" y1="930.844" y2="1504.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="188" x2="188" y1="1504.047" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1" x1="188" x2="188" y1="1544.938" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="188" x2="188" y1="1544.938" y2="1585.828"/><line style="stroke:#a80036;stroke-width:1" x1="188" x2="188" y1="1585.828" y2="2100.984"/><line style="stroke:#a80036;stroke-width:1" x1="359.5" x2="359.5" y1="75.047" y2="889.953"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="359.5" x2="359.5" y1="889.953" y2="930.844"/><line style="stroke:#a80036;stroke-width:1" x1="359.5" x2="359.5" y1="930.844" y2="1504.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="359.5" x2="359.5" y1="1504.047" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1" x1="359.5" x2="359.5" y1="1544.938" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="359.5" x2="359.5" y1="1544.938" y2="1585.828"/><line style="stroke:#a80036;stroke-width:1" x1="359.5" x2="359.5" y1="1585.828" y2="2100.984"/><line style="stroke:#a80036;stroke-width:1" x1="444.5" x2="444.5" y1="75.047" y2="889.953"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="444.5" x2="444.5" y1="889.953" y2="930.844"/><line style="stroke:#a80036;stroke-width:1" x1="444.5" x2="444.5" y1="930.844" y2="1504.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="444.5" x2="444.5" y1="1504.047" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1" x1="444.5" x2="444.5" y1="1544.938" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="444.5" x2="444.5" y1="1544.938" y2="1585.828"/><line style="stroke:#a80036;stroke-width:1" x1="444.5" x2="444.5" y1="1585.828" y2="2100.984"/><line style="stroke:#a80036;stroke-width:1" x1="574.5" x2="574.5" y1="75.047" y2="889.953"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="574.5" x2="574.5" y1="889.953" y2="930.844"/><line style="stroke:#a80036;stroke-width:1" x1="574.5" x2="574.5" y1="930.844" y2="1504.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="574.5" x2="574.5" y1="1504.047" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1" x1="574.5" x2="574.5" y1="1544.938" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="574.5" x2="574.5" y1="1544.938" y2="1585.828"/><line style="stroke:#a80036;stroke-width:1" x1="574.5" x2="574.5" y1="1585.828" y2="2100.984"/><line style="stroke:#a80036;stroke-width:1" x1="743.5" x2="743.5" y1="75.047" y2="889.953"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="743.5" x2="743.5" y1="889.953" y2="930.844"/><line style="stroke:#a80036;stroke-width:1" x1="743.5" x2="743.5" y1="930.844" y2="1504.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="743.5" x2="743.5" y1="1504.047" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1" x1="743.5" x2="743.5" y1="1544.938" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="743.5" x2="743.5" y1="1544.938" y2="1585.828"/><line style="stroke:#a80036;stroke-width:1" x1="743.5" x2="743.5" y1="1585.828" y2="2100.984"/><line style="stroke:#a80036;stroke-width:1" x1="924" x2="924" y1="75.047" y2="889.953"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="924" x2="924" y1="889.953" y2="930.844"/><line style="stroke:#a80036;stroke-width:1" x1="924" x2="924" y1="930.844" y2="1504.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="924" x2="924" y1="1504.047" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1" x1="924" x2="924" y1="1544.938" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="924" x2="924" y1="1544.938" y2="1585.828"/><line style="stroke:#a80036;stroke-width:1" x1="924" x2="924" y1="1585.828" y2="2100.984"/><line style="stroke:#a80036;stroke-width:1" x1="1135.5" x2="1135.5" y1="1050.25" y2="1504.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="1135.5" x2="1135.5" y1="1504.047" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1" x1="1135.5" x2="1135.5" y1="1544.938" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="1135.5" x2="1135.5" y1="1544.938" y2="1585.828"/><line style="stroke:#a80036;stroke-width:1" x1="1135.5" x2="1135.5" y1="1585.828" y2="2100.984"/><line style="stroke:#a80036;stroke-width:1" x1="1327" x2="1327" y1="1103.859" y2="1504.047"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="1327" x2="1327" y1="1504.047" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1" x1="1327" x2="1327" y1="1544.938" y2="1544.938"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:1,4" x1="1327" x2="1327" y1="1544.938" y2="1585.828"/><line style="stroke:#a80036;stroke-width:1" x1="1327" x2="1327" y1="1585.828" y2="2100.984"/><rect style="stroke:#a80036;stroke-width:1.5" width="72" height="30.406" x="150" y="39.641" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="157" y="59.629" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58">Operator</text><rect style="stroke:#a80036;stroke-width:1.5" width="72" height="30.406" x="150" y="2099.984" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="157" y="2119.973" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58">Operator</text><rect style="stroke:#a80036;stroke-width:1.5" width="63" height="30.406" x="326.5" y="39.641" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="333.5" y="59.629" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49">IoT Hub</text><rect style="stroke:#a80036;stroke-width:1.5" width="63" height="30.406" x="326.5" y="2099.984" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="333.5" y="2119.973" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49">IoT Hub</text><text x="403.5" y="71.629" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77">Edge device</text><ellipse cx="445" cy="42.641" fill="#FEFECE" filter="url(#f7lwegojph4n9)" rx="12" ry="12" style="stroke:#a80036;stroke-width:2"/><line style="stroke:#a80036;stroke-width:2" x1="433" x2="457" y1="56.641" y2="56.641"/><text x="403.5" y="2112.973" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77">Edge device</text><ellipse cx="445" cy="2132.391" fill="#FEFECE" filter="url(#f7lwegojph4n9)" rx="12" ry="12" style="stroke:#a80036;stroke-width:2"/><line style="stroke:#a80036;stroke-width:2" x1="433" x2="457" y1="2146.391" y2="2146.391"/><rect style="stroke:#a80036;stroke-width:1.5" width="152" height="46.813" x="496.5" y="23.234" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="546" y="43.223" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53">External</text><text x="503.5" y="59.629" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138">Provisioning endpoint</text><rect style="stroke:#a80036;stroke-width:1.5" width="152" height="46.813" x="496.5" y="2099.984" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="546" y="2119.973" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53">External</text><text x="503.5" y="2136.379" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138">Provisioning endpoint</text><rect style="stroke:#a80036;stroke-width:1.5" width="70" height="46.813" x="706.5" y="23.234" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="713.5" y="43.223" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56">IoT Edge</text><text x="716" y="59.629" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51">runtime</text><rect style="stroke:#a80036;stroke-width:1.5" width="70" height="46.813" x="706.5" y="2099.984" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="713.5" y="2119.973" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56">IoT Edge</text><text x="716" y="2136.379" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51">runtime</text><rect style="stroke:#a80036;stroke-width:1.5" width="85" height="30.406" x="880" y="39.641" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="887" y="59.629" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71">EdgeAgent</text><rect style="stroke:#a80036;stroke-width:1.5" width="85" height="30.406" x="880" y="2099.984" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="887" y="2119.973" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71">EdgeAgent</text><rect style="stroke:#a80036;stroke-width:1.5" width="71" height="30.406" x="1098.5" y="2099.984" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="1105.5" y="2119.973" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57">EdgeHub</text><rect style="stroke:#a80036;stroke-width:1.5" width="66" height="46.813" x="1292" y="2099.984" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="1299" y="2119.973" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52">Custom</text><text x="1301.5" y="2136.379" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47">Module</text><path fill="#EEE" d="M13,92.0469 L137,92.0469 L137,99.0469 L127,109.0469 L13,109.0469 L13,92.0469" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="483.5" height="382.219" x="13" y="92.047" fill="none"/><text x="28" y="105.107" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79">Initial Setup</text><line style="stroke:#a80036;stroke-width:1" x1="188" x2="230" y1="206.688" y2="206.688"/><line style="stroke:#a80036;stroke-width:1" x1="230" x2="230" y1="206.688" y2="219.688"/><line style="stroke:#a80036;stroke-width:1" x1="189" x2="230" y1="219.688" y2="219.688"/><polygon fill="#A80036" points="199 215.688 189 219.688 199 223.688 195 219.688" style="stroke:#a80036;stroke-width:1"/><text x="195" y="163.428" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">1</text><text x="206" y="125.342" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">Generate device CA cert (</text><text x="206" y="140.576" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128">DCAC) (self signed, or</text><text x="206" y="155.81" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57">signed by</text><text x="206" y="171.045" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">a topology CA Certificate</text><text x="206" y="186.279" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104">(CA1) for gateway</text><text x="206" y="201.514" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62">scenarios)</text><line style="stroke:#a80036;stroke-width:1" x1="188" x2="230" y1="279.391" y2="279.391"/><line style="stroke:#a80036;stroke-width:1" x1="230" x2="230" y1="279.391" y2="292.391"/><line style="stroke:#a80036;stroke-width:1" x1="189" x2="230" y1="292.391" y2="292.391"/><polygon fill="#A80036" points="199 288.391 189 292.391 199 296.391 195 292.391" style="stroke:#a80036;stroke-width:1"/><text x="195" y="258.982" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">2</text><text x="206" y="243.748" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138">Generate device identity</text><text x="206" y="258.982" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122">cert (DIdC) signed by</text><text x="206" y="274.217" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125">Identity CA Cert (CA2).</text><path fill="#FBFB77" d="M23,305.3906 L23,345.3906 L349,345.3906 L349,315.3906 L339,305.3906 L23,305.3906" filter="url(#f7lwegojph4n9)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M339,305.3906 L339,315.3906 L349,315.3906 L339,305.3906" style="stroke:#a80036;stroke-width:1"/><text x="29" y="322.451" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188">CA1 and CA2 should be different</text><text x="29" y="337.685" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="305">because device does have the CA cert signed by CA1</text><polygon fill="#A80036" points="348 402.563 358 406.563 348 410.563 352 406.563" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="188" x2="354" y1="406.563" y2="406.563"/><text x="195" y="386.154" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">3</text><text x="206" y="370.92" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121">Configure identity CA</text><text x="206" y="386.154" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133">Certificate (CA2) for CA</text><text x="206" y="401.389" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">based auth</text><polygon fill="#A80036" points="433 462.266 443 466.266 433 470.266 437 466.266" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="188" x2="439" y1="466.266" y2="466.266"/><text x="195" y="445.857" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">4</text><text x="206" y="430.623" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">Install DCAC and DIdC on</text><text x="206" y="445.857" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">the device (file system or</text><text x="206" y="461.092" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34">HSM)</text><path fill="#EEE" d="M140,488.2656 L386,488.2656 L386,495.2656 L376,505.2656 L140,505.2656 L140,488.2656" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="650.5" height="228.047" x="140" y="488.266" fill="none"/><text x="155" y="501.326" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201">Device setup and configuration</text><polygon fill="#A80036" points="731.5 598.906 741.5 602.906 731.5 606.906 735.5 602.906" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="188" x2="737.5" y1="602.906" y2="602.906"/><text x="195" y="559.646" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">5</text><text x="206" y="521.561" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124">Configure device CA (</text><text x="206" y="536.795" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129">DCAC) in config.yaml (</text><text x="206" y="552.029" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147">PKCS#11 URI or file path)</text><text x="206" y="567.264" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110">and provisioning in</text><text x="206" y="582.498" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119">External Provisioning</text><text x="206" y="597.732" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37">mode.</text><polygon fill="#A80036" points="731.5 704.313 741.5 708.313 731.5 712.313 735.5 708.313" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="188" x2="737.5" y1="708.313" y2="708.313"/><text x="195" y="665.053" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">6</text><text x="206" y="626.967" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149">Configure deployment for</text><text x="206" y="642.201" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141">device using local mode</text><text x="206" y="657.436" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138">configuration for EA, EH</text><text x="206" y="672.67" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112">and other modules.</text><text x="206" y="687.904" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132">Configure EH Bridge to</text><text x="206" y="703.139" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146">send telemetry upstream.</text><path fill="#EEE" d="M306.5,730.3125 L446.5,730.3125 L446.5,737.3125 L436.5,747.3125 L306.5,747.3125 L306.5,730.3125" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1075.5" height="1353.672" x="306.5" y="730.313" fill="none"/><text x="321.5" y="743.373" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="95">Device running</text><path fill="#EEE" d="M486.5,754.5469 L620.5,754.5469 L620.5,761.5469 L610.5,771.5469 L486.5,771.5469 L486.5,754.5469" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="885.5" height="831.281" x="486.5" y="754.547" fill="none"/><text x="501.5" y="767.607" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89">Device Offline</text><polygon fill="#A80036" points="731.5 789.016 741.5 793.016 731.5 797.016 735.5 793.016" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="574.5" x2="737.5" y1="793.016" y2="793.016"/><text x="581.5" y="787.842" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">7</text><text x="592.5" y="787.842" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130">Start IoT Edge runtime</text><polygon fill="#A80036" points="585.5 848.719 575.5 852.719 585.5 856.719 581.5 852.719" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="579.5" x2="742.5" y1="852.719" y2="852.719"/><text x="591.5" y="832.311" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">8</text><text x="602.5" y="817.076" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94">Provision device</text><text x="602.5" y="832.311" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124">(external provisioning</text><text x="602.5" y="847.545" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57">endpoint)</text><polygon fill="red" points="731.5 877.953 741.5 881.953 731.5 885.953 735.5 881.953" style="stroke:red;stroke-width:1"/><line style="stroke:red;stroke-width:1;stroke-dasharray:2,2" x1="574.5" x2="737.5" y1="881.953" y2="881.953"/><text x="581.5" y="876.779" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">9</text><text x="592.5" y="876.779" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38">Failure</text><text x="641.5" y="914.158" fill="#000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="232">Provisioning attempts continue till success</text><polygon fill="#A80036" points="912.5 963.313 922.5 967.313 912.5 971.313 916.5 967.313" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="743.5" x2="918.5" y1="967.313" y2="967.313"/><text x="750.5" y="954.521" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">10</text><text x="768.5" y="946.904" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95">Create with local</text><text x="768.5" y="962.139" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132">configuration and start</text><line style="stroke:#a80036;stroke-width:1" x1="924.5" x2="966.5" y1="996.547" y2="996.547"/><line style="stroke:#a80036;stroke-width:1" x1="966.5" x2="966.5" y1="996.547" y2="1009.547"/><line style="stroke:#a80036;stroke-width:1" x1="925.5" x2="966.5" y1="1009.547" y2="1009.547"/><polygon fill="#A80036" points="935.5 1005.547 925.5 1009.547 935.5 1013.547 931.5 1009.547" style="stroke:#a80036;stroke-width:1"/><text x="931.5" y="991.373" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">11</text><text x="949.5" y="991.373" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119">Process deployment</text><polygon fill="#A80036" points="1086.5 1050.016 1096.5 1054.016 1086.5 1058.016 1090.5 1054.016" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="924.5" x2="1092.5" y1="1054.016" y2="1054.016"/><text x="931.5" y="1041.225" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">12</text><text x="949.5" y="1033.607" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95">Create with local</text><text x="949.5" y="1048.842" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132">configuration and start</text><rect style="stroke:#a80036;stroke-width:1.5" width="71" height="30.406" x="1098.5" y="1017.547" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="1105.5" y="1037.535" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57">EdgeHub</text><polygon fill="#A80036" points="1280 1080.188 1290 1084.188 1280 1088.188 1284 1084.188" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="924.5" x2="1286" y1="1084.188" y2="1084.188"/><text x="931.5" y="1079.014" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">13</text><text x="949.5" y="1079.014" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91">Create and start</text><rect style="stroke:#a80036;stroke-width:1.5" width="66" height="46.813" x="1292" y="1062.953" fill="#FEFECE" filter="url(#f7lwegojph4n9)"/><text x="1299" y="1082.941" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52">Custom</text><text x="1301.5" y="1099.348" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47">Module</text><polygon fill="#A80036" points="754.5 1142 744.5 1146 754.5 1150 750.5 1146" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="748.5" x2="1135" y1="1146" y2="1146"/><text x="760.5" y="1140.826" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">14</text><text x="778.5" y="1140.826" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83">Get server cert</text><line style="stroke:#a80036;stroke-width:1" x1="743.5" x2="785.5" y1="1190.469" y2="1190.469"/><line style="stroke:#a80036;stroke-width:1" x1="785.5" x2="785.5" y1="1190.469" y2="1203.469"/><line style="stroke:#a80036;stroke-width:1" x1="744.5" x2="785.5" y1="1203.469" y2="1203.469"/><polygon fill="#A80036" points="754.5 1199.469 744.5 1203.469 754.5 1207.469 750.5 1203.469" style="stroke:#a80036;stroke-width:1"/><text x="750.5" y="1177.678" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">15</text><text x="768.5" y="1170.061" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146">Generate server cert from</text><text x="768.5" y="1185.295" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33">DCAC</text><polygon fill="#A80036" points="1124 1228.703 1134 1232.703 1124 1236.703 1128 1232.703" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="743.5" x2="1130" y1="1232.703" y2="1232.703"/><text x="750.5" y="1227.529" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">16</text><text x="768.5" y="1227.529" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62">Server cert</text><polygon fill="#A80036" points="754.5 1257.938 744.5 1261.938 754.5 1265.938 750.5 1261.938" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="748.5" x2="1326" y1="1261.938" y2="1261.938"/><text x="760.5" y="1256.764" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">17</text><text x="778.5" y="1256.764" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96">Get local identity</text><line style="stroke:#a80036;stroke-width:1" x1="743.5" x2="785.5" y1="1306.406" y2="1306.406"/><line style="stroke:#a80036;stroke-width:1" x1="785.5" x2="785.5" y1="1306.406" y2="1319.406"/><line style="stroke:#a80036;stroke-width:1" x1="744.5" x2="785.5" y1="1319.406" y2="1319.406"/><polygon fill="#A80036" points="754.5 1315.406 744.5 1319.406 754.5 1323.406 750.5 1319.406" style="stroke:#a80036;stroke-width:1"/><text x="750.5" y="1293.615" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">18</text><text x="768.5" y="1285.998" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142">Generate client cert from</text><text x="768.5" y="1301.232" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33">DCAC</text><polygon fill="#A80036" points="1315 1344.641 1325 1348.641 1315 1352.641 1319 1348.641" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="743.5" x2="1321" y1="1348.641" y2="1348.641"/><text x="750.5" y="1343.467" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">19</text><text x="768.5" y="1343.467" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120">Module local identity</text><polygon fill="#A80036" points="1147 1389.109 1137 1393.109 1147 1397.109 1143 1393.109" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1141" x2="1326" y1="1393.109" y2="1393.109"/><text x="1153" y="1380.318" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">20</text><text x="1171" y="1372.701" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125">Connect using mutual</text><text x="1171" y="1387.936" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53">TLS auth</text><polygon fill="#A80036" points="1147 1433.578 1137 1437.578 1147 1441.578 1143 1437.578" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1141" x2="1326" y1="1437.578" y2="1437.578"/><text x="1153" y="1424.787" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">21</text><text x="1171" y="1417.17" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146">Pub/sub to MQTT Broker</text><text x="1171" y="1432.404" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119">using custom topics</text><polygon fill="#A80036" points="754.5 1462.813 744.5 1466.813 754.5 1470.813 750.5 1466.813" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="748.5" x2="1135" y1="1466.813" y2="1466.813"/><text x="760.5" y="1461.639" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">22</text><text x="778.5" y="1461.639" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112">Get IoTHub identity</text><polygon fill="red" points="1124 1492.047 1134 1496.047 1124 1500.047 1128 1496.047" style="stroke:red;stroke-width:1"/><line style="stroke:red;stroke-width:1;stroke-dasharray:2,2" x1="743.5" x2="1130" y1="1496.047" y2="1496.047"/><text x="750.5" y="1490.873" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">23</text><text x="768.5" y="1490.873" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38">Failure</text><text x="603.5" y="1528.252" fill="#000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="308">EdgeHub continues to ask for IoTHub identity periodically</text><text x="600" y="1569.143" fill="#000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="315">App operation continues. EdgeHub stores telemetry locally</text><path fill="#EEE" d="M316.5,1599.8281 L478.5,1599.8281 L478.5,1606.8281 L468.5,1616.8281 L316.5,1616.8281 L316.5,1599.8281" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="867" height="477.156" x="316.5" y="1599.828" fill="none"/><text x="331.5" y="1612.889" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117">Device goes online</text><polygon fill="#A80036" points="585.5 1664.766 575.5 1668.766 585.5 1672.766 581.5 1668.766" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="579.5" x2="742.5" y1="1668.766" y2="1668.766"/><text x="591.5" y="1648.357" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">24</text><text x="609.5" y="1633.123" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94">Provision device</text><text x="609.5" y="1648.357" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124">(external provisioning</text><text x="609.5" y="1663.592" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57">endpoint)</text><polygon fill="#A80036" points="371 1709.234 361 1713.234 371 1717.234 367 1713.234" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="365" x2="573.5" y1="1713.234" y2="1713.234"/><text x="377" y="1700.443" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">25</text><text x="395" y="1692.826" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105">Create device with</text><text x="395" y="1708.061" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84">CA based auth</text><polygon fill="#A80036" points="562.5 1738.469 572.5 1742.469 562.5 1746.469 566.5 1742.469" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="360" x2="568.5" y1="1742.469" y2="1742.469"/><text x="367" y="1737.295" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">26</text><text x="385" y="1737.295" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65">Device info</text><polygon fill="#A80036" points="731.5 1798.172 741.5 1802.172 731.5 1806.172 735.5 1802.172" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="574.5" x2="737.5" y1="1802.172" y2="1802.172"/><text x="581.5" y="1781.764" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">27</text><text x="599.5" y="1766.529" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97">Provisioning info</text><text x="599.5" y="1781.764" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122">(IoTHub + deviceId +</text><text x="599.5" y="1796.998" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33">DIdC)</text><polygon fill="#A80036" points="371 1857.875 361 1861.875 371 1865.875 367 1861.875" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="365" x2="742.5" y1="1861.875" y2="1861.875"/><text x="377" y="1841.467" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">28</text><text x="395" y="1826.232" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130">Update credentials for</text><text x="395" y="1841.467" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146">EdgeAgent and EdgeHub</text><text x="395" y="1856.701" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81">with SAS auth</text><polygon fill="#A80036" points="754.5 1887.109 744.5 1891.109 754.5 1895.109 750.5 1891.109" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="748.5" x2="1135" y1="1891.109" y2="1891.109"/><text x="760.5" y="1885.936" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">29</text><text x="778.5" y="1885.936" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112">Get IoTHub identity</text><polygon fill="#A80036" points="1124 1946.813 1134 1950.813 1124 1954.813 1128 1950.813" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="743.5" x2="1130" y1="1950.813" y2="1950.813"/><text x="750.5" y="1930.404" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">30</text><text x="768.5" y="1915.17" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130">Identity info (IoTHub +</text><text x="768.5" y="1930.404" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150">deviceId + generation Id +</text><text x="768.5" y="1945.639" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97">credentials type)</text><polygon fill="#A80036" points="754.5 1976.047 744.5 1980.047 754.5 1984.047 750.5 1980.047" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="748.5" x2="1135" y1="1980.047" y2="1980.047"/><text x="760.5" y="1974.873" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">31</text><text x="778.5" y="1974.873" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">Sign token</text><polygon fill="#A80036" points="1124 2020.516 1134 2024.516 1124 2028.516 1128 2024.516" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="743.5" x2="1130" y1="2024.516" y2="2024.516"/><text x="750.5" y="2011.725" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">32</text><text x="768.5" y="2004.107" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108">Token signed with</text><text x="768.5" y="2019.342" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117">EdgeHub&apos;s SAS Key</text><polygon fill="#A80036" points="371 2064.984 361 2068.984 371 2072.984 367 2068.984" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="365" x2="1135" y1="2068.984" y2="2068.984"/><text x="377" y="2056.193" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">33</text><text x="395" y="2048.576" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">Connect using token and</text><text x="395" y="2063.811" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102">forward telemetry</text></g></svg>