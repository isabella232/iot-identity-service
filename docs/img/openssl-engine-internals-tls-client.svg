<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1314" height="1631" contentScriptType="application/ecmascript" contentStyleType="text/css" style="width:1314px;height:1631px" preserveAspectRatio="none" version="1.1" viewBox="0 0 1314 1631" zoomAndPan="magnify"><defs><filter id="f1d3hlgjc2njqn" width="300%" height="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text x="367.5" y="28.699" fill="#000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="575">Create a TLS client with a private key from KS and a certificate from CS</text><rect style="stroke:#a80036;stroke-width:1" width="474" height="1584" x="663" y="41.094" fill="#DDD"/><text x="891.5" y="53.154" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17">KS</text><rect style="stroke:#a80036;stroke-width:1" width="10" height="651.156" x="286.5" y="910.531" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="577.688" x="291.5" y="947.766" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="101.938" x="488.5" y="483.781" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="477.75" x="488.5" y="1012.469" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="288.109" x="679.5" y="151.203" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="361.813" x="679.5" y="1099.172" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="145.172" x="871.5" y="222.672" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="203.641" x="871.5" y="1228.109" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1067.5" y="309.375" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1067.5" y="1299.578" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1067.5" y="1373.281" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="71.469" x="1156" y="646.188" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#000;stroke-width:2" width="1133" height="480.984" x="10" y="112.734" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#000;stroke-width:2" width="1290" height="175.406" x="10" y="607.719" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#000;stroke-width:2" width="1133" height="772.563" x="10" y="797.125" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="47" x2="47" y1="95.734" y2="1586.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="291.5" x2="291.5" y1="854.211" y2="1586.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="493" x2="493" y1="95.734" y2="1586.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="684" x2="684" y1="95.734" y2="1586.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="876.5" x2="876.5" y1="95.734" y2="1586.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1072" x2="1072" y1="95.734" y2="1586.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1161" x2="1161" y1="95.734" y2="1586.688"/><rect style="stroke:#a80036;stroke-width:1.5" width="51" height="30.406" x="20" y="60.328" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="27" y="80.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37">Client</text><rect style="stroke:#a80036;stroke-width:1.5" width="51" height="30.406" x="20" y="1585.688" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="27" y="1605.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37">Client</text><rect style="stroke:#a80036;stroke-width:1.5" width="104" height="30.406" x="237.5" y="1585.688" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="244.5" y="1605.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90">openssl client</text><rect style="stroke:#a80036;stroke-width:1.5" width="185" height="30.406" x="399" y="60.328" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="406" y="80.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="171">aziot_keys openssl engine</text><rect style="stroke:#a80036;stroke-width:1.5" width="185" height="30.406" x="399" y="1585.688" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="406" y="1605.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="171">aziot_keys openssl engine</text><rect style="stroke:#a80036;stroke-width:1.5" width="31" height="30.406" x="667" y="60.328" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="674" y="80.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17">KS</text><rect style="stroke:#a80036;stroke-width:1.5" width="31" height="30.406" x="667" y="1585.688" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="674" y="1605.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17">KS</text><rect style="stroke:#a80036;stroke-width:1.5" width="96" height="30.406" x="826.5" y="60.328" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="833.5" y="80.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82">libaziot-keys</text><rect style="stroke:#a80036;stroke-width:1.5" width="96" height="30.406" x="826.5" y="1585.688" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="833.5" y="1605.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82">libaziot-keys</text><rect style="stroke:#a80036;stroke-width:1.5" width="117" height="30.406" x="1012" y="60.328" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="1019" y="80.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103">PKCS#11 library</text><rect style="stroke:#a80036;stroke-width:1.5" width="117" height="30.406" x="1012" y="1585.688" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="1019" y="1605.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103">PKCS#11 library</text><rect style="stroke:#a80036;stroke-width:1.5" width="32" height="30.406" x="1143" y="60.328" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="1150" y="80.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18">CS</text><rect style="stroke:#a80036;stroke-width:1.5" width="32" height="30.406" x="1143" y="1585.688" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="1150" y="1605.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18">CS</text><rect style="stroke:#a80036;stroke-width:1" width="10" height="651.156" x="286.5" y="910.531" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="577.688" x="291.5" y="947.766" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="101.938" x="488.5" y="483.781" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="477.75" x="488.5" y="1012.469" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="288.109" x="679.5" y="151.203" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="361.813" x="679.5" y="1099.172" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="145.172" x="871.5" y="222.672" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="203.641" x="871.5" y="1228.109" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1067.5" y="309.375" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1067.5" y="1299.578" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1067.5" y="1373.281" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="71.469" x="1156" y="646.188" fill="#FFF" filter="url(#f1d3hlgjc2njqn)"/><path fill="#EEE" d="M10,112.7344 L311,112.7344 L311,119.7344 L301,129.7344 L10,129.7344 L10,112.7344" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1133" height="480.984" x="10" y="112.734" fill="none"/><text x="25" y="125.795" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="256">Get key corresponding to key ID from KS</text><polygon fill="#A80036" points="667.5 147.203 677.5 151.203 667.5 155.203 671.5 151.203" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="47.5" x2="673.5" y1="151.203" y2="151.203"/><text x="54.5" y="146.029" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">1</text><text x="65.5" y="146.029" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146">get_key_handle(&quot;key_id&quot;)</text><line style="stroke:#a80036;stroke-width:1" x1="689.5" x2="731.5" y1="180.438" y2="180.438"/><line style="stroke:#a80036;stroke-width:1" x1="731.5" x2="731.5" y1="180.438" y2="193.438"/><line style="stroke:#a80036;stroke-width:1" x1="690.5" x2="731.5" y1="193.438" y2="193.438"/><polygon fill="#A80036" points="700.5 189.438 690.5 193.438 700.5 197.438 696.5 193.438" style="stroke:#a80036;stroke-width:1"/><text x="696.5" y="175.264" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">2</text><text x="707.5" y="175.264" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97">Evaluate policies</text><polygon fill="#A80036" points="859.5 218.672 869.5 222.672 859.5 226.672 863.5 222.672" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="689.5" x2="865.5" y1="222.672" y2="222.672"/><text x="696.5" y="217.498" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">3</text><text x="707.5" y="217.498" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136">load_key_pair(&quot;key_id&quot;)</text><line style="stroke:#a80036;stroke-width:1" x1="881.5" x2="923.5" y1="251.906" y2="251.906"/><line style="stroke:#a80036;stroke-width:1" x1="923.5" x2="923.5" y1="251.906" y2="264.906"/><line style="stroke:#a80036;stroke-width:1" x1="882.5" x2="923.5" y1="264.906" y2="264.906"/><polygon fill="#A80036" points="892.5 260.906 882.5 264.906 892.5 268.906 888.5 264.906" style="stroke:#a80036;stroke-width:1"/><text x="888.5" y="246.732" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">4</text><text x="899.5" y="246.732" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143">Convert key ID to key URI</text><polygon fill="#A80036" points="1055.5 305.375 1065.5 309.375 1055.5 313.375 1059.5 309.375" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="881.5" x2="1061.5" y1="309.375" y2="309.375"/><text x="888.5" y="296.584" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">5</text><text x="899.5" y="288.967" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147">C_FindObjects(&quot;key_label</text><text x="899.5" y="304.201" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="10">&quot;)</text><polygon fill="#A80036" points="892.5 334.609 882.5 338.609 892.5 342.609 888.5 338.609" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="886.5" x2="1071.5" y1="338.609" y2="338.609"/><text x="898.5" y="333.435" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">6</text><text x="909.5" y="333.435" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104">OBJECT_HANDLE</text><polygon fill="#A80036" points="700.5 363.844 690.5 367.844 700.5 371.844 696.5 367.844" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="694.5" x2="875.5" y1="367.844" y2="367.844"/><text x="706.5" y="362.67" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">7</text><text x="717.5" y="362.67" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17">OK</text><line style="stroke:#a80036;stroke-width:1" x1="689.5" x2="731.5" y1="397.078" y2="397.078"/><line style="stroke:#a80036;stroke-width:1" x1="731.5" x2="731.5" y1="397.078" y2="410.078"/><line style="stroke:#a80036;stroke-width:1" x1="690.5" x2="731.5" y1="410.078" y2="410.078"/><polygon fill="#A80036" points="700.5 406.078 690.5 410.078 700.5 414.078 696.5 410.078" style="stroke:#a80036;stroke-width:1"/><text x="696.5" y="391.904" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">8</text><text x="707.5" y="391.904" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129">Synthesize key handle</text><polygon fill="#A80036" points="58.5 435.313 48.5 439.313 58.5 443.313 54.5 439.313" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="52.5" x2="683.5" y1="439.313" y2="439.313"/><text x="64.5" y="434.139" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">9</text><text x="75.5" y="434.139" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98">OK(&quot;key handle&quot;)</text><polygon fill="#A80036" points="476.5 479.781 486.5 483.781 476.5 487.781 480.5 483.781" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="47.5" x2="482.5" y1="483.781" y2="483.781"/><text x="54.5" y="470.99" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">10</text><text x="72.5" y="463.373" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126">load_private_key(&quot;key</text><text x="72.5" y="478.607" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49">handle&quot;)</text><line style="stroke:#a80036;stroke-width:1" x1="498.5" x2="540.5" y1="543.484" y2="543.484"/><line style="stroke:#a80036;stroke-width:1" x1="540.5" x2="540.5" y1="543.484" y2="556.484"/><line style="stroke:#a80036;stroke-width:1" x1="499.5" x2="540.5" y1="556.484" y2="556.484"/><polygon fill="#A80036" points="509.5 552.484 499.5 556.484 509.5 560.484 505.5 556.484" style="stroke:#a80036;stroke-width:1"/><text x="505.5" y="523.076" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">11</text><text x="523.5" y="507.842" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149">Create new EVP_PKEY and</text><text x="523.5" y="523.076" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149">attach key handle to its ex</text><text x="523.5" y="538.311" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29">data.</text><polygon fill="#A80036" points="58.5 581.719 48.5 585.719 58.5 589.719 54.5 585.719" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="52.5" x2="492.5" y1="585.719" y2="585.719"/><text x="64.5" y="580.545" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">12</text><text x="82.5" y="580.545" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110">openssl::EVP_PKEY</text><path fill="#EEE" d="M10,607.7188 L324,607.7188 L324,614.7188 L314,624.7188 L10,624.7188 L10,607.7188" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1290" height="175.406" x="10" y="607.719" fill="none"/><text x="25" y="620.779" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="269">Get cert corresponding to cert ID from CS</text><polygon fill="#A80036" points="1144 642.188 1154 646.188 1144 650.188 1148 646.188" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="47.5" x2="1150" y1="646.188" y2="646.188"/><text x="54.5" y="641.014" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">13</text><text x="72.5" y="641.014" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112">load_cert(&quot;cert_id&quot;)</text><line style="stroke:#a80036;stroke-width:1" x1="1166" x2="1208" y1="675.422" y2="675.422"/><line style="stroke:#a80036;stroke-width:1" x1="1208" x2="1208" y1="675.422" y2="688.422"/><line style="stroke:#a80036;stroke-width:1" x1="1167" x2="1208" y1="688.422" y2="688.422"/><polygon fill="#A80036" points="1177 684.422 1167 688.422 1177 692.422 1173 688.422" style="stroke:#a80036;stroke-width:1"/><text x="1173" y="670.248" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">14</text><text x="1191" y="670.248" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97">Evaluate policies</text><polygon fill="#A80036" points="58.5 713.656 48.5 717.656 58.5 721.656 54.5 717.656" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="52.5" x2="1160" y1="717.656" y2="717.656"/><text x="64.5" y="712.482" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">15</text><text x="82.5" y="712.482" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51">OK(PEM)</text><line style="stroke:#a80036;stroke-width:1" x1="47.5" x2="89.5" y1="762.125" y2="762.125"/><line style="stroke:#a80036;stroke-width:1" x1="89.5" x2="89.5" y1="762.125" y2="775.125"/><line style="stroke:#a80036;stroke-width:1" x1="48.5" x2="89.5" y1="775.125" y2="775.125"/><polygon fill="#A80036" points="58.5 771.125 48.5 775.125 58.5 779.125 54.5 775.125" style="stroke:#a80036;stroke-width:1"/><text x="54.5" y="749.334" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">16</text><text x="72.5" y="741.717" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122">Create openssl::X509</text><text x="72.5" y="756.951" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56">from PEM</text><path fill="#EEE" d="M10,797.125 L204,797.125 L204,804.125 L194,814.125 L10,814.125 L10,797.125" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1133" height="772.563" x="10" y="797.125" fill="none"/><text x="25" y="810.186" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149">Create TLS connection</text><polygon fill="#A80036" points="225.5 862.063 235.5 866.063 225.5 870.063 229.5 866.063" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="47.5" x2="231.5" y1="866.063" y2="866.063"/><text x="54.5" y="845.654" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">17</text><text x="72.5" y="830.42" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121">Create openssl client</text><text x="72.5" y="845.654" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145">using openssl::EVP_PKEY</text><text x="72.5" y="860.889" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93">+ openssl::X509</text><rect style="stroke:#a80036;stroke-width:1.5" width="104" height="30.406" x="237.5" y="828.656" fill="#FEFECE" filter="url(#f1d3hlgjc2njqn)"/><text x="244.5" y="848.644" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90">openssl client</text><polygon fill="#A80036" points="274.5 906.531 284.5 910.531 274.5 914.531 278.5 910.531" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="47.5" x2="280.5" y1="910.531" y2="910.531"/><text x="54.5" y="897.74" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">18</text><text x="72.5" y="890.123" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149">connect to contoso.azure</text><text x="72.5" y="905.357" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94">-devices.net:443</text><line style="stroke:#a80036;stroke-width:1" x1="296.5" x2="343.5" y1="934.766" y2="934.766"/><line style="stroke:#a80036;stroke-width:1" x1="343.5" x2="343.5" y1="934.766" y2="947.766"/><line style="stroke:#a80036;stroke-width:1" x1="302.5" x2="343.5" y1="947.766" y2="947.766"/><polygon fill="#A80036" points="312.5 943.766 302.5 947.766 312.5 951.766 308.5 947.766" style="stroke:#a80036;stroke-width:1"/><text x="308.5" y="929.592" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">19</text><text x="326.5" y="929.592" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66">Handshake</text><polygon fill="#A80036" points="476.5 1008.469 486.5 1012.469 476.5 1016.469 480.5 1012.469" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="301.5" x2="482.5" y1="1012.469" y2="1012.469"/><text x="308.5" y="992.061" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">20</text><text x="326.5" y="976.826" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142">custom_EVP_PKEY_sign(</text><text x="326.5" y="992.061" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150">openssl::ENGINE, openssl</text><text x="326.5" y="1007.295" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83">::EVP_PKEY, ...)</text><line style="stroke:#a80036;stroke-width:1" x1="498.5" x2="540.5" y1="1056.938" y2="1056.938"/><line style="stroke:#a80036;stroke-width:1" x1="540.5" x2="540.5" y1="1056.938" y2="1069.938"/><line style="stroke:#a80036;stroke-width:1" x1="499.5" x2="540.5" y1="1069.938" y2="1069.938"/><polygon fill="#A80036" points="509.5 1065.938 499.5 1069.938 509.5 1073.938 505.5 1069.938" style="stroke:#a80036;stroke-width:1"/><text x="505.5" y="1044.147" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">21</text><text x="523.5" y="1036.529" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135">Extract key handle from</text><text x="523.5" y="1051.764" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112">EVP_PKEY&apos;s ex data</text><polygon fill="#A80036" points="667.5 1095.172 677.5 1099.172 667.5 1103.172 671.5 1099.172" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="498.5" x2="673.5" y1="1099.172" y2="1099.172"/><text x="505.5" y="1093.998" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">22</text><text x="523.5" y="1093.998" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121">sign(&quot;key handle&quot;, ...)</text><line style="stroke:#a80036;stroke-width:1" x1="689.5" x2="731.5" y1="1128.406" y2="1128.406"/><line style="stroke:#a80036;stroke-width:1" x1="731.5" x2="731.5" y1="1128.406" y2="1141.406"/><line style="stroke:#a80036;stroke-width:1" x1="690.5" x2="731.5" y1="1141.406" y2="1141.406"/><polygon fill="#A80036" points="700.5 1137.406 690.5 1141.406 700.5 1145.406 696.5 1141.406" style="stroke:#a80036;stroke-width:1"/><text x="696.5" y="1123.232" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">23</text><text x="714.5" y="1123.232" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97">Evaluate policies</text><line style="stroke:#a80036;stroke-width:1" x1="689.5" x2="731.5" y1="1185.875" y2="1185.875"/><line style="stroke:#a80036;stroke-width:1" x1="731.5" x2="731.5" y1="1185.875" y2="1198.875"/><line style="stroke:#a80036;stroke-width:1" x1="690.5" x2="731.5" y1="1198.875" y2="1198.875"/><polygon fill="#A80036" points="700.5 1194.875 690.5 1198.875 700.5 1202.875 696.5 1198.875" style="stroke:#a80036;stroke-width:1"/><text x="696.5" y="1173.084" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">24</text><text x="714.5" y="1165.467" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147">Convert key handle to key</text><text x="714.5" y="1180.701" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12">ID</text><polygon fill="#A80036" points="859.5 1224.109 869.5 1228.109 859.5 1232.109 863.5 1228.109" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="689.5" x2="865.5" y1="1228.109" y2="1228.109"/><text x="696.5" y="1222.936" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">25</text><text x="714.5" y="1222.936" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94">sign(&quot;key ID&quot;, ...)</text><line style="stroke:#a80036;stroke-width:1" x1="881.5" x2="923.5" y1="1257.344" y2="1257.344"/><line style="stroke:#a80036;stroke-width:1" x1="923.5" x2="923.5" y1="1257.344" y2="1270.344"/><line style="stroke:#a80036;stroke-width:1" x1="882.5" x2="923.5" y1="1270.344" y2="1270.344"/><polygon fill="#A80036" points="892.5 1266.344 882.5 1270.344 892.5 1274.344 888.5 1270.344" style="stroke:#a80036;stroke-width:1"/><text x="888.5" y="1252.17" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">26</text><text x="906.5" y="1252.17" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143">Convert key ID to key URI</text><polygon fill="#A80036" points="1055.5 1295.578 1065.5 1299.578 1055.5 1303.578 1059.5 1299.578" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="881.5" x2="1061.5" y1="1299.578" y2="1299.578"/><text x="888.5" y="1294.404" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">27</text><text x="906.5" y="1294.404" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143">C_FindObjects(&quot;key_uri&quot;)</text><polygon fill="#A80036" points="892.5 1324.813 882.5 1328.813 892.5 1332.813 888.5 1328.813" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="886.5" x2="1071.5" y1="1328.813" y2="1328.813"/><text x="898.5" y="1323.639" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">28</text><text x="916.5" y="1323.639" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104">OBJECT_HANDLE</text><polygon fill="#A80036" points="1055.5 1369.281 1065.5 1373.281 1055.5 1377.281 1059.5 1373.281" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="881.5" x2="1061.5" y1="1373.281" y2="1373.281"/><text x="888.5" y="1360.49" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">29</text><text x="906.5" y="1352.873" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149">C_Sign(pkcs11::OBJECT_</text><text x="906.5" y="1368.107" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69">HANDLE, ...)</text><polygon fill="#A80036" points="892.5 1398.516 882.5 1402.516 892.5 1406.516 888.5 1402.516" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="886.5" x2="1071.5" y1="1402.516" y2="1402.516"/><text x="898.5" y="1397.342" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">30</text><text x="916.5" y="1397.342" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80">OK(signature)</text><polygon fill="#A80036" points="700.5 1427.75 690.5 1431.75 700.5 1435.75 696.5 1431.75" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="694.5" x2="875.5" y1="1431.75" y2="1431.75"/><text x="706.5" y="1426.576" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">31</text><text x="724.5" y="1426.576" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80">OK(signature)</text><polygon fill="#A80036" points="509.5 1456.984 499.5 1460.984 509.5 1464.984 505.5 1460.984" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="503.5" x2="683.5" y1="1460.984" y2="1460.984"/><text x="515.5" y="1455.811" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">32</text><text x="533.5" y="1455.811" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80">OK(signature)</text><polygon fill="#A80036" points="312.5 1486.219 302.5 1490.219 312.5 1494.219 308.5 1490.219" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="306.5" x2="492.5" y1="1490.219" y2="1490.219"/><text x="318.5" y="1485.045" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">33</text><text x="336.5" y="1485.045" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80">OK(signature)</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="301.5" x2="343.5" y1="1524.453" y2="1524.453"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="343.5" x2="343.5" y1="1524.453" y2="1537.453"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="296.5" x2="343.5" y1="1537.453" y2="1537.453"/><polygon fill="#A80036" points="306.5 1533.453 296.5 1537.453 306.5 1541.453 302.5 1537.453" style="stroke:#a80036;stroke-width:1"/><text x="308.5" y="1519.279" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">34</text><text x="326.5" y="1519.279" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124">Handshake complete</text><polygon fill="#A80036" points="58.5 1557.688 48.5 1561.688 58.5 1565.688 54.5 1561.688" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="52.5" x2="290.5" y1="1561.688" y2="1561.688"/><text x="64.5" y="1556.514" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">35</text><text x="82.5" y="1556.514" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">Connected</text></g></svg>