<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1909" height="2293" contentScriptType="application/ecmascript" contentStyleType="text/css" style="width:1909px;height:2293px" preserveAspectRatio="none" version="1.1" viewBox="0 0 1909 2293" zoomAndPan="magnify"><defs><filter id="fu0bg1xfo7bex" width="300%" height="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text x="873.5" y="26.699" fill="#000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="156">Device Provisioning</text><rect style="stroke:#a80036;stroke-width:1" width="858.5" height="2243" x="579" y="39.094" fill="#ADD8E6"/><text x="985.75" y="51.154" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="42">Device</text><rect style="stroke:#a80036;stroke-width:1" width="10" height="113.703" x="50.5" y="506.547" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="113.703" x="50.5" y="966.594" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="50.5" y="1291.703" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="129.938" x="249.5" y="2046.516" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="534.5" y="2117.984" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="400.813" x="637" y="1810.875" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="220.672" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="405.844" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="765.188" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="865.891" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="1365.063" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="1508" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="1845.109" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="1582.203" x="1355" y="167.203" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="40.234" x="1360" y="287.141" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="40.234" x="1360" y="657.484" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="40.234" x="1360" y="1117.531" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="40.234" x="1360" y="1431.531" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="40.234" x="1360" y="1658.938" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1355" y="1945.813" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#000;stroke-width:2" width="1844" height="530.516" x="23" y="182.203" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#000;stroke-width:2" width="1831" height="488.281" x="23" y="726.719" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#000;stroke-width:2" width="1877" height="492.172" x="13" y="1229" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#000;stroke-width:2" width="1857" height="460.938" x="23" y="1253.234" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:none;stroke-width:1" width="1857" height="385.234" x="23" y="1328.938" fill="#FFF"/><rect style="stroke:#000;stroke-width:2" width="1221.5" height="462.281" x="222" y="1764.406" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="55" x2="55" y1="93.734" y2="2243.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="254" x2="254" y1="93.734" y2="2243.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="539" x2="539" y1="93.734" y2="2243.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="642" x2="642" y1="93.734" y2="2243.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1077" x2="1077" y1="93.734" y2="2243.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1359.5" x2="1359.5" y1="93.734" y2="2243.688"/><rect style="stroke:#a80036;stroke-width:1.5" width="41" height="30.406" x="33" y="58.328" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="40" y="78.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27">EST</text><rect style="stroke:#a80036;stroke-width:1.5" width="41" height="30.406" x="33" y="2242.688" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="40" y="2262.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27">EST</text><rect style="stroke:#a80036;stroke-width:1.5" width="41" height="30.406" x="232" y="58.328" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="239" y="78.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27">DPS</text><rect style="stroke:#a80036;stroke-width:1.5" width="41" height="30.406" x="232" y="2242.688" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="239" y="2262.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27">DPS</text><rect style="stroke:#a80036;stroke-width:1.5" width="63" height="30.406" x="506" y="58.328" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="513" y="78.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49">IoT Hub</text><rect style="stroke:#a80036;stroke-width:1.5" width="63" height="30.406" x="506" y="2242.688" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="513" y="2262.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49">IoT Hub</text><rect style="stroke:#a80036;stroke-width:1.5" width="114" height="30.406" x="583" y="58.328" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="590" y="78.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100">Identity Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="114" height="30.406" x="583" y="2242.688" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="590" y="2262.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100">Identity Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="96" height="30.406" x="1027" y="58.328" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="1034" y="78.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82">Keys Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="96" height="30.406" x="1027" y="2242.688" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="1034" y="2262.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82">Keys Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="143" height="30.406" x="1286.5" y="58.328" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="1293.5" y="78.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129">Certificates Service</text><rect style="stroke:#a80036;stroke-width:1.5" width="143" height="30.406" x="1286.5" y="2242.688" fill="#FEFECE" filter="url(#fu0bg1xfo7bex)"/><text x="1293.5" y="2262.676" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129">Certificates Service</text><rect style="stroke:#a80036;stroke-width:1" width="10" height="113.703" x="50.5" y="506.547" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="113.703" x="50.5" y="966.594" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="50.5" y="1291.703" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="129.938" x="249.5" y="2046.516" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="534.5" y="2117.984" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="400.813" x="637" y="1810.875" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="220.672" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="405.844" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="765.188" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="865.891" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="1365.063" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="1508" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1072" y="1845.109" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="1582.203" x="1355" y="167.203" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="40.234" x="1360" y="287.141" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="40.234" x="1360" y="657.484" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="40.234" x="1360" y="1117.531" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="40.234" x="1360" y="1431.531" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="40.234" x="1360" y="1658.938" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="1355" y="1945.813" fill="#FFF" filter="url(#fu0bg1xfo7bex)"/><line style="stroke:#a80036;stroke-width:1" x1="1360" x2="1402" y1="124.969" y2="124.969"/><line style="stroke:#a80036;stroke-width:1" x1="1402" x2="1402" y1="124.969" y2="137.969"/><line style="stroke:#a80036;stroke-width:1" x1="1361" x2="1402" y1="137.969" y2="137.969"/><polygon fill="#A80036" points="1371 133.969 1361 137.969 1371 141.969 1367 137.969" style="stroke:#a80036;stroke-width:1"/><text x="1367" y="119.795" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">1</text><text x="1378" y="119.795" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344">At first, the bootstrap ID cert is used as the EST identity cert</text><polygon fill="#A80036" points="1343 163.203 1353 167.203 1343 171.203 1347 167.203" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="642" x2="1349" y1="167.203" y2="167.203"/><text x="649" y="162.029" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">2</text><text x="660" y="162.029" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161">Get current EST identity cert</text><path fill="#EEE" d="M23,182.2031 L96,182.2031 L96,189.2031 L86,199.2031 L23,199.2031 L23,182.2031" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1844" height="530.516" x="23" y="182.203" fill="none"/><text x="38" y="195.264" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="111" y="194.408" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="250">[for creating and renewing EST identity cert]</text><polygon fill="#A80036" points="1093 216.672 1083 220.672 1093 224.672 1089 220.672" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1087" x2="1354" y1="220.672" y2="220.672"/><text x="1099" y="215.498" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">3</text><text x="1110" y="215.498" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236">Get current EST identity cert&apos;s private key</text><polygon fill="#A80036" points="1343 245.906 1353 249.906 1343 253.906 1347 249.906" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1077" x2="1349" y1="249.906" y2="249.906"/><text x="1084" y="244.732" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">4</text><text x="1095" y="244.732" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">Key handle</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1412" y1="274.141" y2="274.141"/><line style="stroke:#a80036;stroke-width:1" x1="1412" x2="1412" y1="274.141" y2="287.141"/><line style="stroke:#a80036;stroke-width:1" x1="1371" x2="1412" y1="287.141" y2="287.141"/><polygon fill="#A80036" points="1381 283.141 1371 287.141 1381 291.141 1377 287.141" style="stroke:#a80036;stroke-width:1"/><text x="1377" y="268.967" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">5</text><text x="1388" y="268.967" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161">Get current EST identity cert</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1370" x2="1412" y1="326.375" y2="326.375"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1412" x2="1412" y1="326.375" y2="339.375"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1365" x2="1412" y1="339.375" y2="339.375"/><polygon fill="#A80036" points="1375 335.375 1365 339.375 1375 343.375 1371 339.375" style="stroke:#a80036;stroke-width:1"/><text x="1377" y="321.201" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">6</text><text x="1388" y="321.201" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25">PEM</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1407" y1="363.609" y2="363.609"/><line style="stroke:#a80036;stroke-width:1" x1="1407" x2="1407" y1="363.609" y2="376.609"/><line style="stroke:#a80036;stroke-width:1" x1="1366" x2="1407" y1="376.609" y2="376.609"/><polygon fill="#A80036" points="1376 372.609 1366 376.609 1376 380.609 1372 376.609" style="stroke:#a80036;stroke-width:1"/><text x="1372" y="358.435" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">7</text><text x="1383" y="358.435" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393">Create TLS client using key handle + PEM (using openssl-engine-ks)</text><polygon fill="#A80036" points="1093 401.844 1083 405.844 1093 409.844 1089 405.844" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1087" x2="1354" y1="405.844" y2="405.844"/><text x="1099" y="400.67" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">8</text><text x="1110" y="400.67" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197">Generate new asymmetric key pair</text><polygon fill="#A80036" points="1343 431.078 1353 435.078 1343 439.078 1347 435.078" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1077" x2="1349" y1="435.078" y2="435.078"/><text x="1084" y="429.904" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">9</text><text x="1095" y="429.904" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">Key handle</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1407" y1="464.313" y2="464.313"/><line style="stroke:#a80036;stroke-width:1" x1="1407" x2="1407" y1="464.313" y2="477.313"/><line style="stroke:#a80036;stroke-width:1" x1="1366" x2="1407" y1="477.313" y2="477.313"/><polygon fill="#A80036" points="1376 473.313 1366 477.313 1376 481.313 1372 477.313" style="stroke:#a80036;stroke-width:1"/><text x="1372" y="459.139" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">10</text><text x="1390" y="459.139" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="465">Create CSR for new EST identity cert using key handle (using openssl-engine-ks)</text><polygon fill="#A80036" points="71.5 502.547 61.5 506.547 71.5 510.547 67.5 506.547" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="65.5" x2="1354" y1="506.547" y2="506.547"/><text x="77.5" y="501.373" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">11</text><text x="95.5" y="501.373" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="634">Connect using TLS client and perform EST enrolment to get a new EST identity cert corresponding to the CSR</text><line style="stroke:#a80036;stroke-width:1" x1="60.5" x2="102.5" y1="535.781" y2="535.781"/><line style="stroke:#a80036;stroke-width:1" x1="102.5" x2="102.5" y1="535.781" y2="548.781"/><line style="stroke:#a80036;stroke-width:1" x1="61.5" x2="102.5" y1="548.781" y2="548.781"/><polygon fill="#A80036" points="71.5 544.781 61.5 548.781 71.5 552.781 67.5 548.781" style="stroke:#a80036;stroke-width:1"/><text x="67.5" y="530.607" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">12</text><text x="85.5" y="530.607" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157">Verify client cert against CA</text><line style="stroke:#a80036;stroke-width:1" x1="60.5" x2="102.5" y1="578.016" y2="578.016"/><line style="stroke:#a80036;stroke-width:1" x1="102.5" x2="102.5" y1="578.016" y2="591.016"/><line style="stroke:#a80036;stroke-width:1" x1="61.5" x2="102.5" y1="591.016" y2="591.016"/><polygon fill="#A80036" points="71.5 587.016 61.5 591.016 71.5 595.016 67.5 591.016" style="stroke:#a80036;stroke-width:1"/><text x="67.5" y="572.842" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">13</text><text x="85.5" y="572.842" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55">Sign CSR</text><polygon fill="#A80036" points="1343 616.25 1353 620.25 1343 624.25 1347 620.25" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="55.5" x2="1349" y1="620.25" y2="620.25"/><text x="62.5" y="615.076" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">14</text><text x="80.5" y="615.076" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">Signed cert</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1412" y1="644.484" y2="644.484"/><line style="stroke:#a80036;stroke-width:1" x1="1412" x2="1412" y1="644.484" y2="657.484"/><line style="stroke:#a80036;stroke-width:1" x1="1371" x2="1412" y1="657.484" y2="657.484"/><polygon fill="#A80036" points="1381 653.484 1371 657.484 1381 661.484 1377 657.484" style="stroke:#a80036;stroke-width:1"/><text x="1377" y="639.311" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">15</text><text x="1395" y="639.311" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353">Import signed cert as the EST identity cert for future requests</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1370" x2="1412" y1="696.719" y2="696.719"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1412" x2="1412" y1="696.719" y2="709.719"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1365" x2="1412" y1="709.719" y2="709.719"/><polygon fill="#A80036" points="1375 705.719 1365 709.719 1375 713.719 1371 709.719" style="stroke:#a80036;stroke-width:1"/><text x="1377" y="691.545" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">16</text><path fill="#EEE" d="M23,726.7188 L96,726.7188 L96,733.7188 L86,743.7188 L23,743.7188 L23,726.7188" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1831" height="488.281" x="23" y="726.719" fill="none"/><text x="38" y="739.779" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="111" y="738.924" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="413">[for creating and renewing device CA cert (if needed to mint other certs)]</text><polygon fill="#A80036" points="1093 761.188 1083 765.188 1093 769.188 1089 765.188" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1087" x2="1354" y1="765.188" y2="765.188"/><text x="1099" y="760.014" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">17</text><text x="1117" y="760.014" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236">Get current EST identity cert&apos;s private key</text><polygon fill="#A80036" points="1343 790.422 1353 794.422 1343 798.422 1347 794.422" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1077" x2="1349" y1="794.422" y2="794.422"/><text x="1084" y="789.248" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">18</text><text x="1102" y="789.248" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">Key handle</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1407" y1="823.656" y2="823.656"/><line style="stroke:#a80036;stroke-width:1" x1="1407" x2="1407" y1="823.656" y2="836.656"/><line style="stroke:#a80036;stroke-width:1" x1="1366" x2="1407" y1="836.656" y2="836.656"/><polygon fill="#A80036" points="1376 832.656 1366 836.656 1376 840.656 1372 836.656" style="stroke:#a80036;stroke-width:1"/><text x="1372" y="818.482" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">19</text><text x="1390" y="818.482" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393">Create TLS client using key handle + PEM (using openssl-engine-ks)</text><polygon fill="#A80036" points="1093 861.891 1083 865.891 1093 869.891 1089 865.891" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1087" x2="1354" y1="865.891" y2="865.891"/><text x="1099" y="860.717" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">20</text><text x="1117" y="860.717" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197">Generate new asymmetric key pair</text><polygon fill="#A80036" points="1343 891.125 1353 895.125 1343 899.125 1347 895.125" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1077" x2="1349" y1="895.125" y2="895.125"/><text x="1084" y="889.951" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">21</text><text x="1102" y="889.951" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">Key handle</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1407" y1="924.359" y2="924.359"/><line style="stroke:#a80036;stroke-width:1" x1="1407" x2="1407" y1="924.359" y2="937.359"/><line style="stroke:#a80036;stroke-width:1" x1="1366" x2="1407" y1="937.359" y2="937.359"/><polygon fill="#A80036" points="1376 933.359 1366 937.359 1376 941.359 1372 937.359" style="stroke:#a80036;stroke-width:1"/><text x="1372" y="919.186" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">22</text><text x="1390" y="919.186" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="452">Create CSR for new device CA cert using key handle (using openssl-engine-ks)</text><polygon fill="#A80036" points="71.5 962.594 61.5 966.594 71.5 970.594 67.5 966.594" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="65.5" x2="1354" y1="966.594" y2="966.594"/><text x="77.5" y="961.42" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">23</text><text x="95.5" y="961.42" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="534">Connect using TLS client and send request for new device CA cert corresponding to the CSR</text><line style="stroke:#a80036;stroke-width:1" x1="60.5" x2="102.5" y1="995.828" y2="995.828"/><line style="stroke:#a80036;stroke-width:1" x1="102.5" x2="102.5" y1="995.828" y2="1008.828"/><line style="stroke:#a80036;stroke-width:1" x1="61.5" x2="102.5" y1="1008.828" y2="1008.828"/><polygon fill="#A80036" points="71.5 1004.828 61.5 1008.828 71.5 1012.828 67.5 1008.828" style="stroke:#a80036;stroke-width:1"/><text x="67.5" y="990.654" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">24</text><text x="85.5" y="990.654" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157">Verify client cert against CA</text><line style="stroke:#a80036;stroke-width:1" x1="60.5" x2="102.5" y1="1038.063" y2="1038.063"/><line style="stroke:#a80036;stroke-width:1" x1="102.5" x2="102.5" y1="1038.063" y2="1051.063"/><line style="stroke:#a80036;stroke-width:1" x1="61.5" x2="102.5" y1="1051.063" y2="1051.063"/><polygon fill="#A80036" points="71.5 1047.063 61.5 1051.063 71.5 1055.063 67.5 1051.063" style="stroke:#a80036;stroke-width:1"/><text x="67.5" y="1032.889" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">25</text><text x="85.5" y="1032.889" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55">Sign CSR</text><polygon fill="#A80036" points="1343 1076.297 1353 1080.297 1343 1084.297 1347 1080.297" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="55.5" x2="1349" y1="1080.297" y2="1080.297"/><text x="62.5" y="1075.123" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">26</text><text x="80.5" y="1075.123" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">Signed cert</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1412" y1="1104.531" y2="1104.531"/><line style="stroke:#a80036;stroke-width:1" x1="1412" x2="1412" y1="1104.531" y2="1117.531"/><line style="stroke:#a80036;stroke-width:1" x1="1371" x2="1412" y1="1117.531" y2="1117.531"/><polygon fill="#A80036" points="1381 1113.531 1371 1117.531 1381 1121.531 1377 1117.531" style="stroke:#a80036;stroke-width:1"/><text x="1377" y="1099.357" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">27</text><text x="1395" y="1099.357" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229">Import signed cert as the device CA cert</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1370" x2="1412" y1="1156.766" y2="1156.766"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1412" x2="1412" y1="1156.766" y2="1169.766"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1365" x2="1412" y1="1169.766" y2="1169.766"/><polygon fill="#A80036" points="1375 1165.766 1365 1169.766 1375 1173.766 1371 1169.766" style="stroke:#a80036;stroke-width:1"/><text x="1377" y="1151.592" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">28</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1407" y1="1194" y2="1194"/><line style="stroke:#a80036;stroke-width:1" x1="1407" x2="1407" y1="1194" y2="1207"/><line style="stroke:#a80036;stroke-width:1" x1="1366" x2="1407" y1="1207" y2="1207"/><polygon fill="#A80036" points="1376 1203 1366 1207 1376 1211 1372 1207" style="stroke:#a80036;stroke-width:1"/><text x="1372" y="1188.826" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">29</text><text x="1390" y="1188.826" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328">Wait for the device CA cert to be near expiry (active timer)</text><path fill="#EEE" d="M13,1229 L86,1229 L86,1236 L76,1246 L13,1246 L13,1229" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1877" height="492.172" x="13" y="1229" fill="none"/><text x="28" y="1242.061" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="101" y="1241.205" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="266">[for creating and renewing device identity cert]</text><path fill="#EEE" d="M23,1253.2344 L86,1253.2344 L86,1260.2344 L76,1270.2344 L23,1270.2344 L23,1253.2344" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1857" height="460.938" x="23" y="1253.234" fill="none"/><text x="38" y="1266.295" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18">alt</text><text x="101" y="1265.439" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="335">[if user configured device identity to be obtained from EST]</text><polygon fill="#A80036" points="71.5 1287.703 61.5 1291.703 71.5 1295.703 67.5 1291.703" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="65.5" x2="1354" y1="1291.703" y2="1291.703"/><text x="77.5" y="1286.529" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">30</text><text x="95.5" y="1286.529" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252">Similar process as for device CA cert above</text><polygon fill="#A80036" points="1343 1316.938 1353 1320.938 1343 1324.938 1347 1320.938" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="55.5" x2="1349" y1="1320.938" y2="1320.938"/><text x="62.5" y="1315.764" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">31</text><text x="80.5" y="1315.764" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">Signed cert</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="23" x2="1880" y1="1329.938" y2="1329.938"/><text x="28" y="1340.143" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="308">[if user configured device identity to be minted locally]</text><polygon fill="#A80036" points="1093 1361.063 1083 1365.063 1093 1369.063 1089 1365.063" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1087" x2="1354" y1="1365.063" y2="1365.063"/><text x="1099" y="1359.889" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">32</text><text x="1117" y="1359.889" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223">Get current device CA cert&apos;s private key</text><polygon fill="#A80036" points="1343 1390.297 1353 1394.297 1343 1398.297 1347 1394.297" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1077" x2="1349" y1="1394.297" y2="1394.297"/><text x="1084" y="1389.123" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">33</text><text x="1102" y="1389.123" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">Key handle</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1412" y1="1418.531" y2="1418.531"/><line style="stroke:#a80036;stroke-width:1" x1="1412" x2="1412" y1="1418.531" y2="1431.531"/><line style="stroke:#a80036;stroke-width:1" x1="1371" x2="1412" y1="1431.531" y2="1431.531"/><polygon fill="#A80036" points="1381 1427.531 1371 1431.531 1381 1435.531 1377 1431.531" style="stroke:#a80036;stroke-width:1"/><text x="1377" y="1413.357" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">34</text><text x="1395" y="1413.357" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148">Get current device CA cert</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1370" x2="1412" y1="1470.766" y2="1470.766"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1412" x2="1412" y1="1470.766" y2="1483.766"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1365" x2="1412" y1="1483.766" y2="1483.766"/><polygon fill="#A80036" points="1375 1479.766 1365 1483.766 1375 1487.766 1371 1483.766" style="stroke:#a80036;stroke-width:1"/><text x="1377" y="1465.592" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">35</text><text x="1395" y="1465.592" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25">PEM</text><polygon fill="#A80036" points="1093 1504 1083 1508 1093 1512 1089 1508" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1087" x2="1354" y1="1508" y2="1508"/><text x="1099" y="1502.826" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">36</text><text x="1117" y="1502.826" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197">Generate new asymmetric key pair</text><polygon fill="#A80036" points="1343 1533.234 1353 1537.234 1343 1541.234 1347 1537.234" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1077" x2="1349" y1="1537.234" y2="1537.234"/><text x="1084" y="1532.061" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">37</text><text x="1102" y="1532.061" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">Key handle</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1407" y1="1566.469" y2="1566.469"/><line style="stroke:#a80036;stroke-width:1" x1="1407" x2="1407" y1="1566.469" y2="1579.469"/><line style="stroke:#a80036;stroke-width:1" x1="1366" x2="1407" y1="1579.469" y2="1579.469"/><polygon fill="#A80036" points="1376 1575.469 1366 1579.469 1376 1583.469 1372 1579.469" style="stroke:#a80036;stroke-width:1"/><text x="1372" y="1561.295" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">38</text><text x="1390" y="1561.295" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="478">Create CSR for new device identity cert using key handle (using openssl-engine-ks)</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1407" y1="1608.703" y2="1608.703"/><line style="stroke:#a80036;stroke-width:1" x1="1407" x2="1407" y1="1608.703" y2="1621.703"/><line style="stroke:#a80036;stroke-width:1" x1="1366" x2="1407" y1="1621.703" y2="1621.703"/><polygon fill="#A80036" points="1376 1617.703 1366 1621.703 1376 1625.703 1372 1621.703" style="stroke:#a80036;stroke-width:1"/><text x="1372" y="1603.529" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">39</text><text x="1390" y="1603.529" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175">Sign CSR using device CA cert</text><line style="stroke:#a80036;stroke-width:1" x1="1365" x2="1412" y1="1645.938" y2="1645.938"/><line style="stroke:#a80036;stroke-width:1" x1="1412" x2="1412" y1="1645.938" y2="1658.938"/><line style="stroke:#a80036;stroke-width:1" x1="1371" x2="1412" y1="1658.938" y2="1658.938"/><polygon fill="#A80036" points="1381 1654.938 1371 1658.938 1381 1662.938 1377 1658.938" style="stroke:#a80036;stroke-width:1"/><text x="1377" y="1640.764" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">40</text><text x="1395" y="1640.764" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255">Import signed cert as the device identity cert</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1370" x2="1412" y1="1698.172" y2="1698.172"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1412" x2="1412" y1="1698.172" y2="1711.172"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="1365" x2="1412" y1="1711.172" y2="1711.172"/><polygon fill="#A80036" points="1375 1707.172 1365 1711.172 1375 1715.172 1371 1711.172" style="stroke:#a80036;stroke-width:1"/><text x="1377" y="1692.998" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">41</text><polygon fill="#A80036" points="653 1745.406 643 1749.406 653 1753.406 649 1749.406" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="647" x2="1359" y1="1749.406" y2="1749.406"/><text x="659" y="1744.232" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">42</text><text x="677" y="1744.232" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25">PEM</text><path fill="#EEE" d="M222,1764.4063 L295,1764.4063 L295,1771.4063 L285,1781.4063 L222,1781.4063 L222,1764.4063" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1221.5" height="462.281" x="222" y="1764.406" fill="none"/><text x="237" y="1777.467" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="310" y="1776.611" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120">[for (re-)provisioning]</text><line style="stroke:#a80036;stroke-width:1" x1="642" x2="689" y1="1797.875" y2="1797.875"/><line style="stroke:#a80036;stroke-width:1" x1="689" x2="689" y1="1797.875" y2="1810.875"/><line style="stroke:#a80036;stroke-width:1" x1="648" x2="689" y1="1810.875" y2="1810.875"/><polygon fill="#A80036" points="658 1806.875 648 1810.875 658 1814.875 654 1810.875" style="stroke:#a80036;stroke-width:1"/><text x="654" y="1792.701" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">43</text><text x="672" y="1792.701" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123">Request provisioning</text><polygon fill="#A80036" points="1060 1841.109 1070 1845.109 1060 1849.109 1064 1845.109" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="647" x2="1066" y1="1845.109" y2="1845.109"/><text x="654" y="1839.936" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">44</text><text x="672" y="1839.936" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249">Get current device identity cert&apos;s private key</text><polygon fill="#A80036" points="658 1870.344 648 1874.344 658 1878.344 654 1874.344" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="652" x2="1076" y1="1874.344" y2="1874.344"/><text x="664" y="1869.17" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">45</text><text x="682" y="1869.17" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63">Key handle</text><line style="stroke:#a80036;stroke-width:1" x1="647" x2="689" y1="1903.578" y2="1903.578"/><line style="stroke:#a80036;stroke-width:1" x1="689" x2="689" y1="1903.578" y2="1916.578"/><line style="stroke:#a80036;stroke-width:1" x1="648" x2="689" y1="1916.578" y2="1916.578"/><polygon fill="#A80036" points="658 1912.578 648 1916.578 658 1920.578 654 1916.578" style="stroke:#a80036;stroke-width:1"/><text x="654" y="1898.404" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">46</text><text x="672" y="1898.404" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177">Check EST identity cert validity</text><polygon fill="#A80036" points="1343 1941.813 1353 1945.813 1343 1949.813 1347 1945.813" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="647" x2="1349" y1="1945.813" y2="1945.813"/><text x="654" y="1940.639" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">47</text><text x="672" y="1940.639" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174">Get current device identity cert</text><polygon fill="#A80036" points="658 1971.047 648 1975.047 658 1979.047 654 1975.047" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="652" x2="1359" y1="1975.047" y2="1975.047"/><text x="664" y="1969.873" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">48</text><text x="682" y="1969.873" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25">PEM</text><line style="stroke:#a80036;stroke-width:1" x1="647" x2="689" y1="2004.281" y2="2004.281"/><line style="stroke:#a80036;stroke-width:1" x1="689" x2="689" y1="2004.281" y2="2017.281"/><line style="stroke:#a80036;stroke-width:1" x1="648" x2="689" y1="2017.281" y2="2017.281"/><polygon fill="#A80036" points="658 2013.281 648 2017.281 658 2021.281 654 2017.281" style="stroke:#a80036;stroke-width:1"/><text x="654" y="1999.107" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">49</text><text x="672" y="1999.107" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393">Create TLS client using key handle + PEM (using openssl-engine-ks)</text><polygon fill="#A80036" points="270.5 2042.516 260.5 2046.516 270.5 2050.516 266.5 2046.516" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="264.5" x2="636" y1="2046.516" y2="2046.516"/><text x="276.5" y="2041.342" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">50</text><text x="294.5" y="2041.342" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324">Connect using TLS client and send provisioning request</text><line style="stroke:#a80036;stroke-width:1" x1="259.5" x2="301.5" y1="2075.75" y2="2075.75"/><line style="stroke:#a80036;stroke-width:1" x1="301.5" x2="301.5" y1="2075.75" y2="2088.75"/><line style="stroke:#a80036;stroke-width:1" x1="260.5" x2="301.5" y1="2088.75" y2="2088.75"/><polygon fill="#A80036" points="270.5 2084.75 260.5 2088.75 270.5 2092.75 266.5 2088.75" style="stroke:#a80036;stroke-width:1"/><text x="266.5" y="2070.576" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">51</text><text x="284.5" y="2070.576" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243">Verify client cert against device identity CA</text><polygon fill="#A80036" points="522.5 2113.984 532.5 2117.984 522.5 2121.984 526.5 2117.984" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="259.5" x2="528.5" y1="2117.984" y2="2117.984"/><text x="266.5" y="2112.811" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">52</text><text x="284.5" y="2112.811" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89">Register device</text><polygon fill="#A80036" points="270.5 2143.219 260.5 2147.219 270.5 2151.219 266.5 2147.219" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="264.5" x2="538.5" y1="2147.219" y2="2147.219"/><text x="276.5" y="2142.045" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">53</text><polygon fill="#A80036" points="625 2172.453 635 2176.453 625 2180.453 629 2176.453" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="254.5" x2="631" y1="2176.453" y2="2176.453"/><text x="261.5" y="2171.279" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">54</text><text x="279.5" y="2171.279" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253">Provisioning info (IoT Hub + device identity)</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="647" x2="689" y1="2210.688" y2="2210.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="689" x2="689" y1="2210.688" y2="2223.688"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="642" x2="689" y1="2223.688" y2="2223.688"/><polygon fill="#A80036" points="652 2219.688 642 2223.688 652 2227.688 648 2223.688" style="stroke:#a80036;stroke-width:1"/><text x="654" y="2205.514" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">55</text><text x="672" y="2205.514" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127">Ok(ProvisioningDone)</text></g></svg>