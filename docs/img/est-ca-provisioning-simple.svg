<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1454" height="1700" contentScriptType="application/ecmascript" contentStyleType="text/css" style="width:1454px;height:1700px" preserveAspectRatio="none" version="1.1" viewBox="0 0 1454 1700" zoomAndPan="magnify"><defs><filter id="fffrq0z8rl8tb" width="300%" height="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text x="649" y="26.699" fill="#000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="156">Device Provisioning</text><rect style="stroke:#a80036;stroke-width:1" width="112" height="1650.125" x="766" y="39.094" fill="#ADD8E6"/><text x="799.5" y="51.154" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="42">Device</text><rect style="stroke:#a80036;stroke-width:1" width="10" height="113.703" x="151.5" y="513.188" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="113.703" x="151.5" y="886.766" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="151.5" y="1184.875" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="129.938" x="436.5" y="1495.875" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="721.5" y="1567.344" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#000;stroke-width:2" width="1028" height="374.813" x="124" y="359.781" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#000;stroke-width:2" width="1022" height="359.578" x="124" y="748.594" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#000;stroke-width:2" width="1046" height="263.766" x="114" y="1122.172" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#000;stroke-width:2" width="1026" height="232.531" x="124" y="1146.406" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:none;stroke-width:1" width="1026" height="156.828" x="124" y="1222.109" fill="#FFF"/><rect style="stroke:#000;stroke-width:2" width="738" height="233.875" x="409" y="1399.938" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="156" x2="156" y1="93.734" y2="1650.813"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="441" x2="441" y1="93.734" y2="1650.813"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="726" x2="726" y1="93.734" y2="1650.813"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="822" x2="822" y1="93.734" y2="1650.813"/><rect style="stroke:#a80036;stroke-width:1.5" width="41" height="30.406" x="134" y="58.328" fill="#FEFECE" filter="url(#fffrq0z8rl8tb)"/><text x="141" y="78.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27">EST</text><rect style="stroke:#a80036;stroke-width:1.5" width="41" height="30.406" x="134" y="1649.813" fill="#FEFECE" filter="url(#fffrq0z8rl8tb)"/><text x="141" y="1669.801" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27">EST</text><rect style="stroke:#a80036;stroke-width:1.5" width="41" height="30.406" x="419" y="58.328" fill="#FEFECE" filter="url(#fffrq0z8rl8tb)"/><text x="426" y="78.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27">DPS</text><rect style="stroke:#a80036;stroke-width:1.5" width="41" height="30.406" x="419" y="1649.813" fill="#FEFECE" filter="url(#fffrq0z8rl8tb)"/><text x="426" y="1669.801" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27">DPS</text><rect style="stroke:#a80036;stroke-width:1.5" width="63" height="30.406" x="693" y="58.328" fill="#FEFECE" filter="url(#fffrq0z8rl8tb)"/><text x="700" y="78.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49">IoT Hub</text><rect style="stroke:#a80036;stroke-width:1.5" width="63" height="30.406" x="693" y="1649.813" fill="#FEFECE" filter="url(#fffrq0z8rl8tb)"/><text x="700" y="1669.801" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49">IoT Hub</text><rect style="stroke:#a80036;stroke-width:1.5" width="100" height="30.406" x="770" y="58.328" fill="#FEFECE" filter="url(#fffrq0z8rl8tb)"/><text x="777" y="78.316" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86">Edge runtime</text><rect style="stroke:#a80036;stroke-width:1.5" width="100" height="30.406" x="770" y="1649.813" fill="#FEFECE" filter="url(#fffrq0z8rl8tb)"/><text x="777" y="1669.801" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86">Edge runtime</text><rect style="stroke:#a80036;stroke-width:1" width="10" height="113.703" x="151.5" y="513.188" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="113.703" x="151.5" y="886.766" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="151.5" y="1184.875" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="129.938" x="436.5" y="1495.875" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><rect style="stroke:#a80036;stroke-width:1" width="10" height="29.234" x="721.5" y="1567.344" fill="#FFF" filter="url(#fffrq0z8rl8tb)"/><path fill="#FBFB77" d="M8,108.7344 L8,285.7344 L1442,285.7344 L1442,118.7344 L1432,108.7344 L8,108.7344" filter="url(#fffrq0z8rl8tb)" style="stroke:#a80036;stroke-width:1"/><path fill="#FBFB77" d="M1432,108.7344 L1432,118.7344 L1442,118.7344 L1432,108.7344" style="stroke:#a80036;stroke-width:1"/><text x="14" y="125.795" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="307">These are the kinds of certs involved in the EST flow:</text><text x="14" y="156.264" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1413">1. The EST identity cert. This is the cert that the device uses for TLS client auth to authenticate itself with the EST endpoint. The device rotates this periodically via the EST enrolment workflow, using the current EST identity cert for TLS client auth.</text><text x="14" y="186.732" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="363">2. The boostrap identity cert. This is the initial EST identity cert.</text><text x="14" y="217.201" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="842">3. The device CA cert. The device requests this cert from the EST endpoint if it needs it for minting any other certs locally (see the next two points).</text><text x="14" y="247.67" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1242">4. The device identity cert. Depending on the user&apos;s choice, the device either gets this cert from the EST endpoint (after the initial enrolment that granted it an EST identity cert), or it mints it locally via the device CA cert.</text><text x="14" y="278.139" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1224">5. Module certs. Depending on the user&apos;s choice, the device either gets these certs from the EST endpoint (after the initial enrolment that granted it an EST identity cert), or it mints them locally via the device CA cert.</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="331.781" y2="331.781"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="331.781" y2="344.781"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="344.781" y2="344.781"/><polygon fill="#A80036" points="833 340.781 823 344.781 833 348.781 829 344.781" style="stroke:#a80036;stroke-width:1"/><text x="829" y="318.99" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">1</text><text x="840" y="311.373" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274">At first, the bootstrap ID cert is used as the EST</text><text x="840" y="326.607" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">identity cert</text><path fill="#EEE" d="M124,359.7813 L197,359.7813 L197,366.7813 L187,376.7813 L124,376.7813 L124,359.7813" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1028" height="374.813" x="124" y="359.781" fill="none"/><text x="139" y="372.842" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="212" y="371.986" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="250">[for creating and renewing EST identity cert]</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="398.25" y2="398.25"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="398.25" y2="411.25"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="411.25" y2="411.25"/><polygon fill="#A80036" points="833 407.25 823 411.25 833 415.25 829 411.25" style="stroke:#a80036;stroke-width:1"/><text x="829" y="393.076" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">2</text><text x="840" y="393.076" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275">Create TLS client using current EST identity cert</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="440.484" y2="440.484"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="440.484" y2="453.484"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="453.484" y2="453.484"/><polygon fill="#A80036" points="833 449.484 823 453.484 833 457.484 829 453.484" style="stroke:#a80036;stroke-width:1"/><text x="829" y="435.31" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">3</text><text x="840" y="435.31" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="300">Generate new key and CSR for new EST identity cert</text><polygon fill="#A80036" points="172.5 509.188 162.5 513.188 172.5 517.188 168.5 513.188" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="166.5" x2="821" y1="513.188" y2="513.188"/><text x="178.5" y="492.779" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">4</text><text x="189.5" y="477.545" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248">Connect using TLS client and perform EST</text><text x="189.5" y="492.779" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230">enrolment to get a new EST identity cert</text><text x="189.5" y="508.014" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150">corresponding to the CSR</text><line style="stroke:#a80036;stroke-width:1" x1="161.5" x2="203.5" y1="542.422" y2="542.422"/><line style="stroke:#a80036;stroke-width:1" x1="203.5" x2="203.5" y1="542.422" y2="555.422"/><line style="stroke:#a80036;stroke-width:1" x1="162.5" x2="203.5" y1="555.422" y2="555.422"/><polygon fill="#A80036" points="172.5 551.422 162.5 555.422 172.5 559.422 168.5 555.422" style="stroke:#a80036;stroke-width:1"/><text x="168.5" y="537.248" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">5</text><text x="179.5" y="537.248" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157">Verify client cert against CA</text><line style="stroke:#a80036;stroke-width:1" x1="161.5" x2="203.5" y1="584.656" y2="584.656"/><line style="stroke:#a80036;stroke-width:1" x1="203.5" x2="203.5" y1="584.656" y2="597.656"/><line style="stroke:#a80036;stroke-width:1" x1="162.5" x2="203.5" y1="597.656" y2="597.656"/><polygon fill="#A80036" points="172.5 593.656 162.5 597.656 172.5 601.656 168.5 597.656" style="stroke:#a80036;stroke-width:1"/><text x="168.5" y="579.482" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">6</text><text x="179.5" y="579.482" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55">Sign CSR</text><polygon fill="#A80036" points="810 622.891 820 626.891 810 630.891 814 626.891" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="156.5" x2="816" y1="626.891" y2="626.891"/><text x="163.5" y="621.717" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">7</text><text x="174.5" y="621.717" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">Signed cert</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="671.359" y2="671.359"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="671.359" y2="684.359"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="684.359" y2="684.359"/><polygon fill="#A80036" points="833 680.359 823 684.359 833 688.359 829 684.359" style="stroke:#a80036;stroke-width:1"/><text x="829" y="658.568" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">8</text><text x="840" y="650.951" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297">Set signed cert to be the EST identity cert for future</text><text x="840" y="666.186" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51">requests</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="713.594" y2="713.594"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="713.594" y2="726.594"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="726.594" y2="726.594"/><polygon fill="#A80036" points="833 722.594 823 726.594 833 730.594 829 726.594" style="stroke:#a80036;stroke-width:1"/><text x="829" y="708.42" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7">9</text><text x="840" y="708.42" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263">Wait for the EST identity cert to be near expiry</text><path fill="#EEE" d="M124,748.5938 L197,748.5938 L197,755.5938 L187,765.5938 L124,765.5938 L124,748.5938" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1022" height="359.578" x="124" y="748.594" fill="none"/><text x="139" y="761.654" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="212" y="760.799" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="303">[for creating and renewing device CA cert (if needed)]</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="787.063" y2="787.063"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="787.063" y2="800.063"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="800.063" y2="800.063"/><polygon fill="#A80036" points="833 796.063 823 800.063 833 804.063 829 800.063" style="stroke:#a80036;stroke-width:1"/><text x="829" y="781.889" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">10</text><text x="847" y="781.889" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275">Create TLS client using current EST identity cert</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="829.297" y2="829.297"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="829.297" y2="842.297"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="842.297" y2="842.297"/><polygon fill="#A80036" points="833 838.297 823 842.297 833 846.297 829 842.297" style="stroke:#a80036;stroke-width:1"/><text x="829" y="824.123" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">11</text><text x="847" y="824.123" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287">Generate new key and CSR for new device CA cert</text><polygon fill="#A80036" points="172.5 882.766 162.5 886.766 172.5 890.766 168.5 886.766" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="166.5" x2="821" y1="886.766" y2="886.766"/><text x="178.5" y="873.975" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">12</text><text x="196.5" y="866.357" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296">Connect using TLS client and send request for new</text><text x="196.5" y="881.592" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235">device CA cert corresponding to the CSR</text><line style="stroke:#a80036;stroke-width:1" x1="161.5" x2="203.5" y1="916" y2="916"/><line style="stroke:#a80036;stroke-width:1" x1="203.5" x2="203.5" y1="916" y2="929"/><line style="stroke:#a80036;stroke-width:1" x1="162.5" x2="203.5" y1="929" y2="929"/><polygon fill="#A80036" points="172.5 925 162.5 929 172.5 933 168.5 929" style="stroke:#a80036;stroke-width:1"/><text x="168.5" y="910.826" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">13</text><text x="186.5" y="910.826" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243">Verify client cert against device identity CA</text><line style="stroke:#a80036;stroke-width:1" x1="161.5" x2="203.5" y1="958.234" y2="958.234"/><line style="stroke:#a80036;stroke-width:1" x1="203.5" x2="203.5" y1="958.234" y2="971.234"/><line style="stroke:#a80036;stroke-width:1" x1="162.5" x2="203.5" y1="971.234" y2="971.234"/><polygon fill="#A80036" points="172.5 967.234 162.5 971.234 172.5 975.234 168.5 971.234" style="stroke:#a80036;stroke-width:1"/><text x="168.5" y="953.061" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">14</text><text x="186.5" y="953.061" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55">Sign CSR</text><polygon fill="#A80036" points="810 996.469 820 1000.469 810 1004.469 814 1000.469" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="156.5" x2="816" y1="1000.469" y2="1000.469"/><text x="163.5" y="995.295" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">15</text><text x="181.5" y="995.295" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">Signed cert</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="1044.938" y2="1044.938"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="1044.938" y2="1057.938"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="1057.938" y2="1057.938"/><polygon fill="#A80036" points="833 1053.938 823 1057.938 833 1061.938 829 1057.938" style="stroke:#a80036;stroke-width:1"/><text x="829" y="1032.147" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">16</text><text x="847" y="1024.529" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="284">Set signed cert to be the device CA cert for future</text><text x="847" y="1039.764" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51">requests</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="1087.172" y2="1087.172"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="1087.172" y2="1100.172"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="1100.172" y2="1100.172"/><polygon fill="#A80036" points="833 1096.172 823 1100.172 833 1104.172 829 1100.172" style="stroke:#a80036;stroke-width:1"/><text x="829" y="1081.998" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">17</text><text x="847" y="1081.998" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250">Wait for the device CA cert to be near expiry</text><path fill="#EEE" d="M114,1122.1719 L187,1122.1719 L187,1129.1719 L177,1139.1719 L114,1139.1719 L114,1122.1719" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1046" height="263.766" x="114" y="1122.172" fill="none"/><text x="129" y="1135.232" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="202" y="1134.377" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="266">[for creating and renewing device identity cert]</text><path fill="#EEE" d="M124,1146.4063 L187,1146.4063 L187,1153.4063 L177,1163.4063 L124,1163.4063 L124,1146.4063" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="1026" height="232.531" x="124" y="1146.406" fill="none"/><text x="139" y="1159.467" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18">alt</text><text x="202" y="1158.611" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="335">[if user configured device identity to be obtained from EST]</text><polygon fill="#A80036" points="172.5 1180.875 162.5 1184.875 172.5 1188.875 168.5 1184.875" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="166.5" x2="821" y1="1184.875" y2="1184.875"/><text x="178.5" y="1179.701" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">18</text><text x="196.5" y="1179.701" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252">Similar process as for device CA cert above</text><polygon fill="#A80036" points="810 1210.109 820 1214.109 810 1218.109 814 1214.109" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="156.5" x2="816" y1="1214.109" y2="1214.109"/><text x="163.5" y="1208.936" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">19</text><text x="181.5" y="1208.936" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">Signed cert</text><line style="stroke:#000;stroke-width:1;stroke-dasharray:2,2" x1="124" x2="1150" y1="1223.109" y2="1223.109"/><text x="129" y="1233.314" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="308">[if user configured device identity to be minted locally]</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="1273.469" y2="1273.469"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="1273.469" y2="1286.469"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="1286.469" y2="1286.469"/><polygon fill="#A80036" points="833 1282.469 823 1286.469 833 1290.469 829 1286.469" style="stroke:#a80036;stroke-width:1"/><text x="829" y="1260.678" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">20</text><text x="847" y="1253.061" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288">Generate new key and CSR for new device identity</text><text x="847" y="1268.295" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22">cert</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="1315.703" y2="1315.703"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="1315.703" y2="1328.703"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="1328.703" y2="1328.703"/><polygon fill="#A80036" points="833 1324.703 823 1328.703 833 1332.703 829 1328.703" style="stroke:#a80036;stroke-width:1"/><text x="829" y="1310.529" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">21</text><text x="847" y="1310.529" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175">Sign CSR using device CA cert</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="1357.938" y2="1357.938"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="1357.938" y2="1370.938"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="1370.938" y2="1370.938"/><polygon fill="#A80036" points="833 1366.938 823 1370.938 833 1374.938 829 1370.938" style="stroke:#a80036;stroke-width:1"/><text x="829" y="1352.764" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">22</text><text x="847" y="1352.764" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="276">Wait for the device identity cert to be near expiry</text><path fill="#EEE" d="M409,1399.9375 L482,1399.9375 L482,1406.9375 L472,1416.9375 L409,1416.9375 L409,1399.9375" style="stroke:#000;stroke-width:1"/><rect style="stroke:#000;stroke-width:2" width="738" height="233.875" x="409" y="1399.938" fill="none"/><text x="424" y="1412.998" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28">loop</text><text x="497" y="1412.143" fill="#000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120">[for (re-)provisioning]</text><line style="stroke:#a80036;stroke-width:1" x1="822" x2="864" y1="1438.406" y2="1438.406"/><line style="stroke:#a80036;stroke-width:1" x1="864" x2="864" y1="1438.406" y2="1451.406"/><line style="stroke:#a80036;stroke-width:1" x1="823" x2="864" y1="1451.406" y2="1451.406"/><polygon fill="#A80036" points="833 1447.406 823 1451.406 833 1455.406 829 1451.406" style="stroke:#a80036;stroke-width:1"/><text x="829" y="1433.232" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">23</text><text x="847" y="1433.232" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288">Create TLS client using current device identity cert</text><polygon fill="#A80036" points="457.5 1491.875 447.5 1495.875 457.5 1499.875 453.5 1495.875" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="451.5" x2="821" y1="1495.875" y2="1495.875"/><text x="463.5" y="1483.084" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">24</text><text x="481.5" y="1475.467" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277">Connect using TLS client and send provisioning</text><text x="481.5" y="1490.701" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44">request</text><line style="stroke:#a80036;stroke-width:1" x1="446.5" x2="488.5" y1="1525.109" y2="1525.109"/><line style="stroke:#a80036;stroke-width:1" x1="488.5" x2="488.5" y1="1525.109" y2="1538.109"/><line style="stroke:#a80036;stroke-width:1" x1="447.5" x2="488.5" y1="1538.109" y2="1538.109"/><polygon fill="#A80036" points="457.5 1534.109 447.5 1538.109 457.5 1542.109 453.5 1538.109" style="stroke:#a80036;stroke-width:1"/><text x="453.5" y="1519.936" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">25</text><text x="471.5" y="1519.936" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243">Verify client cert against device identity CA</text><polygon fill="#A80036" points="709.5 1563.344 719.5 1567.344 709.5 1571.344 713.5 1567.344" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="446.5" x2="715.5" y1="1567.344" y2="1567.344"/><text x="453.5" y="1562.17" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">26</text><text x="471.5" y="1562.17" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89">Register device</text><polygon fill="#A80036" points="457.5 1592.578 447.5 1596.578 457.5 1600.578 453.5 1596.578" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="451.5" x2="725.5" y1="1596.578" y2="1596.578"/><text x="463.5" y="1591.404" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">27</text><polygon fill="#A80036" points="810 1621.813 820 1625.813 810 1629.813 814 1625.813" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:2,2" x1="441.5" x2="816" y1="1625.813" y2="1625.813"/><text x="448.5" y="1620.639" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14">28</text><text x="466.5" y="1620.639" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253">Provisioning info (IoT Hub + device identity)</text></g></svg>